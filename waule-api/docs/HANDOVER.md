# é¡¹ç›®äº¤æ¥æ–‡æ¡£

## ä¸€ã€æ•´ä½“æ¶æ„

æœ¬é¡¹ç›®ç”±ä¸‰ä¸ªç‹¬ç«‹åº”ç”¨ç»„æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            å®¢æˆ·ç¯å¢ƒ                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Client (Electron exe)                     â”‚   â”‚
â”‚  â”‚                    æ‰“åŒ…ç»™å®¢æˆ·çš„æ¡Œé¢åº”ç”¨                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  - ç”¨æˆ·ç•Œé¢ï¼ˆReact/Vueï¼‰                                      â”‚   â”‚
â”‚  â”‚  - å°ç»„ç®¡ç†ç«¯                                                 â”‚   â”‚
â”‚  â”‚  - æœ¬åœ°æ•°æ®ç¼“å­˜                                               â”‚   â”‚
â”‚  â”‚  - é€šè¿‡è‡ªç­¾åHTTPSè°ƒç”¨Serverï¼ˆæ— éœ€åŸŸåå¤‡æ¡ˆï¼‰                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ è‡ªç­¾åHTTPS (IP:ç«¯å£)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          äº‘æœåŠ¡å™¨ï¼ˆå›½å†…ï¼‰                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Server ğŸ”² å¾…å¼€å‘                          â”‚   â”‚
â”‚  â”‚                    å¹³å°ç®¡ç†æœåŠ¡                               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  - ç”¨æˆ·/ç§Ÿæˆ·ç®¡ç†ã€æƒé™æ§åˆ¶                                    â”‚   â”‚
â”‚  â”‚  - è®¡è´¹ç³»ç»Ÿã€è®¢é˜…ç®¡ç†                                         â”‚   â”‚
â”‚  â”‚  - å·¥ä½œæµå¼•æ“                                                 â”‚   â”‚
â”‚  â”‚  - è°ƒç”¨ WauleAPI è·å– AI ç”Ÿæˆç»“æœ                            â”‚   â”‚
â”‚  â”‚  - æ•°æ®åº“ï¼šPostgreSQL                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ å†…ç½‘/ä¸“çº¿
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         äº‘æœåŠ¡å™¨ï¼ˆå›½å¤–ï¼‰                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    WauleAPI âœ… å·²å®Œæˆ                         â”‚   â”‚
â”‚  â”‚                      AI æœåŠ¡ç½‘å…³                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  - API Key ç®¡ç†ï¼ˆè½®è¯¢è´Ÿè½½å‡è¡¡ï¼‰                               â”‚   â”‚
â”‚  â”‚  - è°ƒç”¨å¤§æ¨¡å‹ï¼ˆGemini/Doubao/Wanx/Vidu/MiniMax/Sora/MJï¼‰    â”‚   â”‚
â”‚  â”‚  - ä¸‹è½½ç”Ÿæˆæ–‡ä»¶ã€ä¸Šä¼  OSS                                     â”‚   â”‚
â”‚  â”‚  - æ•°æ®åº“ï¼šSQLite                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€WauleAPIï¼ˆâœ… å·²å®Œæˆï¼‰

### åŠŸèƒ½æ¸…å•

| æ¨¡å— | çŠ¶æ€ |
|------|------|
| API Keyç®¡ç†ï¼ˆGemini + å„ä¾›åº”å•†ï¼‰ | âœ… |
| å¹³å°OSSé…ç½® | âœ… |
| Discordè´¦å·ç®¡ç† | âœ… |
| ç®¡ç†åå°UI | âœ… |
| Geminiï¼ˆå›¾ç‰‡+å¯¹è¯ï¼‰ | âœ… |
| Doubaoï¼ˆå›¾ç‰‡ï¼‰ | âœ… |
| Wanxï¼ˆå›¾ç‰‡+è§†é¢‘ï¼‰ | âœ… |
| Viduï¼ˆè§†é¢‘ï¼‰ | âœ… |
| MiniMaxï¼ˆè§†é¢‘+è¯­éŸ³ï¼‰ | âœ… |
| CosyVoiceï¼ˆè¯­éŸ³ï¼‰ | âœ… |
| Soraï¼ˆè§†é¢‘ï¼‰ | âœ… |
| Midjourneyï¼ˆå›¾ç‰‡ï¼‰ | âœ… |

### API ç«¯ç‚¹ï¼ˆç«¯å£3100ï¼‰

```
POST /v1/images/generations     - å›¾ç‰‡ç”Ÿæˆ
POST /v1/videos/generations     - è§†é¢‘ç”Ÿæˆ
POST /v1/audio/speech           - è¯­éŸ³åˆæˆ
POST /v1/chat/completions       - å¯¹è¯
POST /v1/sora/chat/completions  - Soraè§†é¢‘
POST /v1/midjourney/imagine     - MJç”Ÿæˆ
POST /v1/midjourney/action      - MJæŒ‰é’®æ“ä½œ
GET  /v1/midjourney/task/:id    - MJä»»åŠ¡æŸ¥è¯¢
```

### ä»£ç ä½ç½®

```
/home/wauleapi/
â”œâ”€â”€ services/node-gateway/src/  # ä¸»è¦ä»£ç 
â”œâ”€â”€ static/manage.html          # ç®¡ç†åå°
â””â”€â”€ docker-compose.yml
```

---

## ä¸‰ã€Serverï¼ˆğŸ”² å¾…å¼€å‘ï¼‰

### æ ¸å¿ƒåŠŸèƒ½

1. **ç”¨æˆ·ç³»ç»Ÿ**
   - æ³¨å†Œã€ç™»å½•ã€JWTè®¤è¯
   - è§’è‰²æƒé™ï¼ˆå¹³å°ç®¡ç†å‘˜ã€ç§Ÿæˆ·ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ï¼‰

2. **ç§Ÿæˆ·ç®¡ç†**
   - ç§Ÿæˆ·CRUD
   - ç§Ÿæˆ·é…ç½®ï¼ˆOSSã€é…é¢ç­‰ï¼‰
   - ç§Ÿæˆ·éš”ç¦»

3. **è®¡è´¹ç³»ç»Ÿ**
   - ç§¯åˆ†/ä½™é¢ç®¡ç†
   - æ¶ˆè´¹è®°å½•
   - å……å€¼/è®¢é˜…

4. **å·¥ä½œæµå¼•æ“**
   - å·¥ä½œæµå®šä¹‰å’Œæ‰§è¡Œ
   - èŠ‚ç‚¹ç±»å‹ç®¡ç†

5. **WauleAPIå¯¹æ¥**
   - è°ƒç”¨wauleapiçš„ç»Ÿä¸€å°è£…
   - ç»“æœç¼“å­˜
   - é”™è¯¯å¤„ç†

### æŠ€æœ¯æ ˆå»ºè®®

- æ¡†æ¶ï¼šNestJS æˆ– Express
- æ•°æ®åº“ï¼šPostgreSQL
- ç¼“å­˜ï¼šRedis
- ORMï¼šPrisma

---

## å››ã€Clientï¼ˆğŸ”² å¾…å¼€å‘ï¼‰

### æ¶æ„è¯´æ˜

Client å°†æ‰“åŒ…æˆ **Electron exe** ç»™å®¢æˆ·ä½¿ç”¨ï¼Œå› æ­¤ï¼š

1. **çº¯å‰ç«¯åº”ç”¨** - Client åªåŒ…å«å‰ç«¯ä»£ç ï¼Œä¸ä¾èµ–ä»»ä½•æœåŠ¡ç«¯æ–¹æ³•
2. **APIè°ƒç”¨** - æ‰€æœ‰ä¸šåŠ¡é€»è¾‘é€šè¿‡ HTTPS è°ƒç”¨ Server API
3. **æœ¬åœ°åŠŸèƒ½** - ä»…é™ç¼“å­˜ã€æœ¬åœ°å­˜å‚¨ç­‰ä¸ä¾èµ–æœåŠ¡ç«¯çš„åŠŸèƒ½

### ç›®å½•ç»“æ„å»ºè®®

```
client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ renderer/          # æ¸²æŸ“è¿›ç¨‹ï¼ˆReact/Vueï¼‰
â”‚   â”‚   â”œâ”€â”€ pages/         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ api/           # APIè°ƒç”¨å°è£…ï¼ˆè°ƒç”¨Serverï¼‰
â”‚   â”‚   â”œâ”€â”€ store/         # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ main/              # ä¸»è¿›ç¨‹ï¼ˆElectronï¼‰
â”‚   â”‚   â””â”€â”€ index.ts       # çª—å£ç®¡ç†ã€ç³»ç»Ÿæ‰˜ç›˜ç­‰
â”‚   â””â”€â”€ preload/           # é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ electron-builder.json  # æ‰“åŒ…é…ç½®
â””â”€â”€ package.json
```

### å…³é”®åŸåˆ™

| æ”¾åœ¨Client | æ”¾åœ¨Server |
|------------|------------|
| UIç»„ä»¶ã€é¡µé¢ | ç”¨æˆ·è®¤è¯ã€æƒé™æ ¡éªŒ |
| æœ¬åœ°ç¼“å­˜ | ä¸šåŠ¡é€»è¾‘ |
| APIè°ƒç”¨å°è£… | æ•°æ®åº“æ“ä½œ |
| çŠ¶æ€ç®¡ç† | è°ƒç”¨WauleAPI |
| æ–‡ä»¶ä¸Šä¼ UI | æ–‡ä»¶å¤„ç† |

---

## äº”ã€ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šServeråŸºç¡€

1. é¡¹ç›®åˆå§‹åŒ–ï¼ˆNestJS + Prisma + PostgreSQLï¼‰
2. ç”¨æˆ·è®¤è¯æ¨¡å—ï¼ˆæ³¨å†Œ/ç™»å½•/JWTï¼‰
3. WauleAPIå¯¹æ¥å°è£…

### ç¬¬äºŒé˜¶æ®µï¼šServerä¸šåŠ¡

4. ç§Ÿæˆ·ç®¡ç†
5. è®¡è´¹ç³»ç»Ÿ
6. å·¥ä½œæµå¼•æ“

### ç¬¬ä¸‰é˜¶æ®µï¼šClient

7. Electroné¡¹ç›®æ­å»º
8. ç”¨æˆ·ç•Œé¢å¼€å‘
9. å°ç»„ç®¡ç†ç«¯
10. æ‰“åŒ…æµ‹è¯•

---

## å…­ã€å¯åŠ¨å‘½ä»¤

### WauleAPI

```bash
cd /home/wauleapi
docker compose build wauleapi
docker compose up -d wauleapi
docker logs -f wauleapi
```

### ç®¡ç†åå°

è®¿é—®ï¼šhttp://æœåŠ¡å™¨IP:3100/static/manage.html

---

## ä¸ƒã€è‡ªç­¾åHTTPSæ–¹æ¡ˆ

### ä¸ºä»€ä¹ˆç”¨è‡ªç­¾åHTTPS

- **ä¸éœ€è¦åŸŸå** - ç›´æ¥ç”¨ IP:ç«¯å£ è®¿é—®
- **ä¸éœ€è¦å¤‡æ¡ˆ** - é¿å…å›½å†…åŸŸåå¤‡æ¡ˆæµç¨‹
- **æ•°æ®åŠ å¯†** - ä¼ è¾“å†…å®¹åŠ å¯†ï¼Œå®‰å…¨æ€§æœ‰ä¿éšœ
- **10å¹´æœ‰æ•ˆæœŸ** - ä¸€æ¬¡ç”Ÿæˆï¼Œé•¿æœŸä½¿ç”¨

### Serverç«¯é…ç½®

```bash
# 1. ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆ10å¹´æœ‰æ•ˆæœŸï¼‰
openssl req -x509 -nodes -days 3650 -newkey rsa:2048 \
  -keyout /path/to/server.key \
  -out /path/to/server.crt \
  -subj "/CN=waule-server"

# 2. æœåŠ¡å™¨é˜²ç«å¢™æ”¾å¼€ç«¯å£ï¼ˆå¦‚8443ï¼‰
# æ ¹æ®äº‘æœåŠ¡å•†ä¸åŒï¼Œåœ¨å®‰å…¨ç»„ä¸­æ·»åŠ å…¥ç«™è§„åˆ™
```

### Serverä»£ç é…ç½®ï¼ˆNestJSç¤ºä¾‹ï¼‰

```typescript
// main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import * as fs from 'fs';

async function bootstrap() {
  const httpsOptions = {
    key: fs.readFileSync('/path/to/server.key'),
    cert: fs.readFileSync('/path/to/server.crt'),
  };
  
  const app = await NestFactory.create(AppModule, { httpsOptions });
  app.enableCors();
  await app.listen(8443);
  console.log('Server running on https://0.0.0.0:8443');
}
bootstrap();
```

### Clientç«¯é…ç½®ï¼ˆElectronï¼‰

```typescript
// electron/main/index.ts
import { app } from 'electron';

// å¿½ç•¥è‡ªç­¾åè¯ä¹¦æ ¡éªŒ
app.commandLine.appendSwitch('ignore-certificate-errors');
```

```typescript
// src/api/config.ts
// ç›´æ¥ç”¨ IP + ç«¯å£ï¼Œä¸éœ€è¦åŸŸå
export const SERVER_URL = 'https://123.45.67.89:8443';
```

### è¿æ¥ç¤ºæ„

```
Client (exe)
    â”‚
    â”‚ https://æœåŠ¡å™¨IP:8443 (è‡ªç­¾åè¯ä¹¦)
    â–¼
Server (å›½å†…äº‘)
    â”‚
    â”‚ http://wauleapiå†…ç½‘IP:3100 (å†…ç½‘ä¸éœ€è¦åŠ å¯†)
    â–¼
WauleAPI (å›½å¤–äº‘)
```
