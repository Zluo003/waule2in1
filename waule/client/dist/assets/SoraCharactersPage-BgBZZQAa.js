import{d as I,r as o,j as e}from"./react-vendor-BvY2dB7B.js";import{b as d,c as l}from"./index-BGTeMuqS.js";import"./reactflow-D8v6_Qvs.js";import"./utils-BcyDR7Vi.js";const P="https://api.waule.ai",_=()=>{const u=I(),[h,v]=o.useState([]),[C,g]=o.useState(!0),[n,m]=o.useState(null),[c,f]=o.useState(""),[b,p]=o.useState(null),[U,j]=o.useState(!1);o.useEffect(()=>{x()},[]);const x=async()=>{try{g(!0);const t=await d.soraCharacters.list({limit:1e3});v(t.characters||[])}catch{l.error("加载角色失败")}finally{g(!1)}},N=async()=>{var t,a;if(!(!n||!c.trim())){if(c.trim()!==n.customName)try{const r=await d.soraCharacters.getByCustomName(c.trim());if(r!=null&&r.character){l.error("该自定义名称已被使用");return}}catch{}try{await d.soraCharacters.update(n.id,{customName:c.trim()}),l.success("名称更新成功"),m(null),x()}catch(r){l.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"更新失败")}}},E=async t=>{var a,r;if(confirm("确定要删除这个角色吗？"))try{await d.soraCharacters.delete(t),l.success("角色删除成功"),x()}catch(i){l.error(((r=(a=i.response)==null?void 0:a.data)==null?void 0:r.error)||"删除失败")}},S=async(t,a)=>{var r,i,w,y;if(!a.type.startsWith("image/")){l.error("请选择图片文件");return}p(t),j(!0);try{const s=await d.assets.upload(a),k=((r=s==null?void 0:s.data)==null?void 0:r.url)||(s==null?void 0:s.url)||((i=s==null?void 0:s.asset)==null?void 0:i.url);if(!k)throw new Error("上传失败：无法获取图片地址");await d.soraCharacters.update(t.id,{avatarUrl:k}),l.success("角色图片更新成功"),p(null),x()}catch(s){l.error(((y=(w=s.response)==null?void 0:w.data)==null?void 0:y.error)||"图片上传失败")}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-[#0a0a0b] p-6",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>u("/assets"),className:"p-2 hover:bg-slate-100 dark:hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-slate-600 dark:text-slate-400",children:"arrow_back"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-2xl",children:"face"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Sora角色库"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-gray-400",children:[h.length," 个角色"]})]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto",children:C?e.jsx("div",{className:"text-center py-12 text-slate-500 dark:text-gray-400",children:"加载中..."}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-amber-50 dark:bg-amber-900/20 flex items-center justify-center mb-6",children:e.jsx("span",{className:"material-symbols-outlined text-amber-400 text-5xl",children:"face"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mb-2",children:"还没有角色"}),e.jsx("p",{className:"text-slate-500 dark:text-gray-400 mb-6",children:"在工作流中使用Sora角色生成节点创建角色"}),e.jsx("button",{onClick:()=>u("/workflow"),className:"px-6 py-3 bg-gradient-to-r from-amber-400 to-orange-500 hover:shadow-lg text-white font-medium rounded-lg transition-all",children:"去创建角色"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:h.map(t=>e.jsxs("div",{className:"group relative bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-xl overflow-hidden hover:border-amber-400 dark:hover:border-amber-400/50 hover:shadow-lg transition-all duration-300",style:{height:"320px"},children:[e.jsxs("div",{className:"h-[80%] bg-gradient-to-b from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 flex items-start justify-center overflow-hidden relative",children:[t.avatarUrl?e.jsx("img",{src:t.avatarUrl.startsWith("http")?t.avatarUrl:`${P}${t.avatarUrl}`,alt:t.customName,className:"w-full h-full object-cover object-top"}):e.jsx("span",{className:"material-symbols-outlined text-6xl text-amber-300 dark:text-amber-600 mt-8",children:"face"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsxs("label",{className:"w-8 h-8 flex items-center justify-center bg-white/90 dark:bg-black/70 text-slate-600 dark:text-white rounded-full hover:bg-white dark:hover:bg-black shadow-md backdrop-blur-sm transition-all cursor-pointer",title:"更换图片",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"image"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:a=>{var i;const r=(i=a.target.files)==null?void 0:i[0];r&&S(t,r),a.target.value=""}})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),m(t),f(t.customName)},className:"w-8 h-8 flex items-center justify-center bg-white/90 dark:bg-black/70 text-slate-600 dark:text-white rounded-full hover:bg-white dark:hover:bg-black shadow-md backdrop-blur-sm transition-all",title:"编辑名称",children:e.jsx("span",{className:"material-symbols-outlined text-base",children:"edit"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),E(t.id)},className:"w-8 h-8 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full shadow-md backdrop-blur-sm transition-all",title:"删除角色",children:e.jsx("span",{className:"material-symbols-outlined text-base",children:"delete"})})]}),U&&(b==null?void 0:b.id)===t.id&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx("div",{className:"text-white text-sm",children:"上传中..."})})]}),e.jsx("div",{className:"h-[20%] px-3 py-2 flex flex-col justify-center",children:(n==null?void 0:n.id)===t.id?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"text",value:c,onChange:a=>f(a.target.value),className:"flex-1 px-2 py-1 text-xs rounded border border-amber-300 dark:border-amber-600 bg-white dark:bg-black/50 text-slate-700 dark:text-white",autoFocus:!0,onKeyDown:a=>{a.key==="Enter"&&N(),a.key==="Escape"&&m(null)}}),e.jsx("button",{onClick:N,className:"px-2 py-1 text-xs bg-amber-500 text-white rounded hover:bg-amber-600",children:"✓"}),e.jsx("button",{onClick:()=>m(null),className:"px-2 py-1 text-xs bg-slate-200 dark:bg-white/10 text-slate-600 dark:text-white rounded",children:"✕"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-sm text-slate-800 dark:text-white truncate",children:t.customName}),e.jsx("div",{className:"text-[11px] text-amber-600 dark:text-amber-400 font-mono truncate",children:t.characterName})]})})]},t.id))})})]})};export{_ as default};
