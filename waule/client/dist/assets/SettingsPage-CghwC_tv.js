import{r as s,j as e}from"./react-vendor-CnSaCHf4.js";import{u as O,c as g}from"./index-Cp0uMTfX.js";import"./reactflow-COwzeFBM.js";import"./utils-BcyDR7Vi.js";const ee=()=>{const{user:t,updateUser:y,refreshUser:N,clearAuth:B}=O(),[l,G]=s.useState((t==null?void 0:t.nickname)||""),[h,n]=s.useState(""),[j,b]=s.useState(""),[v,w]=s.useState(!1),[S,P]=s.useState(!1),[C,I]=s.useState(!1),E=s.useRef(null),[m,A]=s.useState(""),[c,R]=s.useState(""),[u,_]=s.useState(""),[U,i]=s.useState(""),[V,k]=s.useState(""),[M,T]=s.useState(!1),[f,z]=s.useState(!1),[p,J]=s.useState(!1);s.useEffect(()=>{N().then(()=>{})},[]);const W=r=>({ADMIN:"管理员",USER:"普通用户",VIP:"VIP用户",SVIP:"SVIP用户",INTERNAL:"内部用户"})[r]||r,$=r=>({ADMIN:"bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-400 border-red-500/30",USER:"bg-gray-500/10 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400 border-gray-500/30",VIP:"bg-amber-500/10 dark:bg-amber-500/20 text-amber-600 dark:text-amber-400 border-amber-500/30",SVIP:"bg-tiffany-500/10 dark:bg-tiffany-500/20 text-tiffany-600 dark:text-tiffany-400 border-tiffany-500/30",INTERNAL:"bg-blue-500/10 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400 border-blue-500/30"})[r]||"bg-gray-500/10 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400 border-gray-500/30",F=async r=>{if(!r||r.trim().length===0)return n("昵称不能为空"),!1;if(r.length>20)return n("昵称长度不能超过20个字符"),!1;if(r===(t==null?void 0:t.nickname))return n(""),!0;w(!0);try{const a=await g.user.checkNickname(r);return a.available?(n(""),!0):(n(a.message||"该昵称已被使用"),!1)}catch{return n("检查昵称失败，请稍后重试"),!1}finally{w(!1)}},q=async()=>{var a,d;if(!(l===(t==null?void 0:t.nickname)||!await F(l))){P(!0);try{const o=await g.user.updateProfile({nickname:l});o.success?(y(o.data),b("昵称更新成功"),n(""),setTimeout(()=>b(""),3e3)):n(o.message||"更新失败")}catch(o){n(((d=(a=o.response)==null?void 0:a.data)==null?void 0:d.message)||"更新失败，请稍后重试")}finally{P(!1)}}},H=async()=>{var r,a;if(i(""),k(""),!m){i("请输入当前密码");return}if(!c){i("请输入新密码");return}if(c.length<6){i("新密码长度不能少于6位");return}if(c!==u){i("两次输入的新密码不一致");return}T(!0);try{const d=await g.user.changePassword({currentPassword:m,newPassword:c});d.success?(k("密码修改成功"),A(""),R(""),_(""),setTimeout(()=>k(""),3e3)):i(d.message||"修改失败")}catch(d){i(((a=(r=d.response)==null?void 0:r.data)==null?void 0:a.message)||"修改失败，请稍后重试")}finally{T(!1)}},K=async r=>{var o,L,D;const a=(o=r.target.files)==null?void 0:o[0];if(!a)return;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type)){alert("只支持 JPG、PNG、GIF 和 WebP 格式的图片");return}if(a.size>5*1024*1024){alert("图片大小不能超过 5MB");return}I(!0);try{const x=await g.user.uploadAvatar(a);x.success?(y(x.data),alert("头像上传成功")):alert(x.message||"上传失败")}catch(x){alert(((D=(L=x.response)==null?void 0:L.data)==null?void 0:D.message)||"上传失败，请稍后重试")}finally{I(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-8 bg-background-light dark:bg-background-dark",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsxs("div",{className:"bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-3xl shadow-soft-lg overflow-hidden",children:[e.jsx("div",{className:"h-32 bg-gradient-to-r from-pink-500/20 dark:from-pink-500/20 from-pink-200/50 via-purple-500/20 dark:via-purple-500/20 via-purple-200/50 to-cyan-500/20 dark:to-cyan-500/20 to-cyan-200/50 relative",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-white/10 dark:via-black/10 to-transparent"})}),e.jsxs("div",{className:"relative px-8 pb-8",children:[e.jsx("div",{className:"flex justify-center -mt-16 mb-6",children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-card-light dark:border-card-dark bg-background-light-secondary dark:bg-background-dark-secondary overflow-hidden shadow-soft-lg",children:t!=null&&t.avatar?e.jsx("img",{src:t.avatar,alt:t.nickname||t.username,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-6xl text-text-light-tertiary dark:text-text-dark-tertiary",children:"account_circle"})})}),e.jsx("button",{onClick:()=>{var r;return(r=E.current)==null?void 0:r.click()},disabled:C,className:"absolute bottom-0 right-0 w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 flex items-center justify-center shadow-md hover:shadow-lg transform hover:scale-110 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed border border-transparent dark:border-white/10",children:C?e.jsx("span",{className:"material-symbols-outlined text-white text-xl animate-spin",children:"progress_activity"}):e.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"photo_camera"})}),e.jsx("input",{ref:E,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:K,className:"hidden"})]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:(t==null?void 0:t.nickname)||(t==null?void 0:t.username)||"未命名用户"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4",children:[e.jsx("div",{className:`px-4 py-1.5 rounded-full border font-medium text-sm ${$((t==null?void 0:t.role)||"USER")}`,children:W((t==null?void 0:t.role)||"USER")}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5 rounded-full bg-accent-500/10 dark:bg-accent-500/20 border border-accent-500/30",children:[e.jsx("span",{className:"material-symbols-outlined text-accent-600 dark:text-accent-400 text-lg",children:"stars"}),e.jsxs("span",{className:"text-accent-600 dark:text-accent-400 font-semibold",children:[(t==null?void 0:t.credits)||0," 积分"]}),e.jsx("button",{onClick:()=>N(),className:"ml-2 p-1 hover:bg-accent-500/20 rounded-full transition-colors",title:"刷新积分",children:e.jsx("span",{className:"material-symbols-outlined text-accent-600 dark:text-accent-400 text-sm",children:"refresh"})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-3",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"badge"}),"自定义昵称"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:l,onChange:r=>{G(r.target.value),n(""),b("")},onBlur:()=>{l&&l!==(t==null?void 0:t.nickname)&&F(l)},maxLength:20,className:"w-full px-4 py-3 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-xl text-text-light-primary dark:text-text-dark-primary placeholder-text-light-tertiary dark:placeholder-text-dark-tertiary focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"输入你的昵称"}),v&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("span",{className:"material-symbols-outlined text-text-light-tertiary dark:text-text-dark-tertiary text-xl animate-spin",children:"progress_activity"})})]}),e.jsx("button",{onClick:q,disabled:S||v||!l||l===(t==null?void 0:t.nickname)||!!h,className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 text-white rounded-xl font-medium shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center gap-2 border border-transparent dark:border-white/10",children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-xl animate-spin",children:"progress_activity"}),"保存中"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"check"}),"保存"]})})]}),h&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-red-400 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"error"}),h]}),j&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-green-400 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"check_circle"}),j]}),e.jsxs("div",{className:"mt-2 text-xs text-text-light-tertiary dark:text-text-dark-tertiary",children:[l.length,"/20 个字符"]})]}),e.jsxs("div",{className:"pt-6 border-t border-border-light dark:border-border-dark",children:[e.jsxs("h3",{className:"text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"info"}),"账号信息"]}),e.jsxs("div",{className:"space-y-3",children:[(t==null?void 0:t.phone)&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-background-light-secondary dark:bg-background-dark-secondary rounded-lg",children:[e.jsx("span",{className:"text-text-light-secondary dark:text-text-dark-secondary text-sm",children:"手机号"}),e.jsx("span",{className:"text-text-light-primary dark:text-text-dark-primary font-medium",children:t.phone})]}),(t==null?void 0:t.email)&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-background-light-secondary dark:bg-background-dark-secondary rounded-lg",children:[e.jsx("span",{className:"text-text-light-secondary dark:text-text-dark-secondary text-sm",children:"邮箱"}),e.jsx("span",{className:"text-text-light-primary dark:text-text-dark-primary font-medium",children:t.email})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-background-light-secondary dark:bg-background-dark-secondary rounded-lg",children:[e.jsx("span",{className:"text-text-light-secondary dark:text-text-dark-secondary text-sm",children:"用户ID"}),e.jsx("span",{className:"text-text-light-primary dark:text-text-dark-primary font-mono text-xs",children:t==null?void 0:t.id})]})]})]}),(t==null?void 0:t.loginType)==="ADMIN"&&e.jsxs("div",{className:"pt-6 border-t border-border-light dark:border-border-dark",children:[e.jsxs("h3",{className:"text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"lock"}),"修改密码"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:f?"text":"password",value:m,onChange:r=>{A(r.target.value),i("")},className:"w-full px-4 py-3 pr-12 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-xl text-text-light-primary dark:text-text-dark-primary placeholder-text-light-tertiary dark:placeholder-text-dark-tertiary focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"当前密码"}),e.jsx("button",{type:"button",onClick:()=>z(!f),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-light-tertiary dark:text-text-dark-tertiary hover:text-text-light-primary dark:hover:text-text-dark-primary",children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:f?"visibility_off":"visibility"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:p?"text":"password",value:c,onChange:r=>{R(r.target.value),i("")},className:"w-full px-4 py-3 pr-12 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-xl text-text-light-primary dark:text-text-dark-primary placeholder-text-light-tertiary dark:placeholder-text-dark-tertiary focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"新密码（至少6位）"}),e.jsx("button",{type:"button",onClick:()=>J(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-light-tertiary dark:text-text-dark-tertiary hover:text-text-light-primary dark:hover:text-text-dark-primary",children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:p?"visibility_off":"visibility"})})]}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:p?"text":"password",value:u,onChange:r=>{_(r.target.value),i("")},className:"w-full px-4 py-3 pr-12 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-xl text-text-light-primary dark:text-text-dark-primary placeholder-text-light-tertiary dark:placeholder-text-dark-tertiary focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"确认新密码"})}),U&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"error"}),U]}),V&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"check_circle"}),V]}),e.jsx("button",{onClick:H,disabled:M||!m||!c||!u,className:"w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 text-white rounded-xl font-medium shadow-md hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2 border border-transparent dark:border-white/10",children:M?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-xl animate-spin",children:"progress_activity"}),"修改中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"check"}),"确认修改"]})})]})]}),e.jsx("div",{className:"pt-6 border-t border-border-light dark:border-border-dark",children:e.jsxs("button",{onClick:B,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-red-500/10 hover:bg-red-500/20 text-red-500 dark:text-red-400 font-medium transition-all duration-200",children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"20px",fontVariationSettings:'"FILL" 0, "wght" 300'},children:"logout"}),"退出登录"]})})]})]})]})})})};export{ee as default};
