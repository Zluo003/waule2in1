import{d as me,r,j as e,R}from"./react-vendor-BvY2dB7B.js";import{b as h,c as d}from"./index-BGTeMuqS.js";import"./reactflow-D8v6_Qvs.js";import"./utils-BcyDR7Vi.js";const Y="https://api.waule.ai",be=({value:u,onChange:g,options:O})=>{const[N,S]=r.useState(!1),L=r.useRef(null),[p,A]=r.useState(!1);r.useEffect(()=>{const i=()=>{A(document.documentElement.classList.contains("dark"))};i();const v=new MutationObserver(i);return v.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>v.disconnect()},[]),r.useEffect(()=>{const i=v=>{L.current&&!L.current.contains(v.target)&&S(!1)};return N&&document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[N]);const f=O.find(i=>i.value===u);return e.jsxs("div",{ref:L,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>S(!N),className:"absolute right-0 top-0 bottom-0 px-4 bg-neutral-800 dark:bg-white text-white dark:text-black rounded-r-full text-xs cursor-pointer flex items-center gap-1 min-w-[100px] justify-center",style:{outline:"none !important",boxShadow:"none !important",border:"none",color:p?"white":"black"},children:[e.jsx("span",{className:"whitespace-nowrap",style:{color:p?"white":"black"},children:f==null?void 0:f.label}),e.jsx("span",{className:"material-symbols-outlined text-xs",style:{fontVariationSettings:'"FILL" 0, "wght" 200',color:p?"white":"black"},children:N?"expand_less":"expand_more"})]}),N&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-32 rounded-lg shadow-lg border border-slate-200 dark:border-white/10 py-1 z-50",style:{backgroundColor:p?"#0f0f10":"#f3f5f5"},children:O.map(i=>e.jsx("button",{type:"button",onClick:()=>{g(i.value),S(!1)},className:`w-full px-3 py-2 text-left text-xs transition-colors ${u===i.value?"bg-slate-200 dark:bg-white/10 text-slate-900 dark:text-white font-medium":"text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-white/10"}`,children:i.label},i.value))})]})},te=({isEdit:u=!1,libraryId:g,onSubmit:O,onClose:N,formData:S,setFormData:L,thumbnail:p,setThumbnail:A})=>{const f=R.useRef(null),[i,v]=R.useState(!1),[T,j]=R.useState([]),[D,z]=R.useState(""),[M,F]=R.useState([]),[k,V]=R.useState(!1),[I,w]=R.useState(!1),H=R.useRef(null);R.useEffect(()=>{u&&g&&B()},[u,g]);const B=async()=>{if(g)try{const a=await h.assetLibraries.getCollaborators(g);j(a.data||[])}catch{}},G=async a=>{if(z(a),H.current&&clearTimeout(H.current),!a.startsWith("@")){F([]),w(!1);return}const n=a.slice(1).trim();H.current=setTimeout(async()=>{V(!0);try{const m=await h.assetLibraries.searchUsers(n||""),c=new Set(T.map(E=>E.id)),y=(m.data||[]).filter(E=>!c.has(E.id)).slice(0,5);F(y),w(!0)}catch{}finally{V(!1)}},200)},x=async a=>{var n,m;if(g)try{await h.assetLibraries.addCollaborator(g,a.id,!0),j(c=>[...c,{id:a.id,nickname:a.nickname,avatar:a.avatar,canDownload:!0}]),z(""),F([]),w(!1),d.success(`已添加协作者: ${a.nickname||a.username}`)}catch(c){d.error(((m=(n=c.response)==null?void 0:n.data)==null?void 0:m.message)||"添加协作者失败")}},W=async a=>{var n,m;if(g)try{await h.assetLibraries.removeCollaborator(g,a),j(c=>c.filter(y=>y.id!==a)),d.success("已移除协作者")}catch(c){d.error(((m=(n=c.response)==null?void 0:n.data)==null?void 0:m.message)||"移除协作者失败")}},J=async a=>{var m,c;const n=(m=a.target.files)==null?void 0:m[0];if(n){if(!n.type.startsWith("image/")){d.error("请选择图片文件");return}if(n.size>10*1024*1024){d.error("图片大小不能超过 10MB");return}v(!0);try{const y=await h.assets.upload(n);y.success&&((c=y.data)!=null&&c.url)?(A(y.data.url),d.success("封面上传成功")):d.error("上传失败")}catch(y){d.error(y.message||"上传失败")}finally{v(!1)}}},U=()=>{A(null),f.current&&(f.current.value="")};return e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`bg-white/90 dark:bg-black/70 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl p-6 ${u?"w-[800px]":"w-[640px]"} max-w-[95vw] shadow-lg max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:u?"编辑资产库":"创建资产库"}),e.jsx("button",{onClick:N,type:"button",className:"p-1.5 rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-base",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}),e.jsxs("form",{onSubmit:O,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"资产库名称 *"}),e.jsx("input",{type:"text",required:!0,value:S.name,onChange:a=>L(n=>({...n,name:a.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-neutral-500 focus:border-neutral-500",placeholder:"例如: 角色素材库",maxLength:100})]}),e.jsxs("div",{className:u?"grid grid-cols-2 gap-4":"",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"封面图片"}),e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:J,className:"hidden"}),i?e.jsxs("div",{className:"w-full aspect-[16/9] border-2 border-dashed border-neutral-400 dark:border-neutral-400/50 rounded-md flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl text-neutral-500 animate-spin",children:"progress_activity"}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"正在上传..."})]}):p?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:p,alt:"封面预览",className:"w-full aspect-[16/9] object-cover rounded-md border-2 border-slate-200 dark:border-white/10"}),e.jsx("button",{type:"button",onClick:U,className:"absolute top-2 right-2 w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-all opacity-0 group-hover:opacity-100 shadow-md",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}):e.jsxs("button",{type:"button",onClick:()=>{var a;return(a=f.current)==null?void 0:a.click()},className:"w-full aspect-[16/9] border-2 border-dashed border-slate-300 dark:border-white/20 rounded-md hover:border-neutral-400 dark:hover:border-neutral-400/50 transition-colors flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl text-slate-400 dark:text-white/50",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"add_photo_alternate"}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"点击上传封面"})]})]}),u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"协作者管理"}),e.jsxs("div",{className:"aspect-[16/9] border-2 border-slate-200 dark:border-white/10 rounded-md bg-slate-100 dark:bg-white/5 p-2 flex flex-col",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("input",{type:"text",value:D,onChange:a=>G(a.target.value),onFocus:()=>D&&w(!0),placeholder:"@用户昵称 添加协作者",className:"w-full px-3 py-1.5 bg-white dark:bg-black/30 border border-slate-200 dark:border-white/10 rounded text-sm text-slate-800 dark:text-white placeholder:text-slate-400 focus:outline-none focus:ring-1 focus:ring-neutral-500"}),k&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 material-symbols-outlined text-sm animate-spin text-slate-400",children:"progress_activity"}),I&&M.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-white/10 rounded-md shadow-lg max-h-32 overflow-y-auto",children:M.map(a=>e.jsxs("button",{type:"button",onClick:()=>x(a),className:"w-full px-3 py-2 flex items-center gap-2 hover:bg-slate-100 dark:hover:bg-white/10 text-left",children:[a.avatar?e.jsx("img",{src:a.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"account_circle"}),e.jsx("span",{className:"text-sm text-slate-800 dark:text-white",children:a.nickname||a.username})]},a.id))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:T.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"暂无协作者"}):e.jsx("div",{className:"grid grid-cols-2 gap-1",children:T.map(a=>e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-1 bg-white dark:bg-black/20 rounded",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[a.avatar?e.jsx("img",{src:a.avatar,alt:"",className:"w-4 h-4 rounded-full object-cover flex-shrink-0"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm flex-shrink-0",children:"account_circle"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300 truncate",children:a.nickname||"未命名"})]}),e.jsx("button",{type:"button",onClick:()=>W(a.id),className:"p-0.5 text-red-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded flex-shrink-0",children:e.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},a.id))})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"描述"}),e.jsx("textarea",{value:S.description,onChange:a=>L(n=>({...n,description:a.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-neutral-500 focus:border-neutral-500 resize-none",rows:2,placeholder:"简要描述资产库用途...",maxLength:500})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"分类"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:["ROLE","SCENE","PROP","AUDIO","OTHER"].map(a=>e.jsxs("button",{type:"button",onClick:()=>L(n=>({...n,category:a})),className:`py-3 rounded-lg border transition-all text-center ${S.category===a?"border-neutral-800 dark:border-white bg-neutral-100 dark:bg-white/20":"border-slate-200 dark:border-white/10 hover:border-neutral-400"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-slate-800 dark:text-white text-lg",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:a==="ROLE"?"person":a==="SCENE"?"landscape":a==="PROP"?"inventory_2":a==="AUDIO"?"music_note":"widgets"}),e.jsx("div",{className:"text-xs font-medium text-slate-800 dark:text-white mt-1",children:a==="ROLE"?"角色":a==="SCENE"?"场景":a==="PROP"?"道具":a==="AUDIO"?"音频":"其他"})]},a))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 px-3 py-2 bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white rounded-md hover:bg-slate-200 dark:hover:bg-white/10 transition-all border border-slate-200 dark:border-white/10",children:"取消"}),e.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 bg-neutral-800 dark:bg-white hover:bg-neutral-700 dark:hover:bg-neutral-200 text-white dark:text-black rounded-md transition-all font-medium active:scale-95",children:u?"保存更改":"创建资产库"})]})]})]})})},we=()=>{const u=me(),[g,O]=r.useState([]),[N,S]=r.useState(!0),[L,p]=r.useState(!1),[A,f]=r.useState(!1),[i,v]=r.useState(null),[T,j]=r.useState(null),[D,z]=r.useState(""),[M,F]=r.useState(!1),[k,V]=r.useState("ALL"),[I,w]=r.useState({name:"",description:"",category:"OTHER"}),H=r.useRef(!1),[B,G]=r.useState(0),[x,W]=r.useState(()=>{try{return localStorage.getItem("soraLibraryCover")||"/sora-library.jpg"}catch{return"/sora-library.jpg"}}),[J,U]=r.useState(!1),[a,n]=r.useState([]),[m,c]=r.useState(""),[y,E]=r.useState([]),[ae,Z]=r.useState(!1),[se,P]=r.useState(!1),[re,K]=r.useState(!1),X=r.useRef(null);r.useEffect(()=>{$(),q()},[]),r.useEffect(()=>{$(!0)},[k]);const q=async()=>{var t;try{const s=await h.soraCharacters.list({limit:1e3});G((s.characters||[]).length);const l=await h.soraCharacters.getShareInfo();K(((t=l.data)==null?void 0:t.hasCollaborators)||!1)}catch{}},le=async()=>{try{const t=await h.soraCharacters.getCollaborators();n(t.data||[])}catch{}},oe=async t=>{if(c(t),X.current&&clearTimeout(X.current),!t.startsWith("@")){E([]),P(!1);return}const s=t.slice(1).trim();X.current=setTimeout(async()=>{Z(!0);try{const l=await h.soraCharacters.searchUsers(s||""),o=new Set(a.map(C=>C.id)),b=(l.data||[]).filter(C=>!o.has(C.id)).slice(0,5);E(b),P(!0)}catch{}finally{Z(!1)}},200)},ne=async t=>{var s,l;try{await h.soraCharacters.addCollaborator(t.id),n(o=>[...o,{id:t.id,nickname:t.nickname,avatar:t.avatar}]),c(""),E([]),P(!1),K(!0),d.success(`已添加协作者: ${t.nickname||t.username}`)}catch(o){d.error(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.error)||"添加协作者失败")}},ie=async t=>{var s,l;try{await h.soraCharacters.removeCollaborator(t);const o=a.filter(b=>b.id!==t);n(o),K(o.length>0),d.success("已移除协作者")}catch(o){d.error(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.error)||"移除协作者失败")}},de=()=>{le(),U(!0)},$=async(t=!1)=>{if(!(!t&&H.current)){H.current=!0,S(!0);try{const s={includeShared:"true"};k!=="ALL"&&(s.category=k);const l=await h.assetLibraries.getAll(s);O((l==null?void 0:l.data)||[])}catch{O([])}finally{S(!1),H.current=!1}}},ce=async t=>{var s,l;if(t.preventDefault(),!I.name.trim()){d.error("请输入资产库名称");return}try{if(M)return;F(!0);const o={...I,thumbnail:T||void 0},b=await h.assetLibraries.create(o);d.success("资产库创建成功！"),p(!1),w({name:"",description:"",category:"OTHER"}),j(null),u(`/assets/${b.data.id}`)}catch(o){d.error(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||"创建失败")}finally{F(!1)}},xe=async t=>{var s,l;if(t.preventDefault(),!!i)try{const o={...I,thumbnail:T||void 0},b=await h.assetLibraries.update(i.id,o),C=b!=null&&b.data&&b.data.data?b.data.data:null;O(Q=>Q.map(_=>_.id===i.id?{..._,name:o.name??_.name,description:o.description??_.description,thumbnail:((C==null?void 0:C.thumbnail)??o.thumbnail??_.thumbnail)||null,category:o.category??_.category,updatedAt:new Date().toISOString()}:_)),d.success("资产库更新成功！"),f(!1),v(null),w({name:"",description:"",category:"OTHER"}),j(null),await $(!0)}catch(o){d.error(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||"更新失败")}},he=async t=>{if(confirm("确定要删除这个资产库吗？资产库中的所有资产都会被删除！"))try{await h.assetLibraries.delete(t),d.success("资产库删除成功"),$()}catch{d.error("删除失败")}},ue=t=>{v(t),w({name:t.name,description:t.description||""}),j(t.thumbnail||null),f(!0)},ee=g.filter(t=>{var s;if(D){const l=D.toLowerCase();return t.name.toLowerCase().includes(l)||((s=t.description)==null?void 0:s.toLowerCase().includes(l))}return!0});return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-8 mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-text-light-primary dark:text-text-dark-primary whitespace-nowrap",children:"资产库"}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md flex items-center",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 text-text-light-tertiary dark:text-text-dark-tertiary",children:"search"}),e.jsx("input",{type:"text",placeholder:"搜索资产库...",value:D,onChange:t=>z(t.target.value),className:"pl-12 pr-28 py-2.5 w-full bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-full text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary outline-none transition-all",style:{outline:"none",boxShadow:"none"}}),e.jsx(be,{value:k,onChange:t=>V(t),options:[{value:"ALL",label:"全部"},{value:"ROLE",label:"角色库"},{value:"SCENE",label:"场景库"},{value:"PROP",label:"道具库"},{value:"AUDIO",label:"音频库"},{value:"OTHER",label:"其它"}]})]})}),e.jsxs("div",{className:"group relative",children:[e.jsx("button",{onClick:()=>p(!0),className:"w-10 h-10 rounded-lg bg-slate-100 dark:bg-white/10 text-black dark:text-white border border-slate-400 dark:border-white/30 hover:bg-gradient-to-r hover:bg-neutral-800 hover:text-white hover:border-transparent hover:scale-105 transition-all flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-lg",style:{fontVariationSettings:'"FILL" 0, "wght" 500'},children:"add"})}),e.jsx("span",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50",children:"创建资产库"})]})]}),N?e.jsx("div",{className:"text-center py-12 text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."}):g.length===0&&k!=="ALL"&&k!=="ROLE"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-tiffany-50 dark:bg-tiffany-500/10 flex items-center justify-center mb-6 shadow-tiffany",children:e.jsx("span",{className:"material-symbols-outlined text-tiffany-600 dark:text-tiffany-400 text-5xl",children:"photo_library"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"还没有资产库"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:"创建你的第一个资产库来管理素材"}),e.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg text-white font-medium rounded-lg transition-all active:scale-95",children:"立即创建"})]}):ee.length===0&&k!=="ALL"&&k!=="ROLE"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gray-50 dark:bg-gray-500/10 flex items-center justify-center mb-6",children:e.jsx("span",{className:"material-symbols-outlined text-gray-400 dark:text-gray-500 text-5xl",children:"search_off"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"没有找到资产库"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:"尝试使用其他关键词搜索"}),e.jsx("button",{onClick:()=>z(""),className:"px-6 py-3 bg-card-light dark:bg-card-dark text-text-light-primary dark:text-text-dark-primary font-medium rounded-lg hover:bg-card-light-hover dark:hover:bg-card-dark-hover transition-all border border-border-light dark:border-border-dark",children:"清除搜索"})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[(k==="ALL"||k==="ROLE")&&e.jsxs("div",{onClick:()=>u("/assets/sora-characters"),className:"relative border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden hover:border-neutral-400 dark:hover:border-neutral-600 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer aspect-[4/3]",children:[e.jsx("div",{className:"absolute inset-0",children:x?e.jsx("img",{src:x.startsWith("data:")||x.startsWith("http")||x.startsWith("/")?x:`${Y}${x}`,alt:"Sora角色库",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-900",children:e.jsx("span",{className:"material-symbols-outlined text-3xl text-neutral-400 dark:text-neutral-600",children:"face"})})}),e.jsx("div",{className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1.5 z-10",children:e.jsx("button",{onClick:t=>{t.stopPropagation(),de()},className:"w-7 h-7 flex items-center justify-center bg-black/60 dark:bg-white/80 hover:bg-black dark:hover:bg-white text-white dark:text-black rounded-full transition-all backdrop-blur-sm shadow-md active:scale-95 cursor-pointer",title:"编辑Sora角色库",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})})}),re&&e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 rounded-lg text-xs font-medium text-white bg-black/50 dark:bg-white/20 backdrop-blur-sm flex items-center gap-1 z-10",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"share"}),"已共享"]}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 p-3 bg-white/50 dark:bg-black/50 backdrop-blur-md rounded-xl z-10",children:[e.jsx("h3",{className:"font-semibold text-sm text-neutral-900 dark:text-white truncate",children:"Sora角色库"}),e.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-0.5",children:["已创建 ",B," 个Sora专用角色"]})]})]}),ee.map(t=>e.jsxs("div",{onClick:()=>u(`/assets/${t.id}`),className:"relative border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden hover:border-neutral-400 dark:hover:border-neutral-600 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer aspect-[4/3]",children:[e.jsx("div",{className:"absolute inset-0",children:t.thumbnail?e.jsx("img",{src:t.thumbnail.startsWith("data:")||t.thumbnail.startsWith("http")?t.thumbnail:`${Y}${t.thumbnail}`,alt:t.name,className:"w-full h-full object-cover",onError:s=>{s.currentTarget.style.display="none"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-900",children:e.jsx("span",{className:"material-symbols-outlined text-3xl text-neutral-400 dark:text-neutral-600",children:(t.category??"OTHER")==="ROLE"?"person":(t.category??"OTHER")==="SCENE"?"landscape":(t.category??"OTHER")==="PROP"?"inventory_2":(t.category??"OTHER")==="AUDIO"?"music_note":"widgets"})})}),t.isOwner!==!1&&e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),ue(t)},className:"w-7 h-7 flex items-center justify-center bg-black/60 dark:bg-white/80 hover:bg-black dark:hover:bg-white text-white dark:text-black rounded-full transition-all backdrop-blur-sm shadow-md active:scale-95",title:"编辑资产库",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),he(t.id)},className:"w-7 h-7 flex items-center justify-center bg-black/60 dark:bg-white/80 hover:bg-black dark:hover:bg-white text-white dark:text-black rounded-full transition-all backdrop-blur-sm shadow-md active:scale-95",title:"删除资产库",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete"})})]}),t.isShared&&e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 rounded-lg text-xs font-medium text-white bg-black/50 dark:bg-white/20 backdrop-blur-sm flex items-center gap-1 z-10",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"group"}),"共享"]}),t.hasCollaborators&&!t.isShared&&e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 rounded-lg text-xs font-medium text-white bg-black/50 dark:bg-white/20 backdrop-blur-sm flex items-center gap-1 z-10",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"share"}),"已共享"]}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 p-3 bg-white/50 dark:bg-black/50 backdrop-blur-md rounded-xl z-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-sm text-neutral-900 dark:text-white truncate flex-1",children:t.name}),e.jsx("span",{className:`ml-2 px-1.5 py-0.5 rounded text-[10px] font-medium ${(t.category??"OTHER")==="ROLE"?"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300":(t.category??"OTHER")==="SCENE"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300":(t.category??"OTHER")==="PROP"?"bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300":(t.category??"OTHER")==="AUDIO"?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,children:(t.category??"OTHER")==="ROLE"?"角色":(t.category??"OTHER")==="SCENE"?"场景":(t.category??"OTHER")==="PROP"?"道具":(t.category??"OTHER")==="AUDIO"?"音频":"其他"})]}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-0.5 truncate",children:t.description||`${t._count.assets} 个资产`})]})]},t.id))]}),L&&e.jsx(te,{isEdit:!1,onSubmit:ce,formData:I,setFormData:w,thumbnail:T,setThumbnail:j,onClose:()=>{p(!1),w({name:"",description:"",category:"OTHER"}),j(null)}}),A&&i&&e.jsx(te,{isEdit:!0,libraryId:i.id,onSubmit:xe,formData:I,setFormData:w,thumbnail:T,setThumbnail:j,onClose:()=>{f(!1),v(null),w({name:"",description:"",category:"OTHER"}),j(null),$(!0)}}),J&&e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/70 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl p-6 w-[500px] max-w-[95vw] shadow-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"编辑Sora角色库"}),e.jsx("button",{onClick:()=>{U(!1),c(""),E([]),P(!1)},className:"p-1.5 rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-base",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"封面图片"}),e.jsx("div",{className:"relative group",children:x?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:x.startsWith("data:")||x.startsWith("http")||x.startsWith("/")?x:`${Y}${x}`,alt:"Sora角色库封面",className:"w-full aspect-[16/9] object-cover rounded-md border-2 border-slate-200 dark:border-white/10"}),x!=="/sora-library.jpg"&&e.jsx("button",{type:"button",onClick:()=>{W("/sora-library.jpg");try{localStorage.removeItem("soraLibraryCover")}catch{}},className:"absolute top-2 right-2 w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-all opacity-0 group-hover:opacity-100 shadow-md",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}):e.jsxs("label",{className:"w-full aspect-[16/9] border-2 border-dashed border-slate-300 dark:border-white/20 rounded-md hover:border-neutral-400 dark:hover:border-neutral-400/50 transition-colors flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl text-slate-400 dark:text-white/50",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"add_photo_alternate"}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"点击上传封面"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var l;const s=(l=t.target.files)==null?void 0:l[0];if(s){const o=new FileReader;o.onload=b=>{var C,Q;W((C=b.target)==null?void 0:C.result);try{localStorage.setItem("soraLibraryCover",(Q=b.target)==null?void 0:Q.result)}catch{}},o.readAsDataURL(s)}}})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"协作者管理"}),e.jsxs("div",{className:"border-2 border-slate-200 dark:border-white/10 rounded-md bg-slate-100 dark:bg-white/5 p-3",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("input",{type:"text",value:m,onChange:t=>oe(t.target.value),onFocus:()=>m&&P(!0),placeholder:"@用户昵称 添加协作者",className:"w-full px-3 py-2 bg-white dark:bg-black/30 border border-slate-200 dark:border-white/10 rounded text-sm text-slate-800 dark:text-white placeholder:text-slate-400 focus:outline-none focus:ring-1 focus:ring-neutral-500"}),ae&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 material-symbols-outlined text-sm animate-spin text-slate-400",children:"progress_activity"}),se&&y.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-white/10 rounded-md shadow-lg max-h-40 overflow-y-auto",children:y.map(t=>e.jsxs("button",{type:"button",onClick:()=>ne(t),className:"w-full px-3 py-2 flex items-center gap-2 hover:bg-slate-100 dark:hover:bg-white/10 text-left",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"account_circle"}),e.jsx("span",{className:"text-sm text-slate-800 dark:text-white",children:t.nickname||t.username})]},t.id))})]}),e.jsx("div",{className:"min-h-[80px] max-h-[160px] overflow-y-auto",children:a.length===0?e.jsx("div",{className:"h-20 flex items-center justify-center text-xs text-slate-400",children:"暂无协作者，协作者可以在工作流中使用你的Sora角色"}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.map(t=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5 bg-white dark:bg-black/20 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:"",className:"w-5 h-5 rounded-full object-cover flex-shrink-0"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-base flex-shrink-0",children:"account_circle"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300 truncate",children:t.nickname||"未命名"})]}),e.jsx("button",{type:"button",onClick:()=>ie(t.id),className:"p-0.5 text-red-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded flex-shrink-0",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"close"})})]},t.id))})})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-500 dark:text-slate-400",children:"共享后，协作者可以在工作流中@引用你的Sora角色"})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{U(!1),c(""),E([]),P(!1),q()},className:"w-full px-4 py-2 bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg text-white rounded-md transition-all font-medium active:scale-95",children:"完成"})})]})})]})};export{we as default};
