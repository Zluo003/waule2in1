import{R as k,r as M,j as r}from"./react-vendor-BvY2dB7B.js";import{u as ge,b as U,c as L}from"./index-bQ3BRhJc.js";import"./reactflow-D8v6_Qvs.js";import"./utils-BcyDR7Vi.js";var be=Object.defineProperty,W=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,se=(m,d,l)=>d in m?be(m,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[d]=l,J=(m,d)=>{for(var l in d||(d={}))re.call(d,l)&&se(m,l,d[l]);if(W)for(var l of W(d))ae.call(d,l)&&se(m,l,d[l]);return m},q=(m,d)=>{var l={};for(var u in m)re.call(m,u)&&d.indexOf(u)<0&&(l[u]=m[u]);if(m!=null&&W)for(var u of W(m))d.indexOf(u)<0&&ae.call(m,u)&&(l[u]=m[u]);return l};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var B;(m=>{const d=class b{constructor(e,s,t,a){if(this.version=e,this.errorCorrectionLevel=s,this.modules=[],this.isFunction=[],e<b.MIN_VERSION||e>b.MAX_VERSION)throw new RangeError("Version value out of range");if(a<-1||a>7)throw new RangeError("Mask value out of range");this.size=e*4+17;let n=[];for(let o=0;o<this.size;o++)n.push(!1);for(let o=0;o<this.size;o++)this.modules.push(n.slice()),this.isFunction.push(n.slice());this.drawFunctionPatterns();const h=this.addEccAndInterleave(t);if(this.drawCodewords(h),a==-1){let o=1e9;for(let g=0;g<8;g++){this.applyMask(g),this.drawFormatBits(g);const c=this.getPenaltyScore();c<o&&(a=g,o=c),this.applyMask(g)}}p(0<=a&&a<=7),this.mask=a,this.applyMask(a),this.drawFormatBits(a),this.isFunction=[]}static encodeText(e,s){const t=m.QrSegment.makeSegments(e);return b.encodeSegments(t,s)}static encodeBinary(e,s){const t=m.QrSegment.makeBytes(e);return b.encodeSegments([t],s)}static encodeSegments(e,s,t=1,a=40,n=-1,h=!0){if(!(b.MIN_VERSION<=t&&t<=a&&a<=b.MAX_VERSION)||n<-1||n>7)throw new RangeError("Invalid value");let o,g;for(o=t;;o++){const x=b.getNumDataCodewords(o,s)*8,w=E.getTotalBits(e,o);if(w<=x){g=w;break}if(o>=a)throw new RangeError("Data too long")}for(const x of[b.Ecc.MEDIUM,b.Ecc.QUARTILE,b.Ecc.HIGH])h&&g<=b.getNumDataCodewords(o,x)*8&&(s=x);let c=[];for(const x of e){l(x.mode.modeBits,4,c),l(x.numChars,x.mode.numCharCountBits(o),c);for(const w of x.getData())c.push(w)}p(c.length==g);const R=b.getNumDataCodewords(o,s)*8;p(c.length<=R),l(0,Math.min(4,R-c.length),c),l(0,(8-c.length%8)%8,c),p(c.length%8==0);for(let x=236;c.length<R;x^=253)l(x,8,c);let N=[];for(;N.length*8<c.length;)N.push(0);return c.forEach((x,w)=>N[w>>>3]|=x<<7-(w&7)),new b(o,s,N,n)}getModule(e,s){return 0<=e&&e<this.size&&0<=s&&s<this.size&&this.modules[s][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let t=0;t<this.size;t++)this.setFunctionModule(6,t,t%2==0),this.setFunctionModule(t,6,t%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),s=e.length;for(let t=0;t<s;t++)for(let a=0;a<s;a++)t==0&&a==0||t==0&&a==s-1||t==s-1&&a==0||this.drawAlignmentPattern(e[t],e[a]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const s=this.errorCorrectionLevel.formatBits<<3|e;let t=s;for(let n=0;n<10;n++)t=t<<1^(t>>>9)*1335;const a=(s<<10|t)^21522;p(a>>>15==0);for(let n=0;n<=5;n++)this.setFunctionModule(8,n,u(a,n));this.setFunctionModule(8,7,u(a,6)),this.setFunctionModule(8,8,u(a,7)),this.setFunctionModule(7,8,u(a,8));for(let n=9;n<15;n++)this.setFunctionModule(14-n,8,u(a,n));for(let n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,u(a,n));for(let n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,u(a,n));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;const s=this.version<<12|e;p(s>>>18==0);for(let t=0;t<18;t++){const a=u(s,t),n=this.size-11+t%3,h=Math.floor(t/3);this.setFunctionModule(n,h,a),this.setFunctionModule(h,n,a)}}drawFinderPattern(e,s){for(let t=-4;t<=4;t++)for(let a=-4;a<=4;a++){const n=Math.max(Math.abs(a),Math.abs(t)),h=e+a,o=s+t;0<=h&&h<this.size&&0<=o&&o<this.size&&this.setFunctionModule(h,o,n!=2&&n!=4)}}drawAlignmentPattern(e,s){for(let t=-2;t<=2;t++)for(let a=-2;a<=2;a++)this.setFunctionModule(e+a,s+t,Math.max(Math.abs(a),Math.abs(t))!=1)}setFunctionModule(e,s,t){this.modules[s][e]=t,this.isFunction[s][e]=!0}addEccAndInterleave(e){const s=this.version,t=this.errorCorrectionLevel;if(e.length!=b.getNumDataCodewords(s,t))throw new RangeError("Invalid argument");const a=b.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][s],n=b.ECC_CODEWORDS_PER_BLOCK[t.ordinal][s],h=Math.floor(b.getNumRawDataModules(s)/8),o=a-h%a,g=Math.floor(h/a);let c=[];const R=b.reedSolomonComputeDivisor(n);for(let x=0,w=0;x<a;x++){let A=e.slice(w,w+g-n+(x<o?0:1));w+=A.length;const T=b.reedSolomonComputeRemainder(A,R);x<o&&A.push(0),c.push(A.concat(T))}let N=[];for(let x=0;x<c[0].length;x++)c.forEach((w,A)=>{(x!=g-n||A>=o)&&N.push(w[x])});return p(N.length==h),N}drawCodewords(e){if(e.length!=Math.floor(b.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let s=0;for(let t=this.size-1;t>=1;t-=2){t==6&&(t=5);for(let a=0;a<this.size;a++)for(let n=0;n<2;n++){const h=t-n,g=(t+1&2)==0?this.size-1-a:a;!this.isFunction[g][h]&&s<e.length*8&&(this.modules[g][h]=u(e[s>>>3],7-(s&7)),s++)}}p(s==e.length*8)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let s=0;s<this.size;s++)for(let t=0;t<this.size;t++){let a;switch(e){case 0:a=(t+s)%2==0;break;case 1:a=s%2==0;break;case 2:a=t%3==0;break;case 3:a=(t+s)%3==0;break;case 4:a=(Math.floor(t/3)+Math.floor(s/2))%2==0;break;case 5:a=t*s%2+t*s%3==0;break;case 6:a=(t*s%2+t*s%3)%2==0;break;case 7:a=((t+s)%2+t*s%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[s][t]&&a&&(this.modules[s][t]=!this.modules[s][t])}}getPenaltyScore(){let e=0;for(let n=0;n<this.size;n++){let h=!1,o=0,g=[0,0,0,0,0,0,0];for(let c=0;c<this.size;c++)this.modules[n][c]==h?(o++,o==5?e+=b.PENALTY_N1:o>5&&e++):(this.finderPenaltyAddHistory(o,g),h||(e+=this.finderPenaltyCountPatterns(g)*b.PENALTY_N3),h=this.modules[n][c],o=1);e+=this.finderPenaltyTerminateAndCount(h,o,g)*b.PENALTY_N3}for(let n=0;n<this.size;n++){let h=!1,o=0,g=[0,0,0,0,0,0,0];for(let c=0;c<this.size;c++)this.modules[c][n]==h?(o++,o==5?e+=b.PENALTY_N1:o>5&&e++):(this.finderPenaltyAddHistory(o,g),h||(e+=this.finderPenaltyCountPatterns(g)*b.PENALTY_N3),h=this.modules[c][n],o=1);e+=this.finderPenaltyTerminateAndCount(h,o,g)*b.PENALTY_N3}for(let n=0;n<this.size-1;n++)for(let h=0;h<this.size-1;h++){const o=this.modules[n][h];o==this.modules[n][h+1]&&o==this.modules[n+1][h]&&o==this.modules[n+1][h+1]&&(e+=b.PENALTY_N2)}let s=0;for(const n of this.modules)s=n.reduce((h,o)=>h+(o?1:0),s);const t=this.size*this.size,a=Math.ceil(Math.abs(s*20-t*10)/t)-1;return p(0<=a&&a<=9),e+=a*b.PENALTY_N4,p(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(this.version==1)return[];{const e=Math.floor(this.version/7)+2,s=this.version==32?26:Math.ceil((this.version*4+4)/(e*2-2))*2;let t=[6];for(let a=this.size-7;t.length<e;a-=s)t.splice(1,0,a);return t}}static getNumRawDataModules(e){if(e<b.MIN_VERSION||e>b.MAX_VERSION)throw new RangeError("Version number out of range");let s=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;s-=(25*t-10)*t-55,e>=7&&(s-=36)}return p(208<=s&&s<=29648),s}static getNumDataCodewords(e,s){return Math.floor(b.getNumRawDataModules(e)/8)-b.ECC_CODEWORDS_PER_BLOCK[s.ordinal][e]*b.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let s=[];for(let a=0;a<e-1;a++)s.push(0);s.push(1);let t=1;for(let a=0;a<e;a++){for(let n=0;n<s.length;n++)s[n]=b.reedSolomonMultiply(s[n],t),n+1<s.length&&(s[n]^=s[n+1]);t=b.reedSolomonMultiply(t,2)}return s}static reedSolomonComputeRemainder(e,s){let t=s.map(a=>0);for(const a of e){const n=a^t.shift();t.push(0),s.forEach((h,o)=>t[o]^=b.reedSolomonMultiply(h,n))}return t}static reedSolomonMultiply(e,s){if(e>>>8||s>>>8)throw new RangeError("Byte out of range");let t=0;for(let a=7;a>=0;a--)t=t<<1^(t>>>7)*285,t^=(s>>>a&1)*e;return p(t>>>8==0),t}finderPenaltyCountPatterns(e){const s=e[1];p(s<=this.size*3);const t=s>0&&e[2]==s&&e[3]==s*3&&e[4]==s&&e[5]==s;return(t&&e[0]>=s*4&&e[6]>=s?1:0)+(t&&e[6]>=s*4&&e[0]>=s?1:0)}finderPenaltyTerminateAndCount(e,s,t){return e&&(this.finderPenaltyAddHistory(s,t),s=0),s+=this.size,this.finderPenaltyAddHistory(s,t),this.finderPenaltyCountPatterns(t)}finderPenaltyAddHistory(e,s){s[0]==0&&(e+=this.size),s.pop(),s.unshift(e)}};d.MIN_VERSION=1,d.MAX_VERSION=40,d.PENALTY_N1=3,d.PENALTY_N2=3,d.PENALTY_N3=40,d.PENALTY_N4=10,d.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],d.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],m.QrCode=d;function l(v,e,s){if(e<0||e>31||v>>>e)throw new RangeError("Value out of range");for(let t=e-1;t>=0;t--)s.push(v>>>t&1)}function u(v,e){return(v>>>e&1)!=0}function p(v){if(!v)throw new Error("Assertion error")}const f=class y{constructor(e,s,t){if(this.mode=e,this.numChars=s,this.bitData=t,s<0)throw new RangeError("Invalid argument");this.bitData=t.slice()}static makeBytes(e){let s=[];for(const t of e)l(t,8,s);return new y(y.Mode.BYTE,e.length,s)}static makeNumeric(e){if(!y.isNumeric(e))throw new RangeError("String contains non-numeric characters");let s=[];for(let t=0;t<e.length;){const a=Math.min(e.length-t,3);l(parseInt(e.substring(t,t+a),10),a*3+1,s),t+=a}return new y(y.Mode.NUMERIC,e.length,s)}static makeAlphanumeric(e){if(!y.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let s=[],t;for(t=0;t+2<=e.length;t+=2){let a=y.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t))*45;a+=y.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),l(a,11,s)}return t<e.length&&l(y.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,s),new y(y.Mode.ALPHANUMERIC,e.length,s)}static makeSegments(e){return e==""?[]:y.isNumeric(e)?[y.makeNumeric(e)]:y.isAlphanumeric(e)?[y.makeAlphanumeric(e)]:[y.makeBytes(y.toUtf8ByteArray(e))]}static makeEci(e){let s=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)l(e,8,s);else if(e<16384)l(2,2,s),l(e,14,s);else if(e<1e6)l(6,3,s),l(e,21,s);else throw new RangeError("ECI assignment value out of range");return new y(y.Mode.ECI,0,s)}static isNumeric(e){return y.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return y.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,s){let t=0;for(const a of e){const n=a.mode.numCharCountBits(s);if(a.numChars>=1<<n)return 1/0;t+=4+n+a.bitData.length}return t}static toUtf8ByteArray(e){e=encodeURI(e);let s=[];for(let t=0;t<e.length;t++)e.charAt(t)!="%"?s.push(e.charCodeAt(t)):(s.push(parseInt(e.substring(t+1,t+3),16)),t+=2);return s}};f.NUMERIC_REGEX=/^[0-9]*$/,f.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,f.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let E=f;m.QrSegment=f})(B||(B={}));(m=>{(d=>{const l=class{constructor(p,f){this.ordinal=p,this.formatBits=f}};l.LOW=new l(0,1),l.MEDIUM=new l(1,0),l.QUARTILE=new l(2,3),l.HIGH=new l(3,2),d.Ecc=l})(m.QrCode||(m.QrCode={}))})(B||(B={}));(m=>{(d=>{const l=class{constructor(p,f){this.modeBits=p,this.numBitsCharCount=f}numCharCountBits(p){return this.numBitsCharCount[Math.floor((p+7)/17)]}};l.NUMERIC=new l(1,[10,12,14]),l.ALPHANUMERIC=new l(2,[9,11,13]),l.BYTE=new l(4,[8,16,16]),l.KANJI=new l(8,[8,10,12]),l.ECI=new l(7,[0,0,0]),d.Mode=l})(m.QrSegment||(m.QrSegment={}))})(B||(B={}));var $=B;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var pe={L:$.QrCode.Ecc.LOW,M:$.QrCode.Ecc.MEDIUM,Q:$.QrCode.Ecc.QUARTILE,H:$.QrCode.Ecc.HIGH},ne=128,le="L",ie="#FFFFFF",oe="#000000",ce=!1,de=1,Ne=4,ve=0,we=.1;function he(m,d=0){const l=[];return m.forEach(function(u,p){let f=null;u.forEach(function(E,v){if(!E&&f!==null){l.push(`M${f+d} ${p+d}h${v-f}v1H${f+d}z`),f=null;return}if(v===u.length-1){if(!E)return;f===null?l.push(`M${v+d},${p+d} h1v1H${v+d}z`):l.push(`M${f+d},${p+d} h${v+1-f}v1H${f+d}z`);return}E&&f===null&&(f=v)})}),l.join("")}function ue(m,d){return m.slice().map((l,u)=>u<d.y||u>=d.y+d.h?l:l.map((p,f)=>f<d.x||f>=d.x+d.w?p:!1))}function ye(m,d,l,u){if(u==null)return null;const p=m.length+l*2,f=Math.floor(d*we),E=p/d,v=(u.width||f)*E,e=(u.height||f)*E,s=u.x==null?m.length/2-v/2:u.x*E,t=u.y==null?m.length/2-e/2:u.y*E,a=u.opacity==null?1:u.opacity;let n=null;if(u.excavate){let o=Math.floor(s),g=Math.floor(t),c=Math.ceil(v+s-o),R=Math.ceil(e+t-g);n={x:o,y:g,w:c,h:R}}const h=u.crossOrigin;return{x:s,y:t,h:e,w:v,excavation:n,opacity:a,crossOrigin:h}}function Ee(m,d){return d!=null?Math.max(Math.floor(d),0):m?Ne:ve}function me({value:m,level:d,minVersion:l,includeMargin:u,marginSize:p,imageSettings:f,size:E,boostLevel:v}){let e=k.useMemo(()=>{const o=(Array.isArray(m)?m:[m]).reduce((g,c)=>(g.push(...$.QrSegment.makeSegments(c)),g),[]);return $.QrCode.encodeSegments(o,pe[d],l,void 0,void 0,v)},[m,d,l,v]);const{cells:s,margin:t,numCells:a,calculatedImageSettings:n}=k.useMemo(()=>{let h=e.getModules();const o=Ee(u,p),g=h.length+o*2,c=ye(h,E,o,f);return{cells:h,margin:o,numCells:g,calculatedImageSettings:c}},[e,E,f,u,p]);return{qrcode:e,margin:t,cells:s,numCells:a,calculatedImageSettings:n}}var Ce=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),je=k.forwardRef(function(d,l){const u=d,{value:p,size:f=ne,level:E=le,bgColor:v=ie,fgColor:e=oe,includeMargin:s=ce,minVersion:t=de,boostLevel:a,marginSize:n,imageSettings:h}=u,g=q(u,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:c}=g,R=q(g,["style"]),N=h==null?void 0:h.src,x=k.useRef(null),w=k.useRef(null),A=k.useCallback(P=>{x.current=P,typeof l=="function"?l(P):l&&(l.current=P)},[l]),[T,O]=k.useState(!1),{margin:z,cells:_,numCells:D,calculatedImageSettings:I}=me({value:p,level:E,minVersion:t,boostLevel:a,includeMargin:s,marginSize:n,imageSettings:h,size:f});k.useEffect(()=>{if(x.current!=null){const P=x.current,S=P.getContext("2d");if(!S)return;let H=_;const F=w.current,X=I!=null&&F!==null&&F.complete&&F.naturalHeight!==0&&F.naturalWidth!==0;X&&I.excavation!=null&&(H=ue(_,I.excavation));const K=window.devicePixelRatio||1;P.height=P.width=f*K;const G=f/D*K;S.scale(G,G),S.fillStyle=v,S.fillRect(0,0,D,D),S.fillStyle=e,Ce?S.fill(new Path2D(he(H,z))):_.forEach(function(Z,Y){Z.forEach(function(i,C){i&&S.fillRect(C+z,Y+z,1,1)})}),I&&(S.globalAlpha=I.opacity),X&&S.drawImage(F,I.x+z,I.y+z,I.w,I.h)}}),k.useEffect(()=>{O(!1)},[N]);const V=J({height:f,width:f},c);let Q=null;return N!=null&&(Q=k.createElement("img",{src:N,key:N,style:{display:"none"},onLoad:()=>{O(!0)},ref:w,crossOrigin:I==null?void 0:I.crossOrigin})),k.createElement(k.Fragment,null,k.createElement("canvas",J({style:V,height:f,width:f,ref:A,role:"img"},R)),Q)});je.displayName="QRCodeCanvas";var fe=k.forwardRef(function(d,l){const u=d,{value:p,size:f=ne,level:E=le,bgColor:v=ie,fgColor:e=oe,includeMargin:s=ce,minVersion:t=de,boostLevel:a,title:n,marginSize:h,imageSettings:o}=u,g=q(u,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:c,cells:R,numCells:N,calculatedImageSettings:x}=me({value:p,level:E,minVersion:t,boostLevel:a,includeMargin:s,marginSize:h,imageSettings:o,size:f});let w=R,A=null;o!=null&&x!=null&&(x.excavation!=null&&(w=ue(R,x.excavation)),A=k.createElement("image",{href:o.src,height:x.h,width:x.w,x:x.x+c,y:x.y+c,preserveAspectRatio:"none",opacity:x.opacity,crossOrigin:x.crossOrigin}));const T=he(w,c);return k.createElement("svg",J({height:f,width:f,viewBox:`0 0 ${N} ${N}`,ref:l,role:"img"},g),!!n&&k.createElement("title",null,n),k.createElement("path",{fill:v,d:`M0,0 h${N}v${N}H0z`,shapeRendering:"crispEdges"}),k.createElement("path",{fill:e,d:T,shapeRendering:"crispEdges"}),A)});fe.displayName="QRCodeSVG";const ke={PENDING:{text:"待支付",color:"text-amber-500"},PAID:{text:"已支付",color:"text-green-500"},FAILED:{text:"支付失败",color:"text-red-500"},EXPIRED:{text:"已过期",color:"text-gray-500"},REFUNDED:{text:"已退款",color:"text-neutral-500"},CANCELLED:{text:"已取消",color:"text-gray-500"}},Me={RECHARGE:{text:"充值",icon:"add_circle",color:"text-green-500"},CONSUME:{text:"消费",icon:"remove_circle",color:"text-red-500"},REFUND:{text:"退还",icon:"replay",color:"text-blue-500"},GIFT:{text:"赠送",icon:"card_giftcard",color:"text-neutral-500"},ADMIN:{text:"调整",icon:"admin_panel_settings",color:"text-amber-500"},EXPIRE:{text:"过期",icon:"schedule",color:"text-gray-500"},REDEEM:{text:"兑换",icon:"confirmation_number",color:"text-orange-500"}},Oe=()=>{const{user:m,refreshUser:d}=ge(),[l,u]=M.useState("packages"),[p,f]=M.useState([]),[E,v]=M.useState([]),[e,s]=M.useState([]),[t,a]=M.useState(!0),[n,h]=M.useState(!1),[o,g]=M.useState(!1),[c,R]=M.useState(null),[N,x]=M.useState(null),[w,A]=M.useState(!1),[T,O]=M.useState(!1),[z,_]=M.useState(!1),[D,I]=M.useState(""),[V,Q]=M.useState(!1);M.useEffect(()=>{l==="packages"?P("RECHARGE"):l==="credits"?P("CREDITS"):l==="orders"&&E.length===0?S():l==="transactions"&&e.length===0&&H()},[l]);const P=async i=>{try{a(!0),R(null);const C=await U.payment.getPackages(i);f(C.data||[])}catch{L.error("加载套餐失败")}finally{a(!1)}},S=async()=>{try{h(!0);const i=await U.payment.getOrders({limit:50});v(i.orders||[])}catch{L.error("加载订单失败")}finally{h(!1)}},H=async()=>{try{g(!0);const i=await U.payment.getTransactions({limit:50});s(i.transactions||[])}catch{L.error("加载积分流水失败")}finally{g(!1)}},F=M.useCallback(async i=>{try{const j=(await U.payment.getOrderStatus(i)).data;return j.status==="PAID"?(O(!1),_(!0),await d(),L.success("充值成功！"),!0):j.status==="EXPIRED"||j.status==="CANCELLED"?(O(!1),L.error("订单已过期或取消"),x(null),!0):!1}catch{return!1}},[d]);M.useEffect(()=>{if(!N||!T)return;const i=setInterval(async()=>{await F(N.orderNo)&&clearInterval(i)},2e3),C=setTimeout(()=>{clearInterval(i),O(!1)},5*60*1e3);return()=>{clearInterval(i),clearTimeout(C)}},[N,T,F]);const X=i=>{R(i),x(null),_(!1)},K=async()=>{var i,C;if(c)try{A(!0);const j=await U.payment.createOrder({packageId:c.id,paymentMethod:"ALIPAY"});x(j.data),O(!0)}catch(j){L.error(((C=(i=j.response)==null?void 0:i.data)==null?void 0:C.message)||"创建订单失败")}finally{A(!1)}},G=()=>{x(null),O(!1),_(!1),R(null)},Z=async()=>{var i,C;if(!D.trim()){L.error("请输入兑换码");return}try{Q(!0);const j=await U.redeem.redeem(D.trim()),{credits:xe,memberLevel:ee}=j.data;let te=`兑换成功！获得 ${xe} 积分`;ee&&(te+=`，会员等级升级为 ${ee}`),L.success(te),I(""),d(),H()}catch(j){L.error(((C=(i=j.response)==null?void 0:i.data)==null?void 0:C.message)||"兑换失败")}finally{Q(!1)}},Y=i=>(i/100).toFixed(2);return t?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"text-gray-400",children:"加载中..."})}):r.jsx("div",{className:"min-h-screen",children:r.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-neutral-600 via-neutral-500 to-blue-500 dark:from-neutral-400 dark:via-neutral-400 dark:to-neutral-400 bg-clip-text text-transparent mb-3",children:"会员订阅"}),r.jsx("p",{className:"text-slate-600 dark:text-gray-400 max-w-2xl mx-auto",children:"订阅会员享受更多权益，购买积分解锁无限创作"})]}),r.jsx("div",{className:"flex justify-center mb-4",children:r.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-full text-sm",children:[r.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"diamond"}),r.jsx("span",{className:"text-slate-600 dark:text-gray-300",children:"当前积分："}),r.jsx("span",{className:"text-amber-600 dark:text-amber-400 font-bold",children:(m==null?void 0:m.credits)||0})]})}),r.jsx("div",{className:"flex justify-center mb-6",children:r.jsxs("div",{className:"flex items-center gap-3 bg-white dark:bg-card-dark border border-slate-200 dark:border-border-dark rounded-xl p-2 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 px-3",children:[r.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"confirmation_number"}),r.jsx("span",{className:"text-slate-600 dark:text-gray-400 text-sm",children:"兑换码："})]}),r.jsx("input",{type:"text",value:D,onChange:i=>I(i.target.value.toUpperCase()),placeholder:"请输入16位兑换码",maxLength:20,className:"w-48 px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-border-dark rounded-lg text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-gray-500 text-sm font-mono focus:outline-none focus:ring-2 focus:ring-amber-500"}),r.jsx("button",{onClick:Z,disabled:V||!D.trim(),className:"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white text-sm font-medium rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:V?"兑换中...":"立即兑换"})]})}),r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:"inline-flex bg-slate-100 dark:bg-slate-800 rounded-full p-1",children:[{key:"packages",label:"会员订阅",icon:"workspace_premium"},{key:"credits",label:"购买积分",icon:"diamond"},{key:"orders",label:"订单记录",icon:"receipt_long"},{key:"transactions",label:"积分明细",icon:"account_balance"}].map(i=>r.jsxs("button",{onClick:()=>u(i.key),className:`flex items-center gap-2 px-5 py-2 rounded-full text-sm font-medium transition-all duration-300 ${l===i.key?"bg-white dark:bg-slate-700 text-slate-900 dark:text-white shadow-sm":"text-slate-600 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white"}`,children:[r.jsx("span",{className:"material-symbols-outlined text-lg",children:i.icon}),i.label]},i.key))})}),(l==="packages"||l==="credits")&&r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12 max-w-5xl mx-auto",children:p.map(i=>r.jsxs("div",{onClick:()=>X(i),className:`relative group cursor-pointer transition-all duration-300 ${i.isRecommend?"scale-105 z-10 -translate-y-1":""} ${(c==null?void 0:c.id)===i.id?"scale-105 z-20":"hover:scale-102 hover:-translate-y-1"}`,children:[i.badge&&r.jsx("div",{className:"absolute -top-2 -right-2 z-20 px-3 py-1 text-xs font-bold text-white rounded-full shadow-lg",style:{backgroundColor:i.badgeColor||"#ef4444"},children:i.badge}),r.jsx("div",{className:`relative overflow-hidden rounded-2xl bg-white dark:bg-card-dark border transition-all duration-300 ${i.isRecommend?"ring-2 ring-amber-400 border-amber-300 dark:border-amber-600 shadow-lg shadow-amber-500/10":"border-slate-200 dark:border-border-dark"} ${(c==null?void 0:c.id)===i.id?"ring-2 ring-blue-500 border-blue-400 dark:border-blue-500 shadow-lg shadow-blue-500/10":"hover:shadow-md hover:border-slate-300 dark:hover:border-slate-600"}`,children:r.jsxs("div",{className:"p-4",children:[r.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:i.name}),i.coverImage&&r.jsx("div",{className:"mb-3 -mx-1 rounded-lg overflow-hidden",children:r.jsx("img",{src:i.coverImage,alt:i.name,className:"w-full h-28 object-cover"})}),i.description&&r.jsx("p",{className:"text-slate-500 dark:text-gray-400 text-xs mb-3 whitespace-pre-line leading-relaxed",children:i.description}),r.jsxs("div",{className:"flex items-baseline gap-1 mb-3",children:[r.jsx("span",{className:"text-slate-400 dark:text-gray-500 text-base",children:"¥"}),r.jsx("span",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:Y(i.price)})]}),r.jsxs("div",{className:"space-y-1.5 mb-4 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-gray-300",children:[r.jsx("span",{className:"material-symbols-outlined text-amber-500 text-base",children:"diamond"}),r.jsxs("span",{children:[i.credits," 积分"]})]}),i.bonusCredits>0&&r.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:"add_circle"}),r.jsxs("span",{children:["赠送 ",i.bonusCredits," 积分"]})]}),i.memberLevel&&r.jsxs("div",{className:"flex items-center gap-2 text-neutral-600 dark:text-neutral-400",children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:"workspace_premium"}),r.jsxs("span",{children:[i.memberLevel==="VIP"?"VIP":"SVIP",i.memberDays&&` ${i.memberDays}天`]})]})]}),r.jsx("button",{className:`w-full py-2.5 rounded-lg text-sm font-medium transition-all duration-300 ${(c==null?void 0:c.id)===i.id?"bg-blue-500 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-gray-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:(c==null?void 0:c.id)===i.id?"已选择":"选择套餐"})]})})]},i.id))}),l==="orders"&&r.jsx("div",{className:"bg-white dark:bg-card-dark border border-slate-200 dark:border-border-dark rounded-2xl overflow-hidden",children:n?r.jsx("div",{className:"p-12 text-center text-slate-500 dark:text-gray-400",children:"加载中..."}):E.length===0?r.jsxs("div",{className:"p-12 text-center",children:[r.jsx("span",{className:"material-symbols-outlined text-6xl text-slate-200 dark:text-slate-700 mb-4",children:"receipt_long"}),r.jsx("p",{className:"text-slate-500 dark:text-gray-400",children:"暂无订单记录"})]}):r.jsx("div",{className:"divide-y divide-slate-100 dark:divide-border-dark",children:E.map(i=>{var j;const C=ke[i.status]||{text:i.status,color:"text-gray-500"};return r.jsx("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-amber-50 dark:bg-amber-900/20 rounded-xl flex items-center justify-center",children:r.jsx("span",{className:"material-symbols-outlined text-amber-500",children:"diamond"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-slate-900 dark:text-white font-medium",children:((j=i.package)==null?void 0:j.name)||"积分充值"}),r.jsx("p",{className:"text-slate-500 dark:text-gray-400 text-sm",children:new Date(i.createdAt).toLocaleString("zh-CN")})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:"text-slate-900 dark:text-white font-bold",children:["¥",(i.amount/100).toFixed(2)]}),r.jsx("p",{className:`text-sm ${C.color}`,children:C.text})]})]})},i.id)})})}),l==="transactions"&&r.jsx("div",{className:"bg-white dark:bg-card-dark border border-slate-200 dark:border-border-dark rounded-2xl overflow-hidden",children:o?r.jsx("div",{className:"p-12 text-center text-slate-500 dark:text-gray-400",children:"加载中..."}):e.length===0?r.jsxs("div",{className:"p-12 text-center",children:[r.jsx("span",{className:"material-symbols-outlined text-6xl text-slate-200 dark:text-slate-700 mb-4",children:"account_balance"}),r.jsx("p",{className:"text-slate-500 dark:text-gray-400",children:"暂无积分记录"})]}):r.jsx("div",{className:"divide-y divide-slate-100 dark:divide-border-dark",children:e.map(i=>{const C=Me[i.type]||{text:i.type,icon:"help",color:"text-gray-500"},j=i.amount>0;return r.jsx("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-white/5 transition-colors",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${j?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:r.jsx("span",{className:`material-symbols-outlined ${C.color}`,children:C.icon})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-slate-900 dark:text-white font-medium",children:i.description}),r.jsx("p",{className:"text-slate-500 dark:text-gray-400 text-sm",children:new Date(i.createdAt).toLocaleString("zh-CN")})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:`font-bold ${j?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[j?"+":"",i.amount]}),r.jsxs("p",{className:"text-slate-500 dark:text-gray-400 text-sm",children:["余额: ",i.balance]})]})]})},i.id)})})}),(l==="packages"||l==="credits")&&c&&!N&&r.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-card-dark border-t border-slate-200 dark:border-border-dark p-4 z-50 shadow-lg",children:r.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-slate-500 dark:text-gray-400 text-sm",children:"已选择"}),r.jsx("p",{className:"text-slate-900 dark:text-white font-bold",children:c.name})]}),r.jsx("div",{className:"h-8 w-px bg-slate-200 dark:bg-slate-700"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-slate-500 dark:text-gray-400 text-sm",children:"获得积分"}),r.jsx("p",{className:"text-amber-600 dark:text-amber-400 font-bold",children:c.credits+c.bonusCredits})]})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-slate-500 dark:text-gray-400 text-sm",children:"应付金额"}),r.jsxs("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["¥",Y(c.price)]})]}),r.jsx("button",{onClick:K,disabled:w,className:"px-8 py-3 bg-gradient-to-r from-neutral-700 to-neutral-600 hover:from-neutral-700 hover:to-neutral-600 text-white font-bold rounded-xl transition-all duration-300 disabled:opacity-50 shadow-lg shadow-neutral-500/25",children:w?"创建订单中...":"立即支付"})]})]})}),N&&r.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:r.jsx("div",{className:"bg-white dark:bg-card-dark rounded-3xl w-full max-w-md overflow-hidden shadow-2xl",children:z?r.jsxs("div",{className:"p-8 text-center",children:[r.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:r.jsx("span",{className:"material-symbols-outlined text-5xl text-green-500",children:"check_circle"})}),r.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:"充值成功"}),r.jsxs("p",{className:"text-slate-500 dark:text-gray-400 mb-6",children:["已成功充值 ",N.credits," 积分"]}),r.jsx("button",{onClick:G,className:"w-full py-3 bg-green-500 hover:bg-green-600 text-white font-medium rounded-xl transition-colors",children:"完成"})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-gradient-to-r from-neutral-700 to-neutral-600 p-6 text-center text-white",children:[r.jsx("h2",{className:"text-xl font-bold mb-1",children:"扫码支付"}),r.jsx("p",{className:"text-white/80 text-sm",children:"请使用支付宝扫描下方二维码"})]}),r.jsxs("div",{className:"p-8 bg-slate-50 dark:bg-card-dark",children:[r.jsx("div",{className:"bg-white p-4 rounded-2xl shadow-sm mb-6 mx-auto w-fit border border-slate-200",children:r.jsx(fe,{value:N.qrCodeUrl,size:200,level:"M",includeMargin:!1})}),r.jsxs("div",{className:"space-y-3 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-slate-500 dark:text-gray-400",children:"套餐"}),r.jsx("span",{className:"text-slate-900 dark:text-white font-medium",children:N.package.name})]}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-slate-500 dark:text-gray-400",children:"积分"}),r.jsxs("span",{className:"text-amber-500 font-medium",children:[N.credits,N.package.bonusCredits>0&&r.jsxs("span",{className:"text-green-500 ml-1",children:["(+",N.package.bonusCredits,")"]})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-slate-500 dark:text-gray-400",children:"金额"}),r.jsxs("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["¥",Y(N.amount)]})]})]}),r.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-500 mb-6",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),r.jsx("span",{className:"text-sm",children:"等待支付中..."})]}),r.jsx("button",{onClick:G,className:"w-full py-3 border border-slate-200 dark:border-border-dark text-slate-600 dark:text-gray-400 hover:bg-slate-50 dark:hover:bg-white/5 rounded-xl transition-colors",children:"取消支付"})]})]})})})]})})};export{Oe as default};
