import{d as X,r as k,j as e,R as j}from"./react-vendor-CnSaCHf4.js";import{c as m,b as i,d as G,u as Y}from"./index-Cp0uMTfX.js";import"./reactflow-COwzeFBM.js";import"./utils-BcyDR7Vi.js";const H=({isEdit:a=!1,onSubmit:E,onClose:R,formData:v,setFormData:w,thumbnail:C,setThumbnail:S,hideType:K=!1,projectId:u,projectType:o})=>{const A=j.useRef(null),[I,f]=j.useState(!1),[n,g]=j.useState([]),[L,W]=j.useState(""),[D,y]=j.useState([]),[U,F]=j.useState(!1),[O,M]=j.useState(!1),[$,_]=j.useState(null),[s,x]=j.useState("READ"),[d,p]=j.useState(!1),N=j.useRef(null);j.useEffect(()=>{a&&u&&Q()},[a,o,u]);const Q=async()=>{var t;if(u)try{if(o==="QUICK"){const c=(t=(await m.workflows.getOrCreateByProject(u)).data)==null?void 0:t.id;if(c){_(c);const h=await m.workflows.getCollaborators(c);g(h.data||[])}}else{const r=await m.projects.getCollaborators(u);g(r.data||[])}}catch{}},B=async t=>{if(W(t),N.current&&clearTimeout(N.current),!t.startsWith("@")){y([]),M(!1);return}const r=t.slice(1).trim();N.current=setTimeout(async()=>{F(!0);try{const c=o==="QUICK"?await m.workflows.searchUsers(r||""):await m.projects.searchUsers(r||""),h=new Set(n.map(q=>q.id));let b=(c.data||[]).filter(q=>!h.has(q.id)).slice(0,5);const P=Y.getState().user;(P==null?void 0:P.role)==="ADMIN"&&o==="QUICK"&&!d&&(r===""||"所有人".includes(r))&&(b=[{id:"*",nickname:"所有人",avatar:null,isEveryone:!0},...b]),y(b),M(!0)}catch{}finally{F(!1)}},200)},J=async t=>{var r,c;if(u)try{if(o==="QUICK"){if(!$)return;if(await m.workflows.addCollaborator($,t.id,s),t.id==="*"||t.isEveryone){p(!0),W(""),y([]),M(!1),i.success("已公开共享给所有人");return}}else await m.projects.addCollaborator(u,t.id);g(h=>[...h,{id:t.id,nickname:t.nickname,avatar:t.avatar,permission:o==="QUICK"?s:"READ"}]),W(""),y([]),M(!1),i.success(`已添加协作者: ${t.nickname||t.username}`)}catch(h){i.error(((c=(r=h.response)==null?void 0:r.data)==null?void 0:c.message)||"添加失败")}},z=async(t,r)=>{var c,h;if(!(!$||o!=="QUICK"))try{await m.workflows.updatePermission($,t,r),g(b=>b.map(P=>P.id===t?{...P,permission:r}:P)),i.success("权限已更新")}catch(b){i.error(((h=(c=b.response)==null?void 0:c.data)==null?void 0:h.message)||"更新失败")}},l=async t=>{var r,c;if(u)try{if(o==="QUICK"){if(!$)return;await m.workflows.removeCollaborator($,t)}else await m.projects.removeCollaborator(u,t);g(h=>h.filter(b=>b.id!==t)),i.success("已移除协作者")}catch(h){i.error(((c=(r=h.response)==null?void 0:r.data)==null?void 0:c.message)||"移除失败")}},T=async t=>{var c,h;const r=(c=t.target.files)==null?void 0:c[0];if(r){if(!r.type.startsWith("image/")){i.error("请选择图片文件");return}if(r.size>10*1024*1024){i.error("图片大小不能超过 10MB");return}f(!0);try{const b=await m.assets.upload(r);b.success&&((h=b.data)!=null&&h.url)?(S(b.data.url),i.success("封面上传成功")):i.error("上传失败")}catch(b){i.error(b.message||"上传失败")}finally{f(!1)}}},V=()=>{S(null),A.current&&(A.current.value="")};return e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/70 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl p-6 max-w-lg w-full shadow-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:a?"编辑项目":"创建新项目"}),e.jsx("button",{onClick:R,type:"button",className:"p-1.5 rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-base",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}),e.jsxs("form",{onSubmit:E,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目名称 *"}),e.jsx("input",{type:"text",required:!0,value:v.name,onChange:t=>w(r=>({...r,name:t.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none",style:{outline:"none",boxShadow:"none"},placeholder:"例如: 霸道总裁爱上我",maxLength:100})]}),e.jsxs("div",{className:a?"grid grid-cols-2 gap-4":"",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目封面"}),e.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:T,className:"hidden"}),I?e.jsxs("div",{className:`w-full ${a?"aspect-[16/9]":"h-44"} border-2 border-dashed border-purple-400 dark:border-purple-400/50 rounded-md flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5`,children:[e.jsx("span",{className:"material-symbols-outlined text-2xl text-purple-500 animate-spin",children:"progress_activity"}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"正在上传..."})]}):C?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:C,alt:"封面预览",className:`w-full ${a?"aspect-[16/9]":"h-44"} object-cover rounded-md border-2 border-slate-200 dark:border-white/10`}),e.jsx("button",{type:"button",onClick:V,className:"absolute top-2 right-2 w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-all opacity-0 group-hover:opacity-100 shadow-md",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}):e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=A.current)==null?void 0:t.click()},className:`w-full ${a?"aspect-[16/9]":"h-44"} border-2 border-dashed border-slate-300 dark:border-white/20 rounded-md hover:border-purple-400 dark:hover:border-purple-400/50 transition-colors flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5`,children:[e.jsx("span",{className:"material-symbols-outlined text-2xl text-slate-400 dark:text-white/50",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"add_photo_alternate"}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"点击上传封面图片"}),e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-500",children:"支持 JPG、PNG，最大 10MB"})]})]}),a&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目描述"}),e.jsx("textarea",{value:v.description,onChange:t=>w(r=>({...r,description:t.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none resize-none",style:{outline:"none",boxShadow:"none"},rows:3,placeholder:"简要描述项目内容...",maxLength:500})]})]}),a&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"协作者管理"}),e.jsxs("div",{className:"flex-1 border-2 border-slate-200 dark:border-white/10 rounded-md bg-slate-100 dark:bg-white/5 p-2 flex flex-col",children:[o==="QUICK"&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"新协作者权限:"}),e.jsxs("div",{className:"flex rounded overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>x("READ"),className:`px-2 py-0.5 text-xs ${s==="READ"?"bg-blue-500 text-white":"bg-white dark:bg-black/30 text-slate-600 dark:text-slate-400"}`,children:"只读"}),e.jsx("button",{type:"button",onClick:()=>x("EDIT"),className:`px-2 py-0.5 text-xs ${s==="EDIT"?"bg-green-500 text-white":"bg-white dark:bg-black/30 text-slate-600 dark:text-slate-400"}`,children:"编辑"})]})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx("input",{type:"text",value:L,onChange:t=>B(t.target.value),onFocus:()=>L&&M(!0),placeholder:"@用户昵称 添加协作者",className:"w-full px-3 py-1.5 bg-white dark:bg-black/30 border border-slate-200 dark:border-white/10 rounded text-sm text-slate-800 dark:text-white placeholder:text-slate-400 focus:outline-none focus:ring-1 focus:ring-purple-500"}),U&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 material-symbols-outlined text-sm animate-spin text-slate-400",children:"progress_activity"}),O&&D.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-white/10 rounded-md shadow-lg max-h-32 overflow-y-auto",children:D.map(t=>e.jsxs("button",{type:"button",onClick:()=>J(t),className:`w-full px-3 py-2 flex items-center gap-2 hover:bg-slate-100 dark:hover:bg-white/10 text-left ${t.isEveryone?"bg-purple-50 dark:bg-purple-900/20":""}`,children:[t.isEveryone?e.jsx("span",{className:"material-symbols-outlined text-purple-500 text-lg",children:"groups"}):t.avatar?e.jsx("img",{src:t.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"account_circle"}),e.jsxs("span",{className:`text-sm ${t.isEveryone?"text-purple-600 dark:text-purple-400 font-medium":"text-slate-800 dark:text-white"}`,children:[t.nickname||t.username,t.isEveryone&&e.jsx("span",{className:"text-xs ml-1 text-purple-400",children:"（公开共享）"})]})]},t.id))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:n.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"暂无协作者"}):e.jsx("div",{className:"space-y-1",children:n.map(t=>e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-1 bg-white dark:bg-black/20 rounded",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:"",className:"w-4 h-4 rounded-full object-cover flex-shrink-0"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm flex-shrink-0",children:"account_circle"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300 truncate",children:t.nickname||"未命名"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[o==="QUICK"&&e.jsx("button",{type:"button",onClick:()=>z(t.id,t.permission==="EDIT"?"READ":"EDIT"),className:`px-1.5 py-0.5 text-[10px] rounded ${t.permission==="EDIT"?"bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-400":"bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400"} hover:opacity-80`,title:"点击切换权限",children:t.permission==="EDIT"?"编辑":"只读"}),e.jsx("button",{type:"button",onClick:()=>l(t.id),className:"p-0.5 text-red-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]})]},t.id))})})]})]})]}),!a&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目描述"}),e.jsx("textarea",{value:v.description,onChange:t=>w(r=>({...r,description:t.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none resize-none",style:{outline:"none",boxShadow:"none"},rows:3,placeholder:"简要描述项目内容...",maxLength:500})]}),!a&&!K&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目类型"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>w(t=>({...t,type:"DRAMA"})),className:`px-3 py-2 rounded-md border transition-all text-left ${v.type==="DRAMA"?"border-purple-500 bg-purple-500/10":"border-slate-200 dark:border-white/10 hover:border-purple-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-800 dark:text-white",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"movie"}),e.jsx("span",{className:"font-medium text-slate-800 dark:text-white",children:"剧集创作"})]}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"适合长篇故事，多集连载"})]}),e.jsxs("button",{type:"button",onClick:()=>w(t=>({...t,type:"QUICK"})),className:`px-3 py-2 rounded-md border transition-all text-left ${v.type==="QUICK"?"border-purple-500 bg-purple-500/10":"border-slate-200 dark:border-white/10 hover:border-purple-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-800 dark:text-white",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"bolt"}),e.jsx("span",{className:"font-medium text-slate-800 dark:text-white",children:"快速创作"})]}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"快速创作单个作品"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:R,className:"flex-1 px-3 py-2 bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white rounded-md hover:bg-slate-200 dark:hover:bg-white/10 transition-all border border-slate-200 dark:border-white/10",children:"取消"}),e.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white rounded-md transition-all font-medium active:scale-95",children:a?"保存更改":"创建项目"})]})]})]})})},le=()=>{const a=X(),[E,R]=k.useState([]),[v,w]=k.useState(!0),[C,S]=k.useState(!1),[K,u]=k.useState(!1),[o,A]=k.useState(null),[I,f]=k.useState(null),n=window.location.pathname.startsWith("/quick")?"QUICK":window.location.pathname.startsWith("/drama")?"DRAMA":"ALL",g=window.location.pathname.startsWith("/quick"),[L,W]=k.useState(""),[D,y]=k.useState({name:"",description:"",type:"DRAMA"});k.useEffect(()=>{U()},[n]);const U=async()=>{try{w(!0);const s=n==="ALL"?{fields:"minimal"}:{type:n,fields:"minimal"};let d=(await m.get("/projects",{params:s})).data.map(p=>({...p,isOwner:!0}));if(n==="QUICK"||n==="ALL")try{const N=(await m.workflows.getAll({includeShared:"true"})).data||[],Q=N.filter(l=>l.isOwner&&l.projectId),B=new Map;Q.forEach(l=>{l.projectId&&l.hasCollaborators&&B.set(l.projectId,!0)}),d=d.map(l=>({...l,hasCollaborators:l.type==="QUICK"?B.get(l.id)||!1:l.hasCollaborators||!1}));const z=N.filter(l=>l.isShared).map(l=>{var T,V;return{id:l.projectId||`workflow-${l.id}`,name:((T=l.project)==null?void 0:T.name)||l.name,description:l.description,thumbnail:((V=l.project)==null?void 0:V.thumbnail)||null,type:"QUICK",status:"DRAFT",createdAt:l.createdAt,updatedAt:l.updatedAt,_count:{episodes:0,workflows:1,assets:0},workflowId:l.id,isOwner:!1,isShared:!0,hasCollaborators:!1,shareInfo:l.shareInfo}});d=[...d,...z]}catch{}if(n==="DRAMA"||n==="ALL")try{const N=((await m.projects.getShared(n==="DRAMA"?{type:"DRAMA"}:{})).data||[]).filter(Q=>Q.type==="DRAMA").map(Q=>({...Q,isOwner:!1,isShared:!0,hasCollaborators:!1}));d=[...d,...N]}catch{}R(d)}catch(s){s.response&&s.response.status!==404&&i.error("加载项目列表失败"),R([])}finally{w(!1)}},F=async s=>{var x,d;if(s.preventDefault(),!D.name.trim()){i.error("请输入项目名称");return}try{const p={...D,type:g?"QUICK":"DRAMA",thumbnail:I||void 0},N=await m.projects.create(p);i.success("项目创建成功！"),S(!1),y({name:"",description:"",type:"DRAMA"}),f(null),U(),a(g?`/projects/${N.data.id}/workflow`:`/projects/${N.data.id}/episodes`)}catch(p){i.error(((d=(x=p.response)==null?void 0:x.data)==null?void 0:d.message)||"创建失败")}},O=async s=>{var x,d;if(s.preventDefault(),!!o)try{const p={...D,thumbnail:I||void 0};await m.projects.update(o.id,p),i.success("项目更新成功！"),u(!1),A(null),y({name:"",description:"",type:"DRAMA"}),f(null),U()}catch(p){i.error(((d=(x=p.response)==null?void 0:x.data)==null?void 0:d.message)||"更新失败")}},M=async s=>{if(confirm("确定要删除这个项目吗？所有相关数据都会被删除！"))try{await m.projects.delete(s),i.success("项目删除成功"),U()}catch{i.error("删除失败")}},$=s=>{A(s),y({name:s.name,description:s.description||"",type:s.type}),f(s.thumbnail||null),u(!0)},_=E.filter(s=>{var x;if(n!=="ALL"&&s.type!==n)return!1;if(L){const d=L.toLowerCase();return s.name.toLowerCase().includes(d)||((x=s.description)==null?void 0:x.toLowerCase().includes(d))}return!0});return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-8 mb-12 h-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-text-light-primary dark:text-text-dark-primary whitespace-nowrap m-0 leading-none flex items-center h-full",children:n==="QUICK"?"快速创作":n==="DRAMA"?"剧集创作":"我的项目"}),e.jsx("div",{className:"flex-1 flex items-center justify-center h-full",children:e.jsxs("div",{className:"relative w-full max-w-md flex items-center",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 text-text-light-tertiary dark:text-text-dark-tertiary",children:"search"}),e.jsx("input",{type:"text",placeholder:"搜索项目...",value:L,onChange:s=>W(s.target.value),className:"pl-12 pr-4 h-12 w-full bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-full text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary outline-none transition-all",style:{outline:"none",boxShadow:"none"}})]})}),e.jsxs("button",{onClick:()=>S(!0),className:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white font-medium rounded-lg transition-all flex items-center justify-center gap-2 active:scale-95 whitespace-nowrap",children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"add"}),"创建新项目"]})]}),v?e.jsx("div",{className:"text-center py-12 text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."}):E.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-tiffany-50 dark:bg-tiffany-500/10 flex items-center justify-center mb-6 shadow-tiffany",children:e.jsx("span",{className:"material-symbols-outlined text-tiffany-600 dark:text-tiffany-400 text-5xl",children:"folder_open"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"还没有项目"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:"创建你的第一个AI短剧项目"}),e.jsx("button",{onClick:()=>S(!0),className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white font-medium rounded-lg transition-all shadow-md active:scale-95",children:"立即创建"})]}):_.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gray-50 dark:bg-gray-500/10 flex items-center justify-center mb-6",children:e.jsx("span",{className:"material-symbols-outlined text-gray-400 dark:text-gray-500 text-5xl",children:"search_off"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"没有找到项目"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:L?"尝试使用其他关键词搜索":"此分类暂无项目"}),L&&e.jsx("button",{onClick:()=>W(""),className:"px-6 py-3 bg-card-light dark:bg-card-dark text-text-light-primary dark:text-text-dark-primary font-medium rounded-lg hover:bg-card-light-hover dark:hover:bg-card-dark-hover transition-all border border-border-light dark:border-border-dark",children:"清除搜索"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:_.map(s=>e.jsxs("div",{onClick:()=>{s.type==="QUICK"?s.isShared&&s.workflowId?a(`/workflow/${s.workflowId}`):a(`/projects/${s.id}/workflow`):a(`/projects/${s.id}/episodes`)},className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden hover:border-purple-400 dark:hover:border-purple-400/50 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer aspect-[4/3] flex flex-col",children:[e.jsxs("div",{className:"h-[70%] bg-slate-100 dark:bg-white/5 relative overflow-hidden",children:[e.jsx(Z,{thumbnail:s.thumbnail,name:s.name}),s.isOwner!==!1&&e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),$(s)},className:"w-7 h-7 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white rounded-full transition-all backdrop-blur-sm shadow-md active:scale-95",title:"编辑项目",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),M(s.id)},className:"w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 hover:shadow-lg text-white rounded-full transition-all backdrop-blur-sm shadow-md active:scale-95",title:"删除项目",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete"})})]}),s.isShared&&e.jsxs("div",{className:"absolute top-2 left-2 px-2 py-1 rounded-lg text-xs font-semibold text-white bg-blue-500/80 backdrop-blur-sm flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"group"}),"共享"]}),s.hasCollaborators&&!s.isShared&&e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 rounded-lg text-xs font-semibold text-white bg-green-500/80 backdrop-blur-sm flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"share"}),"已共享"]})]}),e.jsxs("div",{className:"h-[40%] p-4 bg-slate-50 dark:bg-white/5 flex flex-col justify-start border-t border-slate-200 dark:border-white/10",children:[e.jsx("h3",{className:"text-base font-bold text-slate-800 dark:text-white line-clamp-2 mb-2",children:s.name}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 line-clamp-3",children:s.description||"暂无描述"})]})]},s.id))}),C&&e.jsx(H,{isEdit:!1,onSubmit:F,formData:D,setFormData:y,thumbnail:I,setThumbnail:f,hideType:!0,onClose:()=>{S(!1),y({name:"",description:"",type:"DRAMA"}),f(null)}}),K&&o&&e.jsx(H,{isEdit:!0,onSubmit:O,formData:D,setFormData:y,thumbnail:I,setThumbnail:f,projectId:o.id,projectType:o.type,onClose:()=>{u(!1),A(null),y({name:"",description:"",type:"DRAMA"}),f(null),U()}})]})},Z=({thumbnail:a,name:E})=>{const[R,v]=k.useState([]),[w,C]=k.useState(0),[S,K]=k.useState(!1);k.useEffect(()=>{if(K(!1),!a){v([]),C(0);return}if(a.startsWith("http")||a.startsWith("data:")){v([a]),C(0);return}const o=a.startsWith("/")?a:`/${a}`,I="https://api.waule.com".replace(/\/$/,"").replace(/\/api$/,""),f=G.defaults.baseURL&&G.defaults.baseURL.startsWith("http")?G.defaults.baseURL.replace(/\/$/,"").replace(/\/api$/,""):"",n=window.location.origin.replace(/\/$/,""),g=[];n&&g.push(`${n}${o}`),I&&g.push(`${I}${o}`),f&&g.push(`${f}${o}`),v(g),C(0)},[a]);const u=R[w]||null;return!a||S||!u?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-3xl text-tiffany-300 dark:text-white/30",children:"movie"})}):e.jsx("img",{src:u,alt:E,className:"w-full h-full object-cover",onError:()=>{w+1<R.length?C(w+1):K(!0)}})};export{le as default};
