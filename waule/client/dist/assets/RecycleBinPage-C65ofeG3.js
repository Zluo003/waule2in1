import{r as a,j as e}from"./react-vendor-BvY2dB7B.js";import{b as I,c as w}from"./index-BTFt-1wP.js";import"./reactflow-D8v6_Qvs.js";import"./utils-BcyDR7Vi.js";const D=({value:b,onChange:g,options:f})=>{const[d,l]=a.useState(!1),u=a.useRef(null),[c,p]=a.useState(!1);a.useEffect(()=>{const s=()=>{p(document.documentElement.classList.contains("dark"))};s();const m=new MutationObserver(s);return m.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>m.disconnect()},[]),a.useEffect(()=>{const s=m=>{u.current&&!u.current.contains(m.target)&&l(!1)};return d&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[d]);const x=f.find(s=>s.value===b);return e.jsxs("div",{ref:u,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>l(!d),className:"absolute right-0 top-0 bottom-0 px-4 bg-neutral-800 dark:bg-white text-white dark:text-black rounded-r-full text-xs cursor-pointer flex items-center gap-1 min-w-[100px] justify-center",style:{outline:"none !important",boxShadow:"none !important",border:"none",color:c?"white":"black"},children:[e.jsx("span",{className:"whitespace-nowrap",style:{color:c?"white":"black"},children:x==null?void 0:x.label}),e.jsx("span",{className:"material-symbols-outlined text-xs",style:{fontVariationSettings:'"FILL" 0, "wght" 200',color:c?"white":"black"},children:d?"expand_less":"expand_more"})]}),d&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-32 rounded-lg shadow-lg border border-slate-200 dark:border-white/10 py-1 z-50",style:{backgroundColor:c?"#0f0f10":"#f3f5f5"},children:f.map(s=>e.jsx("button",{type:"button",onClick:()=>{g(s.value),l(!1)},className:`w-full px-3 py-2 text-left text-xs transition-colors ${b===s.value?"bg-slate-200 dark:bg-white/10 text-slate-900 dark:text-white font-medium":"text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-white/10"}`,children:s.label},s.value))})]})},A=()=>{const[b,g]=a.useState([]),[f,d]=a.useState(!0),[l,u]=a.useState([]),[c,p]=a.useState("ALL"),[x,s]=a.useState(""),[m,S]=a.useState(""),[o,y]=a.useState(!1),[n,k]=a.useState(null);a.useEffect(()=>{const t=setTimeout(()=>{S(x)},300);return()=>clearTimeout(t)},[x]);const v=async()=>{var t,r,i;d(!0);try{const h=await I.get("/assets/recycle/bin",{params:{type:c,q:m}});g(h.data||((t=h==null?void 0:h.data)==null?void 0:t.data)||[])}catch(h){w.error(((i=(r=h.response)==null?void 0:r.data)==null?void 0:i.message)||"加载回收站失败")}finally{d(!1)}};a.useEffect(()=>{v()},[c,m]);const L=t=>{u(r=>r.includes(t)?r.filter(i=>i!==t):[...r,t])},j=()=>{u([])},E=async()=>{if(l.length!==0&&confirm(`确定要彻底删除选中的 ${l.length} 个资产吗？此操作不可恢复！`))try{await Promise.all(l.map(t=>I.delete(`/assets/${t}/permanent`))),w.success("批量彻底删除完成"),j(),await v()}catch{w.error("批量彻底删除失败")}},N=(t,r)=>{const i=t.querySelector("video");i&&(r?(i.currentTime=0,i.play().catch(h=>{})):(i.pause(),i.currentTime=0))},C=t=>t.type==="IMAGE"?e.jsx("img",{src:t.thumbnail||t.url,alt:t.name,className:"w-full h-auto object-contain block",loading:"lazy"}):t.type==="VIDEO"?e.jsx("video",{src:t.url,className:"w-full h-auto object-contain block",preload:"metadata",poster:t.thumbnail||void 0,muted:!0,loop:!0}):t.type==="AUDIO"?e.jsx("div",{className:"w-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center",style:{aspectRatio:"1/1"},children:e.jsx("span",{className:"material-symbols-outlined text-5xl text-slate-400 dark:text-slate-500",children:"audio_file"})}):e.jsx("div",{className:"w-full bg-card-dark flex items-center justify-center",style:{aspectRatio:"16/9"},children:e.jsx("span",{className:"material-symbols-outlined text-5xl text-text-dark-secondary",children:"insert_drive_file"})});return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-8 mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-text-light-primary dark:text-text-dark-primary whitespace-nowrap",children:"回收站"}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md flex items-center",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 text-text-light-tertiary dark:text-text-dark-tertiary",children:"search"}),e.jsx("input",{type:"text",placeholder:"搜索项目名或文件名...",value:x,onChange:t=>s(t.target.value),className:"pl-12 pr-28 py-2.5 w-full bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-full text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary outline-none transition-all",style:{outline:"none",boxShadow:"none"}}),e.jsx(D,{value:c,onChange:t=>p(t),options:[{value:"ALL",label:"全部"},{value:"IMAGE",label:"图片"},{value:"VIDEO",label:"视频"},{value:"AUDIO",label:"音频"}]})]})}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsxs("button",{onClick:()=>{y(!o),o||u([])},className:`px-4 py-2.5 rounded-lg text-xs font-medium flex items-center gap-1.5 transition-all ${o?"bg-neutral-800 dark:bg-white text-white dark:text-black text-white shadow-md":"bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white border border-slate-200 dark:border-white/10 hover:border-neutral-400"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"check_box"}),"选择"]}),e.jsxs("button",{onClick:()=>{j(),y(!1)},disabled:!o,className:`px-4 py-2.5 rounded-lg text-xs font-medium flex items-center gap-1.5 transition-all ${o?"bg-neutral-800 dark:bg-white text-white dark:text-black text-white shadow-md":"bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white border border-slate-200 dark:border-white/10"} disabled:opacity-50`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"}),"取消"]}),e.jsxs("button",{onClick:E,disabled:!o||l.length===0,className:`px-4 py-2.5 rounded-lg text-xs font-medium flex items-center gap-1.5 transition-all ${o&&l.length>0?"bg-red-500 hover:bg-red-600 text-white shadow-md":"bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white border border-slate-200 dark:border-white/10"} disabled:opacity-50`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete_forever"}),"清空"]})]})]}),f?e.jsx("div",{className:"text-center py-12 text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gray-500/10 flex items-center justify-center mb-6",children:e.jsx("span",{className:"material-symbols-outlined text-gray-500 text-5xl",children:"delete"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"回收站为空"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:"删除的生成类媒体会出现在这里"})]}):e.jsx("div",{style:{columnWidth:240,columnGap:"16px"},children:b.map(t=>e.jsxs("div",{className:`relative group mb-4 bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 ${l.includes(t.id)?"border-neutral-500 dark:border-neutral-400":"border-slate-200 dark:border-white/10"} rounded-2xl overflow-hidden cursor-pointer transition-all duration-200 hover:-translate-y-1 hover:shadow-lg hover:border-neutral-400 dark:hover:border-neutral-400/50`,style:{breakInside:"avoid"},onClick:()=>{o?L(t.id):k(t)},onMouseEnter:r=>N(r.currentTarget,!0),onMouseLeave:r=>N(r.currentTarget,!1),children:[C(t),l.includes(t.id)&&e.jsx("div",{className:"absolute inset-0 bg-black/50 pointer-events-none"}),l.includes(t.id)&&e.jsx("div",{className:"absolute top-2 right-2 w-8 h-8 flex items-center justify-center bg-neutral-800 dark:bg-white text-white dark:text-black rounded-full shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",style:{fontVariationSettings:'"FILL" 1, "wght" 400'},children:"check"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/0 to-white/0 group-hover:from-black/10 group-hover:to-black/0 transition-opacity"}),!o&&e.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("a",{href:t.url,download:t.originalName||t.name,onClick:r=>r.stopPropagation(),className:"w-8 h-8 flex items-center justify-center bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"download"})})})]},t.id))}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>k(null),children:e.jsxs("div",{className:"rounded-2xl max-w-[90vw] relative",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"w-full h-[60vh] flex items-center justify-center",children:[n.type==="IMAGE"&&e.jsx("img",{src:n.thumbnail||n.url,alt:n.name,className:"max-h-full max-w-full h-full w-auto object-contain"}),n.type==="VIDEO"&&e.jsx("video",{src:n.url,controls:!0,autoPlay:!0,className:"max-h-full max-w-full h-full w-auto object-contain"}),n.type==="AUDIO"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("audio",{src:n.url,controls:!0,className:"w-[80%] max-w-[800px]"})})]}),e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsx("a",{href:n.url,download:n.originalName||n.name,className:"w-10 h-10 flex items-center justify-center bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",children:e.jsx("span",{className:"material-symbols-outlined text-base",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"download"})})})]})})]})};export{A as default};
