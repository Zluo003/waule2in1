import{g as Gt,f as Qe,e as Jt,d as Kt,u as Yt,r as ie,j as t}from"./react-vendor-BvY2dB7B.js";import{c as Le,b as fe,d as at}from"./index-B-U_h0BA.js";import"./reactflow-D8v6_Qvs.js";import"./utils-BcyDR7Vi.js";function et(ze){throw new Error('Could not dynamically require "'+ze+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var wt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(ze,Ae){(function(k){ze.exports=k()})(function(){return function k(M,N,d){function c(y,w){if(!N[y]){if(!M[y]){var p=typeof et=="function"&&et;if(!w&&p)return p(y,!0);if(s)return s(y,!0);var g=new Error("Cannot find module '"+y+"'");throw g.code="MODULE_NOT_FOUND",g}var a=N[y]={exports:{}};M[y][0].call(a.exports,function(m){var i=M[y][1][m];return c(i||m)},a,a.exports,k,M,N,d)}return N[y].exports}for(var s=typeof et=="function"&&et,u=0;u<d.length;u++)c(d[u]);return c}({1:[function(k,M,N){var d=k("./utils"),c=k("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";N.encode=function(u){for(var y,w,p,g,a,m,i,h=[],o=0,x=u.length,_=x,S=d.getTypeOf(u)!=="string";o<u.length;)_=x-o,p=S?(y=u[o++],w=o<x?u[o++]:0,o<x?u[o++]:0):(y=u.charCodeAt(o++),w=o<x?u.charCodeAt(o++):0,o<x?u.charCodeAt(o++):0),g=y>>2,a=(3&y)<<4|w>>4,m=1<_?(15&w)<<2|p>>6:64,i=2<_?63&p:64,h.push(s.charAt(g)+s.charAt(a)+s.charAt(m)+s.charAt(i));return h.join("")},N.decode=function(u){var y,w,p,g,a,m,i=0,h=0,o="data:";if(u.substr(0,o.length)===o)throw new Error("Invalid base64 input, it looks like a data url.");var x,_=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===s.charAt(64)&&_--,u.charAt(u.length-2)===s.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=c.uint8array?new Uint8Array(0|_):new Array(0|_);i<u.length;)y=s.indexOf(u.charAt(i++))<<2|(g=s.indexOf(u.charAt(i++)))>>4,w=(15&g)<<4|(a=s.indexOf(u.charAt(i++)))>>2,p=(3&a)<<6|(m=s.indexOf(u.charAt(i++))),x[h++]=y,a!==64&&(x[h++]=w),m!==64&&(x[h++]=p);return x}},{"./support":30,"./utils":32}],2:[function(k,M,N){var d=k("./external"),c=k("./stream/DataWorker"),s=k("./stream/Crc32Probe"),u=k("./stream/DataLengthProbe");function y(w,p,g,a,m){this.compressedSize=w,this.uncompressedSize=p,this.crc32=g,this.compression=a,this.compressedContent=m}y.prototype={getContentWorker:function(){var w=new c(d.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),p=this;return w.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),w},getCompressedWorker:function(){return new c(d.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},y.createWorkerFrom=function(w,p,g){return w.pipe(new s).pipe(new u("uncompressedSize")).pipe(p.compressWorker(g)).pipe(new u("compressedSize")).withStreamInfo("compression",p)},M.exports=y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(k,M,N){var d=k("./stream/GenericWorker");N.STORE={magic:"\0\0",compressWorker:function(){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},N.DEFLATE=k("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(k,M,N){var d=k("./utils"),c=function(){for(var s,u=[],y=0;y<256;y++){s=y;for(var w=0;w<8;w++)s=1&s?3988292384^s>>>1:s>>>1;u[y]=s}return u}();M.exports=function(s,u){return s!==void 0&&s.length?d.getTypeOf(s)!=="string"?function(y,w,p,g){var a=c,m=g+p;y^=-1;for(var i=g;i<m;i++)y=y>>>8^a[255&(y^w[i])];return-1^y}(0|u,s,s.length,0):function(y,w,p,g){var a=c,m=g+p;y^=-1;for(var i=g;i<m;i++)y=y>>>8^a[255&(y^w.charCodeAt(i))];return-1^y}(0|u,s,s.length,0):0}},{"./utils":32}],5:[function(k,M,N){N.base64=!1,N.binary=!1,N.dir=!1,N.createFolders=!0,N.date=null,N.compression=null,N.compressionOptions=null,N.comment=null,N.unixPermissions=null,N.dosPermissions=null},{}],6:[function(k,M,N){var d=null;d=typeof Promise<"u"?Promise:k("lie"),M.exports={Promise:d}},{lie:37}],7:[function(k,M,N){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",c=k("pako"),s=k("./utils"),u=k("./stream/GenericWorker"),y=d?"uint8array":"array";function w(p,g){u.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=g,this.meta={}}N.magic="\b\0",s.inherits(w,u),w.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(y,p.data),!1)},w.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},w.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},w.prototype._createPako=function(){this._pako=new c[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(g){p.push({data:g,meta:p.meta})}},N.compressWorker=function(p){return new w("Deflate",p)},N.uncompressWorker=function(){return new w("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(k,M,N){function d(a,m){var i,h="";for(i=0;i<m;i++)h+=String.fromCharCode(255&a),a>>>=8;return h}function c(a,m,i,h,o,x){var _,S,C=a.file,U=a.compression,O=x!==y.utf8encode,P=s.transformTo("string",x(C.name)),R=s.transformTo("string",y.utf8encode(C.name)),L=C.comment,re=s.transformTo("string",x(L)),b=s.transformTo("string",y.utf8encode(L)),B=R.length!==C.name.length,r=b.length!==L.length,D="",ne="",$="",de=C.dir,H=C.date,se={crc32:0,compressedSize:0,uncompressedSize:0};m&&!i||(se.crc32=a.crc32,se.compressedSize=a.compressedSize,se.uncompressedSize=a.uncompressedSize);var I=0;m&&(I|=8),O||!B&&!r||(I|=2048);var E=0,ee=0;de&&(E|=16),o==="UNIX"?(ee=798,E|=function(Y,_e){var we=Y;return Y||(we=_e?16893:33204),(65535&we)<<16}(C.unixPermissions,de)):(ee=20,E|=function(Y){return 63&(Y||0)}(C.dosPermissions)),_=H.getUTCHours(),_<<=6,_|=H.getUTCMinutes(),_<<=5,_|=H.getUTCSeconds()/2,S=H.getUTCFullYear()-1980,S<<=4,S|=H.getUTCMonth()+1,S<<=5,S|=H.getUTCDate(),B&&(ne=d(1,1)+d(w(P),4)+R,D+="up"+d(ne.length,2)+ne),r&&($=d(1,1)+d(w(re),4)+b,D+="uc"+d($.length,2)+$);var V="";return V+=`
\0`,V+=d(I,2),V+=U.magic,V+=d(_,2),V+=d(S,2),V+=d(se.crc32,4),V+=d(se.compressedSize,4),V+=d(se.uncompressedSize,4),V+=d(P.length,2),V+=d(D.length,2),{fileRecord:p.LOCAL_FILE_HEADER+V+P+D,dirRecord:p.CENTRAL_FILE_HEADER+d(ee,2)+V+d(re.length,2)+"\0\0\0\0"+d(E,4)+d(h,4)+P+D+re}}var s=k("../utils"),u=k("../stream/GenericWorker"),y=k("../utf8"),w=k("../crc32"),p=k("../signature");function g(a,m,i,h){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=i,this.encodeFileName=h,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(g,u),g.prototype.push=function(a){var m=a.meta.percent||0,i=this.entriesCount,h=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,u.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:i?(m+100*(i-h-1))/i:100}}))},g.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var m=this.streamFiles&&!a.file.dir;if(m){var i=c(a,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(a){this.accumulate=!1;var m=this.streamFiles&&!a.file.dir,i=c(a,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),m)this.push({data:function(h){return p.DATA_DESCRIPTOR+d(h.crc32,4)+d(h.compressedSize,4)+d(h.uncompressedSize,4)}(a),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var a=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var i=this.bytesWritten-a,h=function(o,x,_,S,C){var U=s.transformTo("string",C(S));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(o,2)+d(o,2)+d(x,4)+d(_,4)+d(U.length,2)+U}(this.dirRecords.length,i,a,this.zipComment,this.encodeFileName);this.push({data:h,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(a){this._sources.push(a);var m=this;return a.on("data",function(i){m.processChunk(i)}),a.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),a.on("error",function(i){m.error(i)}),this},g.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(a){var m=this._sources;if(!u.prototype.error.call(this,a))return!1;for(var i=0;i<m.length;i++)try{m[i].error(a)}catch{}return!0},g.prototype.lock=function(){u.prototype.lock.call(this);for(var a=this._sources,m=0;m<a.length;m++)a[m].lock()},M.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(k,M,N){var d=k("../compressions"),c=k("./ZipFileWorker");N.generateWorker=function(s,u,y){var w=new c(u.streamFiles,y,u.platform,u.encodeFileName),p=0;try{s.forEach(function(g,a){p++;var m=function(x,_){var S=x||_,C=d[S];if(!C)throw new Error(S+" is not a valid compression method !");return C}(a.options.compression,u.compression),i=a.options.compressionOptions||u.compressionOptions||{},h=a.dir,o=a.date;a._compressWorker(m,i).withStreamInfo("file",{name:g,dir:h,date:o,comment:a.comment||"",unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions}).pipe(w)}),w.entriesCount=p}catch(g){w.error(g)}return w}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(k,M,N){function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var c=new d;for(var s in this)typeof this[s]!="function"&&(c[s]=this[s]);return c}}(d.prototype=k("./object")).loadAsync=k("./load"),d.support=k("./support"),d.defaults=k("./defaults"),d.version="3.10.1",d.loadAsync=function(c,s){return new d().loadAsync(c,s)},d.external=k("./external"),M.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(k,M,N){var d=k("./utils"),c=k("./external"),s=k("./utf8"),u=k("./zipEntries"),y=k("./stream/Crc32Probe"),w=k("./nodejsUtils");function p(g){return new c.Promise(function(a,m){var i=g.decompressed.getContentWorker().pipe(new y);i.on("error",function(h){m(h)}).on("end",function(){i.streamInfo.crc32!==g.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):a()}).resume()})}M.exports=function(g,a){var m=this;return a=d.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),w.isNode&&w.isStream(g)?c.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):d.prepareContent("the loaded zip file",g,!0,a.optimizedBinaryString,a.base64).then(function(i){var h=new u(a);return h.load(i),h}).then(function(i){var h=[c.Promise.resolve(i)],o=i.files;if(a.checkCRC32)for(var x=0;x<o.length;x++)h.push(p(o[x]));return c.Promise.all(h)}).then(function(i){for(var h=i.shift(),o=h.files,x=0;x<o.length;x++){var _=o[x],S=_.fileNameStr,C=d.resolve(_.fileNameStr);m.file(C,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:a.createFolders}),_.dir||(m.file(C).unsafeOriginalName=S)}return h.zipComment.length&&(m.comment=h.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(k,M,N){var d=k("../utils"),c=k("../stream/GenericWorker");function s(u,y){c.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(y)}d.inherits(s,c),s.prototype._bindStream=function(u){var y=this;(this._stream=u).pause(),u.on("data",function(w){y.push({data:w,meta:{percent:0}})}).on("error",function(w){y.isPaused?this.generatedError=w:y.error(w)}).on("end",function(){y.isPaused?y._upstreamEnded=!0:y.end()})},s.prototype.pause=function(){return!!c.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},M.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(k,M,N){var d=k("readable-stream").Readable;function c(s,u,y){d.call(this,u),this._helper=s;var w=this;s.on("data",function(p,g){w.push(p)||w._helper.pause(),y&&y(g)}).on("error",function(p){w.emit("error",p)}).on("end",function(){w.push(null)})}k("../utils").inherits(c,d),c.prototype._read=function(){this._helper.resume()},M.exports=c},{"../utils":32,"readable-stream":16}],14:[function(k,M,N){M.exports={isNode:typeof Buffer<"u",newBufferFrom:function(d,c){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(d,c);if(typeof d=="number")throw new Error('The "data" argument must not be a number');return new Buffer(d,c)},allocBuffer:function(d){if(Buffer.alloc)return Buffer.alloc(d);var c=new Buffer(d);return c.fill(0),c},isBuffer:function(d){return Buffer.isBuffer(d)},isStream:function(d){return d&&typeof d.on=="function"&&typeof d.pause=="function"&&typeof d.resume=="function"}}},{}],15:[function(k,M,N){function d(C,U,O){var P,R=s.getTypeOf(U),L=s.extend(O||{},w);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(C=o(C)),L.createFolders&&(P=h(C))&&x.call(this,P,!0);var re=R==="string"&&L.binary===!1&&L.base64===!1;O&&O.binary!==void 0||(L.binary=!re),(U instanceof p&&U.uncompressedSize===0||L.dir||!U||U.length===0)&&(L.base64=!1,L.binary=!0,U="",L.compression="STORE",R="string");var b=null;b=U instanceof p||U instanceof u?U:m.isNode&&m.isStream(U)?new i(C,U):s.prepareContent(C,U,L.binary,L.optimizedBinaryString,L.base64);var B=new g(C,b,L);this.files[C]=B}var c=k("./utf8"),s=k("./utils"),u=k("./stream/GenericWorker"),y=k("./stream/StreamHelper"),w=k("./defaults"),p=k("./compressedObject"),g=k("./zipObject"),a=k("./generate"),m=k("./nodejsUtils"),i=k("./nodejs/NodejsStreamInputAdapter"),h=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var U=C.lastIndexOf("/");return 0<U?C.substring(0,U):""},o=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},x=function(C,U){return U=U!==void 0?U:w.createFolders,C=o(C),this.files[C]||d.call(this,C,null,{dir:!0,createFolders:U}),this.files[C]};function _(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var U,O,P;for(U in this.files)P=this.files[U],(O=U.slice(this.root.length,U.length))&&U.slice(0,this.root.length)===this.root&&C(O,P)},filter:function(C){var U=[];return this.forEach(function(O,P){C(O,P)&&U.push(P)}),U},file:function(C,U,O){if(arguments.length!==1)return C=this.root+C,d.call(this,C,U,O),this;if(_(C)){var P=C;return this.filter(function(L,re){return!re.dir&&P.test(L)})}var R=this.files[this.root+C];return R&&!R.dir?R:null},folder:function(C){if(!C)return this;if(_(C))return this.filter(function(R,L){return L.dir&&C.test(R)});var U=this.root+C,O=x.call(this,U),P=this.clone();return P.root=O.name,P},remove:function(C){C=this.root+C;var U=this.files[C];if(U||(C.slice(-1)!=="/"&&(C+="/"),U=this.files[C]),U&&!U.dir)delete this.files[C];else for(var O=this.filter(function(R,L){return L.name.slice(0,C.length)===C}),P=0;P<O.length;P++)delete this.files[O[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var U,O={};try{if((O=s.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:c.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");s.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var P=O.comment||this.comment||"";U=a.generateWorker(this,O,P)}catch(R){(U=new u("error")).error(R)}return new y(U,O.type||"string",O.mimeType)},generateAsync:function(C,U){return this.generateInternalStream(C).accumulate(U)},generateNodeStream:function(C,U){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(U)}};M.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(k,M,N){M.exports=k("stream")},{stream:void 0}],17:[function(k,M,N){var d=k("./DataReader");function c(s){d.call(this,s);for(var u=0;u<this.data.length;u++)s[u]=255&s[u]}k("../utils").inherits(c,d),c.prototype.byteAt=function(s){return this.data[this.zero+s]},c.prototype.lastIndexOfSignature=function(s){for(var u=s.charCodeAt(0),y=s.charCodeAt(1),w=s.charCodeAt(2),p=s.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===u&&this.data[g+1]===y&&this.data[g+2]===w&&this.data[g+3]===p)return g-this.zero;return-1},c.prototype.readAndCheckSignature=function(s){var u=s.charCodeAt(0),y=s.charCodeAt(1),w=s.charCodeAt(2),p=s.charCodeAt(3),g=this.readData(4);return u===g[0]&&y===g[1]&&w===g[2]&&p===g[3]},c.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,u},M.exports=c},{"../utils":32,"./DataReader":18}],18:[function(k,M,N){var d=k("../utils");function c(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}c.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var u,y=0;for(this.checkOffset(s),u=this.index+s-1;u>=this.index;u--)y=(y<<8)+this.byteAt(u);return this.index+=s,y},readString:function(s){return d.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},M.exports=c},{"../utils":32}],19:[function(k,M,N){var d=k("./Uint8ArrayReader");function c(s){d.call(this,s)}k("../utils").inherits(c,d),c.prototype.readData=function(s){this.checkOffset(s);var u=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,u},M.exports=c},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(k,M,N){var d=k("./DataReader");function c(s){d.call(this,s)}k("../utils").inherits(c,d),c.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},c.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},c.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},c.prototype.readData=function(s){this.checkOffset(s);var u=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,u},M.exports=c},{"../utils":32,"./DataReader":18}],21:[function(k,M,N){var d=k("./ArrayReader");function c(s){d.call(this,s)}k("../utils").inherits(c,d),c.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,u},M.exports=c},{"../utils":32,"./ArrayReader":17}],22:[function(k,M,N){var d=k("../utils"),c=k("../support"),s=k("./ArrayReader"),u=k("./StringReader"),y=k("./NodeBufferReader"),w=k("./Uint8ArrayReader");M.exports=function(p){var g=d.getTypeOf(p);return d.checkSupport(g),g!=="string"||c.uint8array?g==="nodebuffer"?new y(p):c.uint8array?new w(d.transformTo("uint8array",p)):new s(d.transformTo("array",p)):new u(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(k,M,N){N.LOCAL_FILE_HEADER="PK",N.CENTRAL_FILE_HEADER="PK",N.CENTRAL_DIRECTORY_END="PK",N.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",N.ZIP64_CENTRAL_DIRECTORY_END="PK",N.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(k,M,N){var d=k("./GenericWorker"),c=k("../utils");function s(u){d.call(this,"ConvertWorker to "+u),this.destType=u}c.inherits(s,d),s.prototype.processChunk=function(u){this.push({data:c.transformTo(this.destType,u.data),meta:u.meta})},M.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(k,M,N){var d=k("./GenericWorker"),c=k("../crc32");function s(){d.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}k("../utils").inherits(s,d),s.prototype.processChunk=function(u){this.streamInfo.crc32=c(u.data,this.streamInfo.crc32||0),this.push(u)},M.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(k,M,N){var d=k("../utils"),c=k("./GenericWorker");function s(u){c.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}d.inherits(s,c),s.prototype.processChunk=function(u){if(u){var y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=y+u.data.length}c.prototype.processChunk.call(this,u)},M.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(k,M,N){var d=k("../utils"),c=k("./GenericWorker");function s(u){c.call(this,"DataWorker");var y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(w){y.dataIsReady=!0,y.data=w,y.max=w&&w.length||0,y.type=d.getTypeOf(w),y.isPaused||y._tickAndRepeat()},function(w){y.error(w)})}d.inherits(s,c),s.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,d.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(d.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,y);break;case"uint8array":u=this.data.subarray(this.index,y);break;case"array":case"nodebuffer":u=this.data.slice(this.index,y)}return this.index=y,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},M.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(k,M,N){function d(c){this.name=c||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(c){this.emit("data",c)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(c){this.emit("error",c)}return!0},error:function(c){return!this.isFinished&&(this.isPaused?this.generatedError=c:(this.isFinished=!0,this.emit("error",c),this.previous&&this.previous.error(c),this.cleanUp()),!0)},on:function(c,s){return this._listeners[c].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(c,s){if(this._listeners[c])for(var u=0;u<this._listeners[c].length;u++)this._listeners[c][u].call(this,s)},pipe:function(c){return c.registerPrevious(this)},registerPrevious:function(c){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=c.streamInfo,this.mergeStreamInfo(),this.previous=c;var s=this;return c.on("data",function(u){s.processChunk(u)}),c.on("end",function(){s.end()}),c.on("error",function(u){s.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var c=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),c=!0),this.previous&&this.previous.resume(),!c},flush:function(){},processChunk:function(c){this.push(c)},withStreamInfo:function(c,s){return this.extraStreamInfo[c]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var c in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,c)&&(this.streamInfo[c]=this.extraStreamInfo[c])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var c="Worker "+this.name;return this.previous?this.previous+" -> "+c:c}},M.exports=d},{}],29:[function(k,M,N){var d=k("../utils"),c=k("./ConvertWorker"),s=k("./GenericWorker"),u=k("../base64"),y=k("../support"),w=k("../external"),p=null;if(y.nodestream)try{p=k("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(m,i){return new w.Promise(function(h,o){var x=[],_=m._internalType,S=m._outputType,C=m._mimeType;m.on("data",function(U,O){x.push(U),i&&i(O)}).on("error",function(U){x=[],o(U)}).on("end",function(){try{var U=function(O,P,R){switch(O){case"blob":return d.newBlob(d.transformTo("arraybuffer",P),R);case"base64":return u.encode(P);default:return d.transformTo(O,P)}}(S,function(O,P){var R,L=0,re=null,b=0;for(R=0;R<P.length;R++)b+=P[R].length;switch(O){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(re=new Uint8Array(b),R=0;R<P.length;R++)re.set(P[R],L),L+=P[R].length;return re;case"nodebuffer":return Buffer.concat(P);default:throw new Error("concat : unsupported type '"+O+"'")}}(_,x),C);h(U)}catch(O){o(O)}x=[]}).resume()})}function a(m,i,h){var o=i;switch(i){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=i,this._mimeType=h,d.checkSupport(o),this._worker=m.pipe(new c(o)),m.lock()}catch(x){this._worker=new s("error"),this._worker.error(x)}}a.prototype={accumulate:function(m){return g(this,m)},on:function(m,i){var h=this;return m==="data"?this._worker.on(m,function(o){i.call(h,o.data,o.meta)}):this._worker.on(m,function(){d.delay(i,arguments,h)}),this},resume:function(){return d.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(d.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},m)}},M.exports=a},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(k,M,N){if(N.base64=!0,N.array=!0,N.string=!0,N.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",N.nodebuffer=typeof Buffer<"u",N.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")N.blob=!1;else{var d=new ArrayBuffer(0);try{N.blob=new Blob([d],{type:"application/zip"}).size===0}catch{try{var c=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);c.append(d),N.blob=c.getBlob("application/zip").size===0}catch{N.blob=!1}}}try{N.nodestream=!!k("readable-stream").Readable}catch{N.nodestream=!1}},{"readable-stream":16}],31:[function(k,M,N){for(var d=k("./utils"),c=k("./support"),s=k("./nodejsUtils"),u=k("./stream/GenericWorker"),y=new Array(256),w=0;w<256;w++)y[w]=252<=w?6:248<=w?5:240<=w?4:224<=w?3:192<=w?2:1;y[254]=y[254]=1;function p(){u.call(this,"utf-8 decode"),this.leftOver=null}function g(){u.call(this,"utf-8 encode")}N.utf8encode=function(a){return c.nodebuffer?s.newBufferFrom(a,"utf-8"):function(m){var i,h,o,x,_,S=m.length,C=0;for(x=0;x<S;x++)(64512&(h=m.charCodeAt(x)))==55296&&x+1<S&&(64512&(o=m.charCodeAt(x+1)))==56320&&(h=65536+(h-55296<<10)+(o-56320),x++),C+=h<128?1:h<2048?2:h<65536?3:4;for(i=c.uint8array?new Uint8Array(C):new Array(C),x=_=0;_<C;x++)(64512&(h=m.charCodeAt(x)))==55296&&x+1<S&&(64512&(o=m.charCodeAt(x+1)))==56320&&(h=65536+(h-55296<<10)+(o-56320),x++),h<128?i[_++]=h:(h<2048?i[_++]=192|h>>>6:(h<65536?i[_++]=224|h>>>12:(i[_++]=240|h>>>18,i[_++]=128|h>>>12&63),i[_++]=128|h>>>6&63),i[_++]=128|63&h);return i}(a)},N.utf8decode=function(a){return c.nodebuffer?d.transformTo("nodebuffer",a).toString("utf-8"):function(m){var i,h,o,x,_=m.length,S=new Array(2*_);for(i=h=0;i<_;)if((o=m[i++])<128)S[h++]=o;else if(4<(x=y[o]))S[h++]=65533,i+=x-1;else{for(o&=x===2?31:x===3?15:7;1<x&&i<_;)o=o<<6|63&m[i++],x--;1<x?S[h++]=65533:o<65536?S[h++]=o:(o-=65536,S[h++]=55296|o>>10&1023,S[h++]=56320|1023&o)}return S.length!==h&&(S.subarray?S=S.subarray(0,h):S.length=h),d.applyFromCharCode(S)}(a=d.transformTo(c.uint8array?"uint8array":"array",a))},d.inherits(p,u),p.prototype.processChunk=function(a){var m=d.transformTo(c.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(c.uint8array){var i=m;(m=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),m.set(i,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var h=function(x,_){var S;for((_=_||x.length)>x.length&&(_=x.length),S=_-1;0<=S&&(192&x[S])==128;)S--;return S<0||S===0?_:S+y[x[S]]>_?S:_}(m),o=m;h!==m.length&&(c.uint8array?(o=m.subarray(0,h),this.leftOver=m.subarray(h,m.length)):(o=m.slice(0,h),this.leftOver=m.slice(h,m.length))),this.push({data:N.utf8decode(o),meta:a.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:N.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},N.Utf8DecodeWorker=p,d.inherits(g,u),g.prototype.processChunk=function(a){this.push({data:N.utf8encode(a.data),meta:a.meta})},N.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(k,M,N){var d=k("./support"),c=k("./base64"),s=k("./nodejsUtils"),u=k("./external");function y(i){return i}function w(i,h){for(var o=0;o<i.length;++o)h[o]=255&i.charCodeAt(o);return h}k("setimmediate"),N.newBlob=function(i,h){N.checkSupport("blob");try{return new Blob([i],{type:h})}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return o.append(i),o.getBlob(h)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(i,h,o){var x=[],_=0,S=i.length;if(S<=o)return String.fromCharCode.apply(null,i);for(;_<S;)h==="array"||h==="nodebuffer"?x.push(String.fromCharCode.apply(null,i.slice(_,Math.min(_+o,S)))):x.push(String.fromCharCode.apply(null,i.subarray(_,Math.min(_+o,S)))),_+=o;return x.join("")},stringifyByChar:function(i){for(var h="",o=0;o<i.length;o++)h+=String.fromCharCode(i[o]);return h},applyCanBeUsed:{uint8array:function(){try{return d.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return d.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function g(i){var h=65536,o=N.getTypeOf(i),x=!0;if(o==="uint8array"?x=p.applyCanBeUsed.uint8array:o==="nodebuffer"&&(x=p.applyCanBeUsed.nodebuffer),x)for(;1<h;)try{return p.stringifyByChunk(i,o,h)}catch{h=Math.floor(h/2)}return p.stringifyByChar(i)}function a(i,h){for(var o=0;o<i.length;o++)h[o]=i[o];return h}N.applyFromCharCode=g;var m={};m.string={string:y,array:function(i){return w(i,new Array(i.length))},arraybuffer:function(i){return m.string.uint8array(i).buffer},uint8array:function(i){return w(i,new Uint8Array(i.length))},nodebuffer:function(i){return w(i,s.allocBuffer(i.length))}},m.array={string:g,array:y,arraybuffer:function(i){return new Uint8Array(i).buffer},uint8array:function(i){return new Uint8Array(i)},nodebuffer:function(i){return s.newBufferFrom(i)}},m.arraybuffer={string:function(i){return g(new Uint8Array(i))},array:function(i){return a(new Uint8Array(i),new Array(i.byteLength))},arraybuffer:y,uint8array:function(i){return new Uint8Array(i)},nodebuffer:function(i){return s.newBufferFrom(new Uint8Array(i))}},m.uint8array={string:g,array:function(i){return a(i,new Array(i.length))},arraybuffer:function(i){return i.buffer},uint8array:y,nodebuffer:function(i){return s.newBufferFrom(i)}},m.nodebuffer={string:g,array:function(i){return a(i,new Array(i.length))},arraybuffer:function(i){return m.nodebuffer.uint8array(i).buffer},uint8array:function(i){return a(i,new Uint8Array(i.length))},nodebuffer:y},N.transformTo=function(i,h){if(h=h||"",!i)return h;N.checkSupport(i);var o=N.getTypeOf(h);return m[o][i](h)},N.resolve=function(i){for(var h=i.split("/"),o=[],x=0;x<h.length;x++){var _=h[x];_==="."||_===""&&x!==0&&x!==h.length-1||(_===".."?o.pop():o.push(_))}return o.join("/")},N.getTypeOf=function(i){return typeof i=="string"?"string":Object.prototype.toString.call(i)==="[object Array]"?"array":d.nodebuffer&&s.isBuffer(i)?"nodebuffer":d.uint8array&&i instanceof Uint8Array?"uint8array":d.arraybuffer&&i instanceof ArrayBuffer?"arraybuffer":void 0},N.checkSupport=function(i){if(!d[i.toLowerCase()])throw new Error(i+" is not supported by this platform")},N.MAX_VALUE_16BITS=65535,N.MAX_VALUE_32BITS=-1,N.pretty=function(i){var h,o,x="";for(o=0;o<(i||"").length;o++)x+="\\x"+((h=i.charCodeAt(o))<16?"0":"")+h.toString(16).toUpperCase();return x},N.delay=function(i,h,o){setImmediate(function(){i.apply(o||null,h||[])})},N.inherits=function(i,h){function o(){}o.prototype=h.prototype,i.prototype=new o},N.extend=function(){var i,h,o={};for(i=0;i<arguments.length;i++)for(h in arguments[i])Object.prototype.hasOwnProperty.call(arguments[i],h)&&o[h]===void 0&&(o[h]=arguments[i][h]);return o},N.prepareContent=function(i,h,o,x,_){return u.Promise.resolve(h).then(function(S){return d.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new u.Promise(function(C,U){var O=new FileReader;O.onload=function(P){C(P.target.result)},O.onerror=function(P){U(P.target.error)},O.readAsArrayBuffer(S)}):S}).then(function(S){var C=N.getTypeOf(S);return C?(C==="arraybuffer"?S=N.transformTo("uint8array",S):C==="string"&&(_?S=c.decode(S):o&&x!==!0&&(S=function(U){return w(U,d.uint8array?new Uint8Array(U.length):new Array(U.length))}(S))),S):u.Promise.reject(new Error("Can't read the data of '"+i+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(k,M,N){var d=k("./reader/readerFor"),c=k("./utils"),s=k("./signature"),u=k("./zipEntry"),y=k("./support");function w(p){this.files=[],this.loadOptions=p}w.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+c.pretty(g)+", expected "+c.pretty(p)+")")}},isSignature:function(p,g){var a=this.reader.index;this.reader.setIndex(p);var m=this.reader.readString(4)===g;return this.reader.setIndex(a),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),g=y.uint8array?"uint8array":"array",a=c.transformTo(g,p);this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,g,a,m=this.zip64EndOfCentralSize-44;0<m;)p=this.reader.readInt(2),g=this.reader.readInt(4),a=this.reader.readData(g),this.zip64ExtensibleData[p]={id:p,length:g,value:a}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,g;for(p=0;p<this.files.length;p++)g=this.files[p],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(p=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var g=p;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===c.MAX_VALUE_16BITS||this.diskWithCentralDirStart===c.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===c.MAX_VALUE_16BITS||this.centralDirRecords===c.MAX_VALUE_16BITS||this.centralDirSize===c.MAX_VALUE_32BITS||this.centralDirOffset===c.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a+=20,a+=12+this.zip64EndOfCentralSize);var m=g-a;if(0<m)this.isSignature(g,s.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(p){this.reader=d(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},M.exports=w},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(k,M,N){var d=k("./reader/readerFor"),c=k("./utils"),s=k("./compressedObject"),u=k("./crc32"),y=k("./utf8"),w=k("./compressions"),p=k("./support");function g(a,m){this.options=a,this.loadOptions=m}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(a){var m,i;if(a.skip(22),this.fileNameLength=a.readInt(2),i=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(i),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(h){for(var o in w)if(Object.prototype.hasOwnProperty.call(w,o)&&w[o].magic===h)return w[o];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+c.pretty(this.compressionMethod)+" unknown (inner file : "+c.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,m,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var m=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(m),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a==0&&(this.dosPermissions=63&this.externalFileAttributes),a==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var a=d(this.extraFields[1].value);this.uncompressedSize===c.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===c.MAX_VALUE_32BITS&&(this.compressedSize=a.readInt(8)),this.localHeaderOffset===c.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===c.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4))}},readExtraFields:function(a){var m,i,h,o=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index+4<o;)m=a.readInt(2),i=a.readInt(2),h=a.readData(i),this.extraFields[m]={id:m,length:i,value:h};a.setIndex(o)},handleUTF8:function(){var a=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=y.utf8decode(this.fileName),this.fileCommentStr=y.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var i=c.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var h=this.findExtraFieldUnicodeComment();if(h!==null)this.fileCommentStr=h;else{var o=c.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var m=d(a.value);return m.readInt(1)!==1||u(this.fileName)!==m.readInt(4)?null:y.utf8decode(m.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var m=d(a.value);return m.readInt(1)!==1||u(this.fileComment)!==m.readInt(4)?null:y.utf8decode(m.readData(a.length-5))}return null}},M.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(k,M,N){function d(m,i,h){this.name=m,this.dir=h.dir,this.date=h.date,this.comment=h.comment,this.unixPermissions=h.unixPermissions,this.dosPermissions=h.dosPermissions,this._data=i,this._dataBinary=h.binary,this.options={compression:h.compression,compressionOptions:h.compressionOptions}}var c=k("./stream/StreamHelper"),s=k("./stream/DataWorker"),u=k("./utf8"),y=k("./compressedObject"),w=k("./stream/GenericWorker");d.prototype={internalStream:function(m){var i=null,h="string";try{if(!m)throw new Error("No output type specified.");var o=(h=m.toLowerCase())==="string"||h==="text";h!=="binarystring"&&h!=="text"||(h="string"),i=this._decompressWorker();var x=!this._dataBinary;x&&!o&&(i=i.pipe(new u.Utf8EncodeWorker)),!x&&o&&(i=i.pipe(new u.Utf8DecodeWorker))}catch(_){(i=new w("error")).error(_)}return new c(i,h,"")},async:function(m,i){return this.internalStream(m).accumulate(i)},nodeStream:function(m,i){return this.internalStream(m||"nodebuffer").toNodejsStream(i)},_compressWorker:function(m,i){if(this._data instanceof y&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var h=this._decompressWorker();return this._dataBinary||(h=h.pipe(new u.Utf8EncodeWorker)),y.createWorkerFrom(h,m,i)},_decompressWorker:function(){return this._data instanceof y?this._data.getContentWorker():this._data instanceof w?this._data:new s(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},a=0;a<p.length;a++)d.prototype[p[a]]=g;M.exports=d},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(k,M,N){(function(d){var c,s,u=d.MutationObserver||d.WebKitMutationObserver;if(u){var y=0,w=new u(m),p=d.document.createTextNode("");w.observe(p,{characterData:!0}),c=function(){p.data=y=++y%2}}else if(d.setImmediate||d.MessageChannel===void 0)c="document"in d&&"onreadystatechange"in d.document.createElement("script")?function(){var i=d.document.createElement("script");i.onreadystatechange=function(){m(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},d.document.documentElement.appendChild(i)}:function(){setTimeout(m,0)};else{var g=new d.MessageChannel;g.port1.onmessage=m,c=function(){g.port2.postMessage(0)}}var a=[];function m(){var i,h;s=!0;for(var o=a.length;o;){for(h=a,a=[],i=-1;++i<o;)h[i]();o=a.length}s=!1}M.exports=function(i){a.push(i)!==1||s||c()}}).call(this,typeof Qe<"u"?Qe:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(k,M,N){var d=k("immediate");function c(){}var s={},u=["REJECTED"],y=["FULFILLED"],w=["PENDING"];function p(o){if(typeof o!="function")throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,o!==c&&i(this,o)}function g(o,x,_){this.promise=o,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function a(o,x,_){d(function(){var S;try{S=x(_)}catch(C){return s.reject(o,C)}S===o?s.reject(o,new TypeError("Cannot resolve promise with itself")):s.resolve(o,S)})}function m(o){var x=o&&o.then;if(o&&(typeof o=="object"||typeof o=="function")&&typeof x=="function")return function(){x.apply(o,arguments)}}function i(o,x){var _=!1;function S(O){_||(_=!0,s.reject(o,O))}function C(O){_||(_=!0,s.resolve(o,O))}var U=h(function(){x(C,S)});U.status==="error"&&S(U.value)}function h(o,x){var _={};try{_.value=o(x),_.status="success"}catch(S){_.status="error",_.value=S}return _}(M.exports=p).prototype.finally=function(o){if(typeof o!="function")return this;var x=this.constructor;return this.then(function(_){return x.resolve(o()).then(function(){return _})},function(_){return x.resolve(o()).then(function(){throw _})})},p.prototype.catch=function(o){return this.then(null,o)},p.prototype.then=function(o,x){if(typeof o!="function"&&this.state===y||typeof x!="function"&&this.state===u)return this;var _=new this.constructor(c);return this.state!==w?a(_,this.state===y?o:x,this.outcome):this.queue.push(new g(_,o,x)),_},g.prototype.callFulfilled=function(o){s.resolve(this.promise,o)},g.prototype.otherCallFulfilled=function(o){a(this.promise,this.onFulfilled,o)},g.prototype.callRejected=function(o){s.reject(this.promise,o)},g.prototype.otherCallRejected=function(o){a(this.promise,this.onRejected,o)},s.resolve=function(o,x){var _=h(m,x);if(_.status==="error")return s.reject(o,_.value);var S=_.value;if(S)i(o,S);else{o.state=y,o.outcome=x;for(var C=-1,U=o.queue.length;++C<U;)o.queue[C].callFulfilled(x)}return o},s.reject=function(o,x){o.state=u,o.outcome=x;for(var _=-1,S=o.queue.length;++_<S;)o.queue[_].callRejected(x);return o},p.resolve=function(o){return o instanceof this?o:s.resolve(new this(c),o)},p.reject=function(o){var x=new this(c);return s.reject(x,o)},p.all=function(o){var x=this;if(Object.prototype.toString.call(o)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=o.length,S=!1;if(!_)return this.resolve([]);for(var C=new Array(_),U=0,O=-1,P=new this(c);++O<_;)R(o[O],O);return P;function R(L,re){x.resolve(L).then(function(b){C[re]=b,++U!==_||S||(S=!0,s.resolve(P,C))},function(b){S||(S=!0,s.reject(P,b))})}},p.race=function(o){var x=this;if(Object.prototype.toString.call(o)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=o.length,S=!1;if(!_)return this.resolve([]);for(var C=-1,U=new this(c);++C<_;)O=o[C],x.resolve(O).then(function(P){S||(S=!0,s.resolve(U,P))},function(P){S||(S=!0,s.reject(U,P))});var O;return U}},{immediate:36}],38:[function(k,M,N){var d={};(0,k("./lib/utils/common").assign)(d,k("./lib/deflate"),k("./lib/inflate"),k("./lib/zlib/constants")),M.exports=d},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(k,M,N){var d=k("./zlib/deflate"),c=k("./utils/common"),s=k("./utils/strings"),u=k("./zlib/messages"),y=k("./zlib/zstream"),w=Object.prototype.toString,p=0,g=-1,a=0,m=8;function i(o){if(!(this instanceof i))return new i(o);this.options=c.assign({level:g,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:a,to:""},o||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var _=d.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(_!==p)throw new Error(u[_]);if(x.header&&d.deflateSetHeader(this.strm,x.header),x.dictionary){var S;if(S=typeof x.dictionary=="string"?s.string2buf(x.dictionary):w.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(_=d.deflateSetDictionary(this.strm,S))!==p)throw new Error(u[_]);this._dict_set=!0}}function h(o,x){var _=new i(x);if(_.push(o,!0),_.err)throw _.msg||u[_.err];return _.result}i.prototype.push=function(o,x){var _,S,C=this.strm,U=this.options.chunkSize;if(this.ended)return!1;S=x===~~x?x:x===!0?4:0,typeof o=="string"?C.input=s.string2buf(o):w.call(o)==="[object ArrayBuffer]"?C.input=new Uint8Array(o):C.input=o,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new c.Buf8(U),C.next_out=0,C.avail_out=U),(_=d.deflate(C,S))!==1&&_!==p)return this.onEnd(_),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(c.shrinkBuf(C.output,C.next_out))):this.onData(c.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&_!==1);return S===4?(_=d.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===p):S!==2||(this.onEnd(p),!(C.avail_out=0))},i.prototype.onData=function(o){this.chunks.push(o)},i.prototype.onEnd=function(o){o===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg},N.Deflate=i,N.deflate=h,N.deflateRaw=function(o,x){return(x=x||{}).raw=!0,h(o,x)},N.gzip=function(o,x){return(x=x||{}).gzip=!0,h(o,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(k,M,N){var d=k("./zlib/inflate"),c=k("./utils/common"),s=k("./utils/strings"),u=k("./zlib/constants"),y=k("./zlib/messages"),w=k("./zlib/zstream"),p=k("./zlib/gzheader"),g=Object.prototype.toString;function a(i){if(!(this instanceof a))return new a(i);this.options=c.assign({chunkSize:16384,windowBits:0,to:""},i||{});var h=this.options;h.raw&&0<=h.windowBits&&h.windowBits<16&&(h.windowBits=-h.windowBits,h.windowBits===0&&(h.windowBits=-15)),!(0<=h.windowBits&&h.windowBits<16)||i&&i.windowBits||(h.windowBits+=32),15<h.windowBits&&h.windowBits<48&&!(15&h.windowBits)&&(h.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;var o=d.inflateInit2(this.strm,h.windowBits);if(o!==u.Z_OK)throw new Error(y[o]);this.header=new p,d.inflateGetHeader(this.strm,this.header)}function m(i,h){var o=new a(h);if(o.push(i,!0),o.err)throw o.msg||y[o.err];return o.result}a.prototype.push=function(i,h){var o,x,_,S,C,U,O=this.strm,P=this.options.chunkSize,R=this.options.dictionary,L=!1;if(this.ended)return!1;x=h===~~h?h:h===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof i=="string"?O.input=s.binstring2buf(i):g.call(i)==="[object ArrayBuffer]"?O.input=new Uint8Array(i):O.input=i,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new c.Buf8(P),O.next_out=0,O.avail_out=P),(o=d.inflate(O,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&R&&(U=typeof R=="string"?s.string2buf(R):g.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,o=d.inflateSetDictionary(this.strm,U)),o===u.Z_BUF_ERROR&&L===!0&&(o=u.Z_OK,L=!1),o!==u.Z_STREAM_END&&o!==u.Z_OK)return this.onEnd(o),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&o!==u.Z_STREAM_END&&(O.avail_in!==0||x!==u.Z_FINISH&&x!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=s.utf8border(O.output,O.next_out),S=O.next_out-_,C=s.buf2string(O.output,_),O.next_out=S,O.avail_out=P-S,S&&c.arraySet(O.output,O.output,_,S,0),this.onData(C)):this.onData(c.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(L=!0)}while((0<O.avail_in||O.avail_out===0)&&o!==u.Z_STREAM_END);return o===u.Z_STREAM_END&&(x=u.Z_FINISH),x===u.Z_FINISH?(o=d.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===u.Z_OK):x!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(O.avail_out=0))},a.prototype.onData=function(i){this.chunks.push(i)},a.prototype.onEnd=function(i){i===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg},N.Inflate=a,N.inflate=m,N.inflateRaw=function(i,h){return(h=h||{}).raw=!0,m(i,h)},N.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(k,M,N){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";N.assign=function(u){for(var y=Array.prototype.slice.call(arguments,1);y.length;){var w=y.shift();if(w){if(typeof w!="object")throw new TypeError(w+"must be non-object");for(var p in w)w.hasOwnProperty(p)&&(u[p]=w[p])}}return u},N.shrinkBuf=function(u,y){return u.length===y?u:u.subarray?u.subarray(0,y):(u.length=y,u)};var c={arraySet:function(u,y,w,p,g){if(y.subarray&&u.subarray)u.set(y.subarray(w,w+p),g);else for(var a=0;a<p;a++)u[g+a]=y[w+a]},flattenChunks:function(u){var y,w,p,g,a,m;for(y=p=0,w=u.length;y<w;y++)p+=u[y].length;for(m=new Uint8Array(p),y=g=0,w=u.length;y<w;y++)a=u[y],m.set(a,g),g+=a.length;return m}},s={arraySet:function(u,y,w,p,g){for(var a=0;a<p;a++)u[g+a]=y[w+a]},flattenChunks:function(u){return[].concat.apply([],u)}};N.setTyped=function(u){u?(N.Buf8=Uint8Array,N.Buf16=Uint16Array,N.Buf32=Int32Array,N.assign(N,c)):(N.Buf8=Array,N.Buf16=Array,N.Buf32=Array,N.assign(N,s))},N.setTyped(d)},{}],42:[function(k,M,N){var d=k("./common"),c=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{c=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var u=new d.Buf8(256),y=0;y<256;y++)u[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;function w(p,g){if(g<65537&&(p.subarray&&s||!p.subarray&&c))return String.fromCharCode.apply(null,d.shrinkBuf(p,g));for(var a="",m=0;m<g;m++)a+=String.fromCharCode(p[m]);return a}u[254]=u[254]=1,N.string2buf=function(p){var g,a,m,i,h,o=p.length,x=0;for(i=0;i<o;i++)(64512&(a=p.charCodeAt(i)))==55296&&i+1<o&&(64512&(m=p.charCodeAt(i+1)))==56320&&(a=65536+(a-55296<<10)+(m-56320),i++),x+=a<128?1:a<2048?2:a<65536?3:4;for(g=new d.Buf8(x),i=h=0;h<x;i++)(64512&(a=p.charCodeAt(i)))==55296&&i+1<o&&(64512&(m=p.charCodeAt(i+1)))==56320&&(a=65536+(a-55296<<10)+(m-56320),i++),a<128?g[h++]=a:(a<2048?g[h++]=192|a>>>6:(a<65536?g[h++]=224|a>>>12:(g[h++]=240|a>>>18,g[h++]=128|a>>>12&63),g[h++]=128|a>>>6&63),g[h++]=128|63&a);return g},N.buf2binstring=function(p){return w(p,p.length)},N.binstring2buf=function(p){for(var g=new d.Buf8(p.length),a=0,m=g.length;a<m;a++)g[a]=p.charCodeAt(a);return g},N.buf2string=function(p,g){var a,m,i,h,o=g||p.length,x=new Array(2*o);for(a=m=0;a<o;)if((i=p[a++])<128)x[m++]=i;else if(4<(h=u[i]))x[m++]=65533,a+=h-1;else{for(i&=h===2?31:h===3?15:7;1<h&&a<o;)i=i<<6|63&p[a++],h--;1<h?x[m++]=65533:i<65536?x[m++]=i:(i-=65536,x[m++]=55296|i>>10&1023,x[m++]=56320|1023&i)}return w(x,m)},N.utf8border=function(p,g){var a;for((g=g||p.length)>p.length&&(g=p.length),a=g-1;0<=a&&(192&p[a])==128;)a--;return a<0||a===0?g:a+u[p[a]]>g?a:g}},{"./common":41}],43:[function(k,M,N){M.exports=function(d,c,s,u){for(var y=65535&d|0,w=d>>>16&65535|0,p=0;s!==0;){for(s-=p=2e3<s?2e3:s;w=w+(y=y+c[u++]|0)|0,--p;);y%=65521,w%=65521}return y|w<<16|0}},{}],44:[function(k,M,N){M.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(k,M,N){var d=function(){for(var c,s=[],u=0;u<256;u++){c=u;for(var y=0;y<8;y++)c=1&c?3988292384^c>>>1:c>>>1;s[u]=c}return s}();M.exports=function(c,s,u,y){var w=d,p=y+u;c^=-1;for(var g=y;g<p;g++)c=c>>>8^w[255&(c^s[g])];return-1^c}},{}],46:[function(k,M,N){var d,c=k("../utils/common"),s=k("./trees"),u=k("./adler32"),y=k("./crc32"),w=k("./messages"),p=0,g=4,a=0,m=-2,i=-1,h=4,o=2,x=8,_=9,S=286,C=30,U=19,O=2*S+1,P=15,R=3,L=258,re=L+R+1,b=42,B=113,r=1,D=2,ne=3,$=4;function de(e,T){return e.msg=w[T],T}function H(e){return(e<<1)-(4<e?9:0)}function se(e){for(var T=e.length;0<=--T;)e[T]=0}function I(e){var T=e.state,A=T.pending;A>e.avail_out&&(A=e.avail_out),A!==0&&(c.arraySet(e.output,T.pending_buf,T.pending_out,A,e.next_out),e.next_out+=A,T.pending_out+=A,e.total_out+=A,e.avail_out-=A,T.pending-=A,T.pending===0&&(T.pending_out=0))}function E(e,T){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,T),e.block_start=e.strstart,I(e.strm)}function ee(e,T){e.pending_buf[e.pending++]=T}function V(e,T){e.pending_buf[e.pending++]=T>>>8&255,e.pending_buf[e.pending++]=255&T}function Y(e,T){var A,f,l=e.max_chain_length,j=e.strstart,F=e.prev_length,W=e.nice_match,z=e.strstart>e.w_size-re?e.strstart-(e.w_size-re):0,G=e.window,Q=e.w_mask,K=e.prev,te=e.strstart+L,xe=G[j+F-1],ce=G[j+F];e.prev_length>=e.good_match&&(l>>=2),W>e.lookahead&&(W=e.lookahead);do if(G[(A=T)+F]===ce&&G[A+F-1]===xe&&G[A]===G[j]&&G[++A]===G[j+1]){j+=2,A++;do;while(G[++j]===G[++A]&&G[++j]===G[++A]&&G[++j]===G[++A]&&G[++j]===G[++A]&&G[++j]===G[++A]&&G[++j]===G[++A]&&G[++j]===G[++A]&&G[++j]===G[++A]&&j<te);if(f=L-(te-j),j=te-L,F<f){if(e.match_start=T,W<=(F=f))break;xe=G[j+F-1],ce=G[j+F]}}while((T=K[T&Q])>z&&--l!=0);return F<=e.lookahead?F:e.lookahead}function _e(e){var T,A,f,l,j,F,W,z,G,Q,K=e.w_size;do{if(l=e.window_size-e.lookahead-e.strstart,e.strstart>=K+(K-re)){for(c.arraySet(e.window,e.window,K,K,0),e.match_start-=K,e.strstart-=K,e.block_start-=K,T=A=e.hash_size;f=e.head[--T],e.head[T]=K<=f?f-K:0,--A;);for(T=A=K;f=e.prev[--T],e.prev[T]=K<=f?f-K:0,--A;);l+=K}if(e.strm.avail_in===0)break;if(F=e.strm,W=e.window,z=e.strstart+e.lookahead,G=l,Q=void 0,Q=F.avail_in,G<Q&&(Q=G),A=Q===0?0:(F.avail_in-=Q,c.arraySet(W,F.input,F.next_in,Q,z),F.state.wrap===1?F.adler=u(F.adler,W,Q,z):F.state.wrap===2&&(F.adler=y(F.adler,W,Q,z)),F.next_in+=Q,F.total_in+=Q,Q),e.lookahead+=A,e.lookahead+e.insert>=R)for(j=e.strstart-e.insert,e.ins_h=e.window[j],e.ins_h=(e.ins_h<<e.hash_shift^e.window[j+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[j+R-1])&e.hash_mask,e.prev[j&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=j,j++,e.insert--,!(e.lookahead+e.insert<R)););}while(e.lookahead<re&&e.strm.avail_in!==0)}function we(e,T){for(var A,f;;){if(e.lookahead<re){if(_e(e),e.lookahead<re&&T===p)return r;if(e.lookahead===0)break}if(A=0,e.lookahead>=R&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+R-1])&e.hash_mask,A=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),A!==0&&e.strstart-A<=e.w_size-re&&(e.match_length=Y(e,A)),e.match_length>=R)if(f=s._tr_tally(e,e.strstart-e.match_start,e.match_length-R),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=R){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+R-1])&e.hash_mask,A=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,--e.match_length!=0;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else f=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(f&&(E(e,!1),e.strm.avail_out===0))return r}return e.insert=e.strstart<R-1?e.strstart:R-1,T===g?(E(e,!0),e.strm.avail_out===0?ne:$):e.last_lit&&(E(e,!1),e.strm.avail_out===0)?r:D}function ue(e,T){for(var A,f,l;;){if(e.lookahead<re){if(_e(e),e.lookahead<re&&T===p)return r;if(e.lookahead===0)break}if(A=0,e.lookahead>=R&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+R-1])&e.hash_mask,A=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=R-1,A!==0&&e.prev_length<e.max_lazy_match&&e.strstart-A<=e.w_size-re&&(e.match_length=Y(e,A),e.match_length<=5&&(e.strategy===1||e.match_length===R&&4096<e.strstart-e.match_start)&&(e.match_length=R-1)),e.prev_length>=R&&e.match_length<=e.prev_length){for(l=e.strstart+e.lookahead-R,f=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-R),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=l&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+R-1])&e.hash_mask,A=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),--e.prev_length!=0;);if(e.match_available=0,e.match_length=R-1,e.strstart++,f&&(E(e,!1),e.strm.avail_out===0))return r}else if(e.match_available){if((f=s._tr_tally(e,0,e.window[e.strstart-1]))&&E(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return r}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(f=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<R-1?e.strstart:R-1,T===g?(E(e,!0),e.strm.avail_out===0?ne:$):e.last_lit&&(E(e,!1),e.strm.avail_out===0)?r:D}function me(e,T,A,f,l){this.good_length=e,this.max_lazy=T,this.nice_length=A,this.max_chain=f,this.func=l}function je(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(2*O),this.dyn_dtree=new c.Buf16(2*(2*C+1)),this.bl_tree=new c.Buf16(2*(2*U+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(P+1),this.heap=new c.Buf16(2*S+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(2*S+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function be(e){var T;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=o,(T=e.state).pending=0,T.pending_out=0,T.wrap<0&&(T.wrap=-T.wrap),T.status=T.wrap?b:B,e.adler=T.wrap===2?0:1,T.last_flush=p,s._tr_init(T),a):de(e,m)}function Oe(e){var T=be(e);return T===a&&function(A){A.window_size=2*A.w_size,se(A.head),A.max_lazy_match=d[A.level].max_lazy,A.good_match=d[A.level].good_length,A.nice_match=d[A.level].nice_length,A.max_chain_length=d[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=R-1,A.match_available=0,A.ins_h=0}(e.state),T}function Re(e,T,A,f,l,j){if(!e)return m;var F=1;if(T===i&&(T=6),f<0?(F=0,f=-f):15<f&&(F=2,f-=16),l<1||_<l||A!==x||f<8||15<f||T<0||9<T||j<0||h<j)return de(e,m);f===8&&(f=9);var W=new je;return(e.state=W).strm=e,W.wrap=F,W.gzhead=null,W.w_bits=f,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=l+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+R-1)/R),W.window=new c.Buf8(2*W.w_size),W.head=new c.Buf16(W.hash_size),W.prev=new c.Buf16(W.w_size),W.lit_bufsize=1<<l+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new c.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=T,W.strategy=j,W.method=A,Oe(e)}d=[new me(0,0,0,0,function(e,T){var A=65535;for(A>e.pending_buf_size-5&&(A=e.pending_buf_size-5);;){if(e.lookahead<=1){if(_e(e),e.lookahead===0&&T===p)return r;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var f=e.block_start+A;if((e.strstart===0||e.strstart>=f)&&(e.lookahead=e.strstart-f,e.strstart=f,E(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-re&&(E(e,!1),e.strm.avail_out===0))return r}return e.insert=0,T===g?(E(e,!0),e.strm.avail_out===0?ne:$):(e.strstart>e.block_start&&(E(e,!1),e.strm.avail_out),r)}),new me(4,4,8,4,we),new me(4,5,16,8,we),new me(4,6,32,32,we),new me(4,4,16,16,ue),new me(8,16,32,32,ue),new me(8,16,128,128,ue),new me(8,32,128,256,ue),new me(32,128,258,1024,ue),new me(32,258,258,4096,ue)],N.deflateInit=function(e,T){return Re(e,T,x,15,8,0)},N.deflateInit2=Re,N.deflateReset=Oe,N.deflateResetKeep=be,N.deflateSetHeader=function(e,T){return e&&e.state?e.state.wrap!==2?m:(e.state.gzhead=T,a):m},N.deflate=function(e,T){var A,f,l,j;if(!e||!e.state||5<T||T<0)return e?de(e,m):m;if(f=e.state,!e.output||!e.input&&e.avail_in!==0||f.status===666&&T!==g)return de(e,e.avail_out===0?-5:m);if(f.strm=e,A=f.last_flush,f.last_flush=T,f.status===b)if(f.wrap===2)e.adler=0,ee(f,31),ee(f,139),ee(f,8),f.gzhead?(ee(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),ee(f,255&f.gzhead.time),ee(f,f.gzhead.time>>8&255),ee(f,f.gzhead.time>>16&255),ee(f,f.gzhead.time>>24&255),ee(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),ee(f,255&f.gzhead.os),f.gzhead.extra&&f.gzhead.extra.length&&(ee(f,255&f.gzhead.extra.length),ee(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(e.adler=y(e.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(ee(f,0),ee(f,0),ee(f,0),ee(f,0),ee(f,0),ee(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),ee(f,3),f.status=B);else{var F=x+(f.w_bits-8<<4)<<8;F|=(2<=f.strategy||f.level<2?0:f.level<6?1:f.level===6?2:3)<<6,f.strstart!==0&&(F|=32),F+=31-F%31,f.status=B,V(f,F),f.strstart!==0&&(V(f,e.adler>>>16),V(f,65535&e.adler)),e.adler=1}if(f.status===69)if(f.gzhead.extra){for(l=f.pending;f.gzindex<(65535&f.gzhead.extra.length)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>l&&(e.adler=y(e.adler,f.pending_buf,f.pending-l,l)),I(e),l=f.pending,f.pending!==f.pending_buf_size));)ee(f,255&f.gzhead.extra[f.gzindex]),f.gzindex++;f.gzhead.hcrc&&f.pending>l&&(e.adler=y(e.adler,f.pending_buf,f.pending-l,l)),f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(f.status===73)if(f.gzhead.name){l=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>l&&(e.adler=y(e.adler,f.pending_buf,f.pending-l,l)),I(e),l=f.pending,f.pending===f.pending_buf_size)){j=1;break}j=f.gzindex<f.gzhead.name.length?255&f.gzhead.name.charCodeAt(f.gzindex++):0,ee(f,j)}while(j!==0);f.gzhead.hcrc&&f.pending>l&&(e.adler=y(e.adler,f.pending_buf,f.pending-l,l)),j===0&&(f.gzindex=0,f.status=91)}else f.status=91;if(f.status===91)if(f.gzhead.comment){l=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>l&&(e.adler=y(e.adler,f.pending_buf,f.pending-l,l)),I(e),l=f.pending,f.pending===f.pending_buf_size)){j=1;break}j=f.gzindex<f.gzhead.comment.length?255&f.gzhead.comment.charCodeAt(f.gzindex++):0,ee(f,j)}while(j!==0);f.gzhead.hcrc&&f.pending>l&&(e.adler=y(e.adler,f.pending_buf,f.pending-l,l)),j===0&&(f.status=103)}else f.status=103;if(f.status===103&&(f.gzhead.hcrc?(f.pending+2>f.pending_buf_size&&I(e),f.pending+2<=f.pending_buf_size&&(ee(f,255&e.adler),ee(f,e.adler>>8&255),e.adler=0,f.status=B)):f.status=B),f.pending!==0){if(I(e),e.avail_out===0)return f.last_flush=-1,a}else if(e.avail_in===0&&H(T)<=H(A)&&T!==g)return de(e,-5);if(f.status===666&&e.avail_in!==0)return de(e,-5);if(e.avail_in!==0||f.lookahead!==0||T!==p&&f.status!==666){var W=f.strategy===2?function(z,G){for(var Q;;){if(z.lookahead===0&&(_e(z),z.lookahead===0)){if(G===p)return r;break}if(z.match_length=0,Q=s._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,Q&&(E(z,!1),z.strm.avail_out===0))return r}return z.insert=0,G===g?(E(z,!0),z.strm.avail_out===0?ne:$):z.last_lit&&(E(z,!1),z.strm.avail_out===0)?r:D}(f,T):f.strategy===3?function(z,G){for(var Q,K,te,xe,ce=z.window;;){if(z.lookahead<=L){if(_e(z),z.lookahead<=L&&G===p)return r;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=R&&0<z.strstart&&(K=ce[te=z.strstart-1])===ce[++te]&&K===ce[++te]&&K===ce[++te]){xe=z.strstart+L;do;while(K===ce[++te]&&K===ce[++te]&&K===ce[++te]&&K===ce[++te]&&K===ce[++te]&&K===ce[++te]&&K===ce[++te]&&K===ce[++te]&&te<xe);z.match_length=L-(xe-te),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=R?(Q=s._tr_tally(z,1,z.match_length-R),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(Q=s._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),Q&&(E(z,!1),z.strm.avail_out===0))return r}return z.insert=0,G===g?(E(z,!0),z.strm.avail_out===0?ne:$):z.last_lit&&(E(z,!1),z.strm.avail_out===0)?r:D}(f,T):d[f.level].func(f,T);if(W!==ne&&W!==$||(f.status=666),W===r||W===ne)return e.avail_out===0&&(f.last_flush=-1),a;if(W===D&&(T===1?s._tr_align(f):T!==5&&(s._tr_stored_block(f,0,0,!1),T===3&&(se(f.head),f.lookahead===0&&(f.strstart=0,f.block_start=0,f.insert=0))),I(e),e.avail_out===0))return f.last_flush=-1,a}return T!==g?a:f.wrap<=0?1:(f.wrap===2?(ee(f,255&e.adler),ee(f,e.adler>>8&255),ee(f,e.adler>>16&255),ee(f,e.adler>>24&255),ee(f,255&e.total_in),ee(f,e.total_in>>8&255),ee(f,e.total_in>>16&255),ee(f,e.total_in>>24&255)):(V(f,e.adler>>>16),V(f,65535&e.adler)),I(e),0<f.wrap&&(f.wrap=-f.wrap),f.pending!==0?a:1)},N.deflateEnd=function(e){var T;return e&&e.state?(T=e.state.status)!==b&&T!==69&&T!==73&&T!==91&&T!==103&&T!==B&&T!==666?de(e,m):(e.state=null,T===B?de(e,-3):a):m},N.deflateSetDictionary=function(e,T){var A,f,l,j,F,W,z,G,Q=T.length;if(!e||!e.state||(j=(A=e.state).wrap)===2||j===1&&A.status!==b||A.lookahead)return m;for(j===1&&(e.adler=u(e.adler,T,Q,0)),A.wrap=0,Q>=A.w_size&&(j===0&&(se(A.head),A.strstart=0,A.block_start=0,A.insert=0),G=new c.Buf8(A.w_size),c.arraySet(G,T,Q-A.w_size,A.w_size,0),T=G,Q=A.w_size),F=e.avail_in,W=e.next_in,z=e.input,e.avail_in=Q,e.next_in=0,e.input=T,_e(A);A.lookahead>=R;){for(f=A.strstart,l=A.lookahead-(R-1);A.ins_h=(A.ins_h<<A.hash_shift^A.window[f+R-1])&A.hash_mask,A.prev[f&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=f,f++,--l;);A.strstart=f,A.lookahead=R-1,_e(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=R-1,A.match_available=0,e.next_in=W,e.input=z,e.avail_in=F,A.wrap=j,a},N.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(k,M,N){M.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(k,M,N){M.exports=function(d,c){var s,u,y,w,p,g,a,m,i,h,o,x,_,S,C,U,O,P,R,L,re,b,B,r,D;s=d.state,u=d.next_in,r=d.input,y=u+(d.avail_in-5),w=d.next_out,D=d.output,p=w-(c-d.avail_out),g=w+(d.avail_out-257),a=s.dmax,m=s.wsize,i=s.whave,h=s.wnext,o=s.window,x=s.hold,_=s.bits,S=s.lencode,C=s.distcode,U=(1<<s.lenbits)-1,O=(1<<s.distbits)-1;e:do{_<15&&(x+=r[u++]<<_,_+=8,x+=r[u++]<<_,_+=8),P=S[x&U];t:for(;;){if(x>>>=R=P>>>24,_-=R,(R=P>>>16&255)===0)D[w++]=65535&P;else{if(!(16&R)){if(!(64&R)){P=S[(65535&P)+(x&(1<<R)-1)];continue t}if(32&R){s.mode=12;break e}d.msg="invalid literal/length code",s.mode=30;break e}L=65535&P,(R&=15)&&(_<R&&(x+=r[u++]<<_,_+=8),L+=x&(1<<R)-1,x>>>=R,_-=R),_<15&&(x+=r[u++]<<_,_+=8,x+=r[u++]<<_,_+=8),P=C[x&O];r:for(;;){if(x>>>=R=P>>>24,_-=R,!(16&(R=P>>>16&255))){if(!(64&R)){P=C[(65535&P)+(x&(1<<R)-1)];continue r}d.msg="invalid distance code",s.mode=30;break e}if(re=65535&P,_<(R&=15)&&(x+=r[u++]<<_,(_+=8)<R&&(x+=r[u++]<<_,_+=8)),a<(re+=x&(1<<R)-1)){d.msg="invalid distance too far back",s.mode=30;break e}if(x>>>=R,_-=R,(R=w-p)<re){if(i<(R=re-R)&&s.sane){d.msg="invalid distance too far back",s.mode=30;break e}if(B=o,(b=0)===h){if(b+=m-R,R<L){for(L-=R;D[w++]=o[b++],--R;);b=w-re,B=D}}else if(h<R){if(b+=m+h-R,(R-=h)<L){for(L-=R;D[w++]=o[b++],--R;);if(b=0,h<L){for(L-=R=h;D[w++]=o[b++],--R;);b=w-re,B=D}}}else if(b+=h-R,R<L){for(L-=R;D[w++]=o[b++],--R;);b=w-re,B=D}for(;2<L;)D[w++]=B[b++],D[w++]=B[b++],D[w++]=B[b++],L-=3;L&&(D[w++]=B[b++],1<L&&(D[w++]=B[b++]))}else{for(b=w-re;D[w++]=D[b++],D[w++]=D[b++],D[w++]=D[b++],2<(L-=3););L&&(D[w++]=D[b++],1<L&&(D[w++]=D[b++]))}break}}break}}while(u<y&&w<g);u-=L=_>>3,x&=(1<<(_-=L<<3))-1,d.next_in=u,d.next_out=w,d.avail_in=u<y?y-u+5:5-(u-y),d.avail_out=w<g?g-w+257:257-(w-g),s.hold=x,s.bits=_}},{}],49:[function(k,M,N){var d=k("../utils/common"),c=k("./adler32"),s=k("./crc32"),u=k("./inffast"),y=k("./inftrees"),w=1,p=2,g=0,a=-2,m=1,i=852,h=592;function o(b){return(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(b){var B;return b&&b.state?(B=b.state,b.total_in=b.total_out=B.total=0,b.msg="",B.wrap&&(b.adler=1&B.wrap),B.mode=m,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new d.Buf32(i),B.distcode=B.distdyn=new d.Buf32(h),B.sane=1,B.back=-1,g):a}function S(b){var B;return b&&b.state?((B=b.state).wsize=0,B.whave=0,B.wnext=0,_(b)):a}function C(b,B){var r,D;return b&&b.state?(D=b.state,B<0?(r=0,B=-B):(r=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?a:(D.window!==null&&D.wbits!==B&&(D.window=null),D.wrap=r,D.wbits=B,S(b))):a}function U(b,B){var r,D;return b?(D=new x,(b.state=D).window=null,(r=C(b,B))!==g&&(b.state=null),r):a}var O,P,R=!0;function L(b){if(R){var B;for(O=new d.Buf32(512),P=new d.Buf32(32),B=0;B<144;)b.lens[B++]=8;for(;B<256;)b.lens[B++]=9;for(;B<280;)b.lens[B++]=7;for(;B<288;)b.lens[B++]=8;for(y(w,b.lens,0,288,O,0,b.work,{bits:9}),B=0;B<32;)b.lens[B++]=5;y(p,b.lens,0,32,P,0,b.work,{bits:5}),R=!1}b.lencode=O,b.lenbits=9,b.distcode=P,b.distbits=5}function re(b,B,r,D){var ne,$=b.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new d.Buf8($.wsize)),D>=$.wsize?(d.arraySet($.window,B,r-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(D<(ne=$.wsize-$.wnext)&&(ne=D),d.arraySet($.window,B,r-D,ne,$.wnext),(D-=ne)?(d.arraySet($.window,B,r-D,D,0),$.wnext=D,$.whave=$.wsize):($.wnext+=ne,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=ne))),0}N.inflateReset=S,N.inflateReset2=C,N.inflateResetKeep=_,N.inflateInit=function(b){return U(b,15)},N.inflateInit2=U,N.inflate=function(b,B){var r,D,ne,$,de,H,se,I,E,ee,V,Y,_e,we,ue,me,je,be,Oe,Re,e,T,A,f,l=0,j=new d.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!b||!b.state||!b.output||!b.input&&b.avail_in!==0)return a;(r=b.state).mode===12&&(r.mode=13),de=b.next_out,ne=b.output,se=b.avail_out,$=b.next_in,D=b.input,H=b.avail_in,I=r.hold,E=r.bits,ee=H,V=se,T=g;e:for(;;)switch(r.mode){case m:if(r.wrap===0){r.mode=13;break}for(;E<16;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(2&r.wrap&&I===35615){j[r.check=0]=255&I,j[1]=I>>>8&255,r.check=s(r.check,j,2,0),E=I=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&I)<<8)+(I>>8))%31){b.msg="incorrect header check",r.mode=30;break}if((15&I)!=8){b.msg="unknown compression method",r.mode=30;break}if(E-=4,e=8+(15&(I>>>=4)),r.wbits===0)r.wbits=e;else if(e>r.wbits){b.msg="invalid window size",r.mode=30;break}r.dmax=1<<e,b.adler=r.check=1,r.mode=512&I?10:12,E=I=0;break;case 2:for(;E<16;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(r.flags=I,(255&r.flags)!=8){b.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){b.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=I>>8&1),512&r.flags&&(j[0]=255&I,j[1]=I>>>8&255,r.check=s(r.check,j,2,0)),E=I=0,r.mode=3;case 3:for(;E<32;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}r.head&&(r.head.time=I),512&r.flags&&(j[0]=255&I,j[1]=I>>>8&255,j[2]=I>>>16&255,j[3]=I>>>24&255,r.check=s(r.check,j,4,0)),E=I=0,r.mode=4;case 4:for(;E<16;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}r.head&&(r.head.xflags=255&I,r.head.os=I>>8),512&r.flags&&(j[0]=255&I,j[1]=I>>>8&255,r.check=s(r.check,j,2,0)),E=I=0,r.mode=5;case 5:if(1024&r.flags){for(;E<16;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}r.length=I,r.head&&(r.head.extra_len=I),512&r.flags&&(j[0]=255&I,j[1]=I>>>8&255,r.check=s(r.check,j,2,0)),E=I=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(H<(Y=r.length)&&(Y=H),Y&&(r.head&&(e=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),d.arraySet(r.head.extra,D,$,Y,e)),512&r.flags&&(r.check=s(r.check,D,Y,$)),H-=Y,$+=Y,r.length-=Y),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(H===0)break e;for(Y=0;e=D[$+Y++],r.head&&e&&r.length<65536&&(r.head.name+=String.fromCharCode(e)),e&&Y<H;);if(512&r.flags&&(r.check=s(r.check,D,Y,$)),H-=Y,$+=Y,e)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(H===0)break e;for(Y=0;e=D[$+Y++],r.head&&e&&r.length<65536&&(r.head.comment+=String.fromCharCode(e)),e&&Y<H;);if(512&r.flags&&(r.check=s(r.check,D,Y,$)),H-=Y,$+=Y,e)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;E<16;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(I!==(65535&r.check)){b.msg="header crc mismatch",r.mode=30;break}E=I=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),b.adler=r.check=0,r.mode=12;break;case 10:for(;E<32;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}b.adler=r.check=o(I),E=I=0,r.mode=11;case 11:if(r.havedict===0)return b.next_out=de,b.avail_out=se,b.next_in=$,b.avail_in=H,r.hold=I,r.bits=E,2;b.adler=r.check=1,r.mode=12;case 12:if(B===5||B===6)break e;case 13:if(r.last){I>>>=7&E,E-=7&E,r.mode=27;break}for(;E<3;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}switch(r.last=1&I,E-=1,3&(I>>>=1)){case 0:r.mode=14;break;case 1:if(L(r),r.mode=20,B!==6)break;I>>>=2,E-=2;break e;case 2:r.mode=17;break;case 3:b.msg="invalid block type",r.mode=30}I>>>=2,E-=2;break;case 14:for(I>>>=7&E,E-=7&E;E<32;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if((65535&I)!=(I>>>16^65535)){b.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&I,E=I=0,r.mode=15,B===6)break e;case 15:r.mode=16;case 16:if(Y=r.length){if(H<Y&&(Y=H),se<Y&&(Y=se),Y===0)break e;d.arraySet(ne,D,$,Y,de),H-=Y,$+=Y,se-=Y,de+=Y,r.length-=Y;break}r.mode=12;break;case 17:for(;E<14;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(r.nlen=257+(31&I),I>>>=5,E-=5,r.ndist=1+(31&I),I>>>=5,E-=5,r.ncode=4+(15&I),I>>>=4,E-=4,286<r.nlen||30<r.ndist){b.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;E<3;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}r.lens[F[r.have++]]=7&I,I>>>=3,E-=3}for(;r.have<19;)r.lens[F[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,A={bits:r.lenbits},T=y(0,r.lens,0,19,r.lencode,0,r.work,A),r.lenbits=A.bits,T){b.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;me=(l=r.lencode[I&(1<<r.lenbits)-1])>>>16&255,je=65535&l,!((ue=l>>>24)<=E);){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(je<16)I>>>=ue,E-=ue,r.lens[r.have++]=je;else{if(je===16){for(f=ue+2;E<f;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(I>>>=ue,E-=ue,r.have===0){b.msg="invalid bit length repeat",r.mode=30;break}e=r.lens[r.have-1],Y=3+(3&I),I>>>=2,E-=2}else if(je===17){for(f=ue+3;E<f;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}E-=ue,e=0,Y=3+(7&(I>>>=ue)),I>>>=3,E-=3}else{for(f=ue+7;E<f;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}E-=ue,e=0,Y=11+(127&(I>>>=ue)),I>>>=7,E-=7}if(r.have+Y>r.nlen+r.ndist){b.msg="invalid bit length repeat",r.mode=30;break}for(;Y--;)r.lens[r.have++]=e}}if(r.mode===30)break;if(r.lens[256]===0){b.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,A={bits:r.lenbits},T=y(w,r.lens,0,r.nlen,r.lencode,0,r.work,A),r.lenbits=A.bits,T){b.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,A={bits:r.distbits},T=y(p,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,A),r.distbits=A.bits,T){b.msg="invalid distances set",r.mode=30;break}if(r.mode=20,B===6)break e;case 20:r.mode=21;case 21:if(6<=H&&258<=se){b.next_out=de,b.avail_out=se,b.next_in=$,b.avail_in=H,r.hold=I,r.bits=E,u(b,V),de=b.next_out,ne=b.output,se=b.avail_out,$=b.next_in,D=b.input,H=b.avail_in,I=r.hold,E=r.bits,r.mode===12&&(r.back=-1);break}for(r.back=0;me=(l=r.lencode[I&(1<<r.lenbits)-1])>>>16&255,je=65535&l,!((ue=l>>>24)<=E);){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(me&&!(240&me)){for(be=ue,Oe=me,Re=je;me=(l=r.lencode[Re+((I&(1<<be+Oe)-1)>>be)])>>>16&255,je=65535&l,!(be+(ue=l>>>24)<=E);){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}I>>>=be,E-=be,r.back+=be}if(I>>>=ue,E-=ue,r.back+=ue,r.length=je,me===0){r.mode=26;break}if(32&me){r.back=-1,r.mode=12;break}if(64&me){b.msg="invalid literal/length code",r.mode=30;break}r.extra=15&me,r.mode=22;case 22:if(r.extra){for(f=r.extra;E<f;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}r.length+=I&(1<<r.extra)-1,I>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;me=(l=r.distcode[I&(1<<r.distbits)-1])>>>16&255,je=65535&l,!((ue=l>>>24)<=E);){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(!(240&me)){for(be=ue,Oe=me,Re=je;me=(l=r.distcode[Re+((I&(1<<be+Oe)-1)>>be)])>>>16&255,je=65535&l,!(be+(ue=l>>>24)<=E);){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}I>>>=be,E-=be,r.back+=be}if(I>>>=ue,E-=ue,r.back+=ue,64&me){b.msg="invalid distance code",r.mode=30;break}r.offset=je,r.extra=15&me,r.mode=24;case 24:if(r.extra){for(f=r.extra;E<f;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}r.offset+=I&(1<<r.extra)-1,I>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){b.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(se===0)break e;if(Y=V-se,r.offset>Y){if((Y=r.offset-Y)>r.whave&&r.sane){b.msg="invalid distance too far back",r.mode=30;break}_e=Y>r.wnext?(Y-=r.wnext,r.wsize-Y):r.wnext-Y,Y>r.length&&(Y=r.length),we=r.window}else we=ne,_e=de-r.offset,Y=r.length;for(se<Y&&(Y=se),se-=Y,r.length-=Y;ne[de++]=we[_e++],--Y;);r.length===0&&(r.mode=21);break;case 26:if(se===0)break e;ne[de++]=r.length,se--,r.mode=21;break;case 27:if(r.wrap){for(;E<32;){if(H===0)break e;H--,I|=D[$++]<<E,E+=8}if(V-=se,b.total_out+=V,r.total+=V,V&&(b.adler=r.check=r.flags?s(r.check,ne,V,de-V):c(r.check,ne,V,de-V)),V=se,(r.flags?I:o(I))!==r.check){b.msg="incorrect data check",r.mode=30;break}E=I=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;E<32;){if(H===0)break e;H--,I+=D[$++]<<E,E+=8}if(I!==(4294967295&r.total)){b.msg="incorrect length check",r.mode=30;break}E=I=0}r.mode=29;case 29:T=1;break e;case 30:T=-3;break e;case 31:return-4;case 32:default:return a}return b.next_out=de,b.avail_out=se,b.next_in=$,b.avail_in=H,r.hold=I,r.bits=E,(r.wsize||V!==b.avail_out&&r.mode<30&&(r.mode<27||B!==4))&&re(b,b.output,b.next_out,V-b.avail_out)?(r.mode=31,-4):(ee-=b.avail_in,V-=b.avail_out,b.total_in+=ee,b.total_out+=V,r.total+=V,r.wrap&&V&&(b.adler=r.check=r.flags?s(r.check,ne,V,b.next_out-V):c(r.check,ne,V,b.next_out-V)),b.data_type=r.bits+(r.last?64:0)+(r.mode===12?128:0)+(r.mode===20||r.mode===15?256:0),(ee==0&&V===0||B===4)&&T===g&&(T=-5),T)},N.inflateEnd=function(b){if(!b||!b.state)return a;var B=b.state;return B.window&&(B.window=null),b.state=null,g},N.inflateGetHeader=function(b,B){var r;return b&&b.state&&2&(r=b.state).wrap?((r.head=B).done=!1,g):a},N.inflateSetDictionary=function(b,B){var r,D=B.length;return b&&b.state?(r=b.state).wrap!==0&&r.mode!==11?a:r.mode===11&&c(1,B,D,0)!==r.check?-3:re(b,B,D,D)?(r.mode=31,-4):(r.havedict=1,g):a},N.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(k,M,N){var d=k("../utils/common"),c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];M.exports=function(w,p,g,a,m,i,h,o){var x,_,S,C,U,O,P,R,L,re=o.bits,b=0,B=0,r=0,D=0,ne=0,$=0,de=0,H=0,se=0,I=0,E=null,ee=0,V=new d.Buf16(16),Y=new d.Buf16(16),_e=null,we=0;for(b=0;b<=15;b++)V[b]=0;for(B=0;B<a;B++)V[p[g+B]]++;for(ne=re,D=15;1<=D&&V[D]===0;D--);if(D<ne&&(ne=D),D===0)return m[i++]=20971520,m[i++]=20971520,o.bits=1,0;for(r=1;r<D&&V[r]===0;r++);for(ne<r&&(ne=r),b=H=1;b<=15;b++)if(H<<=1,(H-=V[b])<0)return-1;if(0<H&&(w===0||D!==1))return-1;for(Y[1]=0,b=1;b<15;b++)Y[b+1]=Y[b]+V[b];for(B=0;B<a;B++)p[g+B]!==0&&(h[Y[p[g+B]]++]=B);if(O=w===0?(E=_e=h,19):w===1?(E=c,ee-=257,_e=s,we-=257,256):(E=u,_e=y,-1),b=r,U=i,de=B=I=0,S=-1,C=(se=1<<($=ne))-1,w===1&&852<se||w===2&&592<se)return 1;for(;;){for(P=b-de,L=h[B]<O?(R=0,h[B]):h[B]>O?(R=_e[we+h[B]],E[ee+h[B]]):(R=96,0),x=1<<b-de,r=_=1<<$;m[U+(I>>de)+(_-=x)]=P<<24|R<<16|L|0,_!==0;);for(x=1<<b-1;I&x;)x>>=1;if(x!==0?(I&=x-1,I+=x):I=0,B++,--V[b]==0){if(b===D)break;b=p[g+h[B]]}if(ne<b&&(I&C)!==S){for(de===0&&(de=ne),U+=r,H=1<<($=b-de);$+de<D&&!((H-=V[$+de])<=0);)$++,H<<=1;if(se+=1<<$,w===1&&852<se||w===2&&592<se)return 1;m[S=I&C]=ne<<24|$<<16|U-i|0}}return I!==0&&(m[U+I]=b-de<<24|64<<16|0),o.bits=ne,0}},{"../utils/common":41}],51:[function(k,M,N){M.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(k,M,N){var d=k("../utils/common"),c=0,s=1;function u(l){for(var j=l.length;0<=--j;)l[j]=0}var y=0,w=29,p=256,g=p+1+w,a=30,m=19,i=2*g+1,h=15,o=16,x=7,_=256,S=16,C=17,U=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],re=new Array(2*(g+2));u(re);var b=new Array(2*a);u(b);var B=new Array(512);u(B);var r=new Array(256);u(r);var D=new Array(w);u(D);var ne,$,de,H=new Array(a);function se(l,j,F,W,z){this.static_tree=l,this.extra_bits=j,this.extra_base=F,this.elems=W,this.max_length=z,this.has_stree=l&&l.length}function I(l,j){this.dyn_tree=l,this.max_code=0,this.stat_desc=j}function E(l){return l<256?B[l]:B[256+(l>>>7)]}function ee(l,j){l.pending_buf[l.pending++]=255&j,l.pending_buf[l.pending++]=j>>>8&255}function V(l,j,F){l.bi_valid>o-F?(l.bi_buf|=j<<l.bi_valid&65535,ee(l,l.bi_buf),l.bi_buf=j>>o-l.bi_valid,l.bi_valid+=F-o):(l.bi_buf|=j<<l.bi_valid&65535,l.bi_valid+=F)}function Y(l,j,F){V(l,F[2*j],F[2*j+1])}function _e(l,j){for(var F=0;F|=1&l,l>>>=1,F<<=1,0<--j;);return F>>>1}function we(l,j,F){var W,z,G=new Array(h+1),Q=0;for(W=1;W<=h;W++)G[W]=Q=Q+F[W-1]<<1;for(z=0;z<=j;z++){var K=l[2*z+1];K!==0&&(l[2*z]=_e(G[K]++,K))}}function ue(l){var j;for(j=0;j<g;j++)l.dyn_ltree[2*j]=0;for(j=0;j<a;j++)l.dyn_dtree[2*j]=0;for(j=0;j<m;j++)l.bl_tree[2*j]=0;l.dyn_ltree[2*_]=1,l.opt_len=l.static_len=0,l.last_lit=l.matches=0}function me(l){8<l.bi_valid?ee(l,l.bi_buf):0<l.bi_valid&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0}function je(l,j,F,W){var z=2*j,G=2*F;return l[z]<l[G]||l[z]===l[G]&&W[j]<=W[F]}function be(l,j,F){for(var W=l.heap[F],z=F<<1;z<=l.heap_len&&(z<l.heap_len&&je(j,l.heap[z+1],l.heap[z],l.depth)&&z++,!je(j,W,l.heap[z],l.depth));)l.heap[F]=l.heap[z],F=z,z<<=1;l.heap[F]=W}function Oe(l,j,F){var W,z,G,Q,K=0;if(l.last_lit!==0)for(;W=l.pending_buf[l.d_buf+2*K]<<8|l.pending_buf[l.d_buf+2*K+1],z=l.pending_buf[l.l_buf+K],K++,W===0?Y(l,z,j):(Y(l,(G=r[z])+p+1,j),(Q=O[G])!==0&&V(l,z-=D[G],Q),Y(l,G=E(--W),F),(Q=P[G])!==0&&V(l,W-=H[G],Q)),K<l.last_lit;);Y(l,_,j)}function Re(l,j){var F,W,z,G=j.dyn_tree,Q=j.stat_desc.static_tree,K=j.stat_desc.has_stree,te=j.stat_desc.elems,xe=-1;for(l.heap_len=0,l.heap_max=i,F=0;F<te;F++)G[2*F]!==0?(l.heap[++l.heap_len]=xe=F,l.depth[F]=0):G[2*F+1]=0;for(;l.heap_len<2;)G[2*(z=l.heap[++l.heap_len]=xe<2?++xe:0)]=1,l.depth[z]=0,l.opt_len--,K&&(l.static_len-=Q[2*z+1]);for(j.max_code=xe,F=l.heap_len>>1;1<=F;F--)be(l,G,F);for(z=te;F=l.heap[1],l.heap[1]=l.heap[l.heap_len--],be(l,G,1),W=l.heap[1],l.heap[--l.heap_max]=F,l.heap[--l.heap_max]=W,G[2*z]=G[2*F]+G[2*W],l.depth[z]=(l.depth[F]>=l.depth[W]?l.depth[F]:l.depth[W])+1,G[2*F+1]=G[2*W+1]=z,l.heap[1]=z++,be(l,G,1),2<=l.heap_len;);l.heap[--l.heap_max]=l.heap[1],function(ce,Ce){var Ue,Be,Te,ye,He,Pe,Ne=Ce.dyn_tree,Me=Ce.max_code,Ye=Ce.stat_desc.static_tree,Ge=Ce.stat_desc.has_stree,X=Ce.stat_desc.extra_bits,Se=Ce.stat_desc.extra_base,Ee=Ce.stat_desc.max_length,De=0;for(ye=0;ye<=h;ye++)ce.bl_count[ye]=0;for(Ne[2*ce.heap[ce.heap_max]+1]=0,Ue=ce.heap_max+1;Ue<i;Ue++)Ee<(ye=Ne[2*Ne[2*(Be=ce.heap[Ue])+1]+1]+1)&&(ye=Ee,De++),Ne[2*Be+1]=ye,Me<Be||(ce.bl_count[ye]++,He=0,Se<=Be&&(He=X[Be-Se]),Pe=Ne[2*Be],ce.opt_len+=Pe*(ye+He),Ge&&(ce.static_len+=Pe*(Ye[2*Be+1]+He)));if(De!==0){do{for(ye=Ee-1;ce.bl_count[ye]===0;)ye--;ce.bl_count[ye]--,ce.bl_count[ye+1]+=2,ce.bl_count[Ee]--,De-=2}while(0<De);for(ye=Ee;ye!==0;ye--)for(Be=ce.bl_count[ye];Be!==0;)Me<(Te=ce.heap[--Ue])||(Ne[2*Te+1]!==ye&&(ce.opt_len+=(ye-Ne[2*Te+1])*Ne[2*Te],Ne[2*Te+1]=ye),Be--)}}(l,j),we(G,xe,l.bl_count)}function e(l,j,F){var W,z,G=-1,Q=j[1],K=0,te=7,xe=4;for(Q===0&&(te=138,xe=3),j[2*(F+1)+1]=65535,W=0;W<=F;W++)z=Q,Q=j[2*(W+1)+1],++K<te&&z===Q||(K<xe?l.bl_tree[2*z]+=K:z!==0?(z!==G&&l.bl_tree[2*z]++,l.bl_tree[2*S]++):K<=10?l.bl_tree[2*C]++:l.bl_tree[2*U]++,G=z,xe=(K=0)===Q?(te=138,3):z===Q?(te=6,3):(te=7,4))}function T(l,j,F){var W,z,G=-1,Q=j[1],K=0,te=7,xe=4;for(Q===0&&(te=138,xe=3),W=0;W<=F;W++)if(z=Q,Q=j[2*(W+1)+1],!(++K<te&&z===Q)){if(K<xe)for(;Y(l,z,l.bl_tree),--K!=0;);else z!==0?(z!==G&&(Y(l,z,l.bl_tree),K--),Y(l,S,l.bl_tree),V(l,K-3,2)):K<=10?(Y(l,C,l.bl_tree),V(l,K-3,3)):(Y(l,U,l.bl_tree),V(l,K-11,7));G=z,xe=(K=0)===Q?(te=138,3):z===Q?(te=6,3):(te=7,4)}}u(H);var A=!1;function f(l,j,F,W){V(l,(y<<1)+(W?1:0),3),function(z,G,Q,K){me(z),ee(z,Q),ee(z,~Q),d.arraySet(z.pending_buf,z.window,G,Q,z.pending),z.pending+=Q}(l,j,F)}N._tr_init=function(l){A||(function(){var j,F,W,z,G,Q=new Array(h+1);for(z=W=0;z<w-1;z++)for(D[z]=W,j=0;j<1<<O[z];j++)r[W++]=z;for(r[W-1]=z,z=G=0;z<16;z++)for(H[z]=G,j=0;j<1<<P[z];j++)B[G++]=z;for(G>>=7;z<a;z++)for(H[z]=G<<7,j=0;j<1<<P[z]-7;j++)B[256+G++]=z;for(F=0;F<=h;F++)Q[F]=0;for(j=0;j<=143;)re[2*j+1]=8,j++,Q[8]++;for(;j<=255;)re[2*j+1]=9,j++,Q[9]++;for(;j<=279;)re[2*j+1]=7,j++,Q[7]++;for(;j<=287;)re[2*j+1]=8,j++,Q[8]++;for(we(re,g+1,Q),j=0;j<a;j++)b[2*j+1]=5,b[2*j]=_e(j,5);ne=new se(re,O,p+1,g,h),$=new se(b,P,0,a,h),de=new se(new Array(0),R,0,m,x)}(),A=!0),l.l_desc=new I(l.dyn_ltree,ne),l.d_desc=new I(l.dyn_dtree,$),l.bl_desc=new I(l.bl_tree,de),l.bi_buf=0,l.bi_valid=0,ue(l)},N._tr_stored_block=f,N._tr_flush_block=function(l,j,F,W){var z,G,Q=0;0<l.level?(l.strm.data_type===2&&(l.strm.data_type=function(K){var te,xe=4093624447;for(te=0;te<=31;te++,xe>>>=1)if(1&xe&&K.dyn_ltree[2*te]!==0)return c;if(K.dyn_ltree[18]!==0||K.dyn_ltree[20]!==0||K.dyn_ltree[26]!==0)return s;for(te=32;te<p;te++)if(K.dyn_ltree[2*te]!==0)return s;return c}(l)),Re(l,l.l_desc),Re(l,l.d_desc),Q=function(K){var te;for(e(K,K.dyn_ltree,K.l_desc.max_code),e(K,K.dyn_dtree,K.d_desc.max_code),Re(K,K.bl_desc),te=m-1;3<=te&&K.bl_tree[2*L[te]+1]===0;te--);return K.opt_len+=3*(te+1)+5+5+4,te}(l),z=l.opt_len+3+7>>>3,(G=l.static_len+3+7>>>3)<=z&&(z=G)):z=G=F+5,F+4<=z&&j!==-1?f(l,j,F,W):l.strategy===4||G===z?(V(l,2+(W?1:0),3),Oe(l,re,b)):(V(l,4+(W?1:0),3),function(K,te,xe,ce){var Ce;for(V(K,te-257,5),V(K,xe-1,5),V(K,ce-4,4),Ce=0;Ce<ce;Ce++)V(K,K.bl_tree[2*L[Ce]+1],3);T(K,K.dyn_ltree,te-1),T(K,K.dyn_dtree,xe-1)}(l,l.l_desc.max_code+1,l.d_desc.max_code+1,Q+1),Oe(l,l.dyn_ltree,l.dyn_dtree)),ue(l),W&&me(l)},N._tr_tally=function(l,j,F){return l.pending_buf[l.d_buf+2*l.last_lit]=j>>>8&255,l.pending_buf[l.d_buf+2*l.last_lit+1]=255&j,l.pending_buf[l.l_buf+l.last_lit]=255&F,l.last_lit++,j===0?l.dyn_ltree[2*F]++:(l.matches++,j--,l.dyn_ltree[2*(r[F]+p+1)]++,l.dyn_dtree[2*E(j)]++),l.last_lit===l.lit_bufsize-1},N._tr_align=function(l){V(l,2,3),Y(l,_,re),function(j){j.bi_valid===16?(ee(j,j.bi_buf),j.bi_buf=0,j.bi_valid=0):8<=j.bi_valid&&(j.pending_buf[j.pending++]=255&j.bi_buf,j.bi_buf>>=8,j.bi_valid-=8)}(l)}},{"../utils/common":41}],53:[function(k,M,N){M.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(k,M,N){(function(d){(function(c,s){if(!c.setImmediate){var u,y,w,p,g=1,a={},m=!1,i=c.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(c);h=h&&h.setTimeout?h:c,u={}.toString.call(c.process)==="[object process]"?function(S){process.nextTick(function(){x(S)})}:function(){if(c.postMessage&&!c.importScripts){var S=!0,C=c.onmessage;return c.onmessage=function(){S=!1},c.postMessage("","*"),c.onmessage=C,S}}()?(p="setImmediate$"+Math.random()+"$",c.addEventListener?c.addEventListener("message",_,!1):c.attachEvent("onmessage",_),function(S){c.postMessage(p+S,"*")}):c.MessageChannel?((w=new MessageChannel).port1.onmessage=function(S){x(S.data)},function(S){w.port2.postMessage(S)}):i&&"onreadystatechange"in i.createElement("script")?(y=i.documentElement,function(S){var C=i.createElement("script");C.onreadystatechange=function(){x(S),C.onreadystatechange=null,y.removeChild(C),C=null},y.appendChild(C)}):function(S){setTimeout(x,0,S)},h.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var C=new Array(arguments.length-1),U=0;U<C.length;U++)C[U]=arguments[U+1];var O={callback:S,args:C};return a[g]=O,u(g),g++},h.clearImmediate=o}function o(S){delete a[S]}function x(S){if(m)setTimeout(x,0,S);else{var C=a[S];if(C){m=!0;try{(function(U){var O=U.callback,P=U.args;switch(P.length){case 0:O();break;case 1:O(P[0]);break;case 2:O(P[0],P[1]);break;case 3:O(P[0],P[1],P[2]);break;default:O.apply(s,P)}})(C)}finally{o(S),m=!1}}}}function _(S){S.source===c&&typeof S.data=="string"&&S.data.indexOf(p)===0&&x(+S.data.slice(p.length))}})(typeof self>"u"?d===void 0?this:d:self)}).call(this,typeof Qe<"u"?Qe:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(wt);var Xt=wt.exports;const _t=Gt(Xt);function rr(){var ot,lt,dt,ct,ht,ut,ft,pt,mt,xt,gt,bt,yt,vt;const{projectId:ze,episodeId:Ae}=Jt(),k=Kt(),M=Yt(),N=ie.useMemo(()=>{const n=new URLSearchParams(M.search),v=Number(n.get("shot"));return Number.isFinite(v)&&v>0?v:null},[M.search]),[d,c]=ie.useState(null),[s,u]=ie.useState(null),[y,w]=ie.useState(!0),[p,g]=ie.useState([]),[a,m]=ie.useState(1),[i,h]=ie.useState(!1),[o,x]=ie.useState(0),_=140,S=ie.useRef(null),C=ie.useRef(""),[U,O]=ie.useState(!1),[P,R]=ie.useState([]),[L,re]=ie.useState([]),[b,B]=ie.useState([]),[r,D]=ie.useState([]),[ne,$]=ie.useState([]),[de,H]=ie.useState([]),[se,I]=ie.useState([]),[E,ee]=ie.useState(null),[V,Y]=ie.useState(!1),[_e,we]=ie.useState(!1),[ue,me]=ie.useState([]),[je,be]=ie.useState(!1),[Oe,Re]=ie.useState([]),[e,T]=ie.useState([]),[A,f]=ie.useState(""),[l,j]=ie.useState(""),[F,W]=ie.useState(null),[z,G]=ie.useState(""),[Q,K]=ie.useState(""),[te,xe]=ie.useState(""),[ce,Ce]=ie.useState(""),[Ue,Be]=ie.useState(!1),[Te,ye]=ie.useState(null),[He,Pe]=ie.useState(null),[Ne,Me]=ie.useState(0),[Ye,Ge]=ie.useState({}),X=ie.useMemo(()=>p.find(n=>n.shotIndex===a)||null,[p,a]);ie.useEffect(()=>{const n=p.find(v=>v.shotIndex===a);if(n!=null&&n.mediaList&&n.mediaList.length>0){const v=n.mediaList.findIndex(Z=>Z==null?void 0:Z.isPrimary);Me(v>=0?v:0)}else Me(0)},[a,p]),ie.useEffect(()=>{p.forEach(n=>{var Z,q;const v=((Z=n.mediaList)==null?void 0:Z.find(J=>J==null?void 0:J.isPrimary))||((q=n.mediaList)==null?void 0:q[0])||n.media;if(v!=null&&v.url){if(v.duration&&v.duration>0){Ge(J=>({...J,[n.shotIndex]:v.duration}));return}if(v.type==="image"){Ge(J=>({...J,[n.shotIndex]:5}));return}if(v.type==="video"||!v.type){const J=document.createElement("video");J.src=v.url,J.preload="metadata",J.onloadedmetadata=()=>{J.duration&&isFinite(J.duration)&&Ge(ae=>({...ae,[n.shotIndex]:J.duration}))}}else if(v.type==="audio"){const J=document.createElement("audio");J.src=v.url,J.preload="metadata",J.onloadedmetadata=()=>{J.duration&&isFinite(J.duration)&&Ge(ae=>({...ae,[n.shotIndex]:J.duration}))}}}})},[p]);const Se=(d==null?void 0:d.canEdit)??!0;ie.useEffect(()=>{(async()=>{var v;try{const Z=await Le.episodes.getById(ze,Ae),q=(Z==null?void 0:Z.data)??Z;c(q);const J=(v=q==null?void 0:q.scriptJson)==null?void 0:v.acts;if(Array.isArray(J)&&J.length>0){const ae=[];let pe=1;if(J.forEach(oe=>{Array.isArray(oe.shots)&&oe.shots.forEach(le=>{ae.push({...le,shotIndex:pe++})})}),g(ae),C.current=JSON.stringify(ae),ae.length>0){const oe=N&&N<=ae.length?N:1;m(oe)}}}finally{w(!1)}})()},[ze,Ae]),ie.useEffect(()=>{ze&&(async()=>{try{const v=await Le.projects.getById(ze);u(v.data)}catch{}})()},[ze]),ie.useEffect(()=>{(async()=>{try{const v=await Le.assetLibraries.getAll();R(v.data||[])}catch{}})()},[]),ie.useEffect(()=>{if(Ae){const n=localStorage.getItem(`episode_${Ae}_libraries`);if(n)try{re(JSON.parse(n))}catch{}}},[Ae]),ie.useEffect(()=>{const n=async()=>{if(L.length===0){B([]),D([]),$([]),H([]);return}const v=P.filter(he=>he.category==="ROLE"&&L.includes(he.id)),Z=P.filter(he=>he.category==="SCENE"&&L.includes(he.id)),q=P.filter(he=>he.category==="PROP"&&L.includes(he.id)),J=P.filter(he=>he.category==="AUDIO"&&L.includes(he.id)),ae=P.filter(he=>he.category==="OTHER"&&L.includes(he.id)),pe=[];for(const he of v)try{const ke=await Le.assetLibraries.roles.list(he.id);ke.data&&pe.push(...ke.data)}catch{}B(pe);const oe=[];for(const he of Z)try{const ke=await Le.assetLibraries.getAssets(he.id);ke.data&&oe.push(...ke.data)}catch{}D(oe);const le=[];for(const he of q)try{const ke=await Le.assetLibraries.getAssets(he.id);ke.data&&le.push(...ke.data)}catch{}$(le);const ve=[];for(const he of J)try{const ke=await Le.assetLibraries.getAssets(he.id);ke.data&&ve.push(...ke.data)}catch{}H(ve);const ge=[];for(const he of ae)try{const ke=await Le.assetLibraries.getAssets(he.id);ke.data&&ge.push(...ke.data)}catch{}I(ge)};P.length>0&&n()},[L,P]);const Ee=(n,v)=>{if(!X){fe.error("");return}g(Z=>Z.map(q=>{if(q.shotIndex!==a)return q;const J=n==="role"?"selectedRoles":n==="scene"?"selectedScenes":n==="prop"?"selectedProps":"selectedAudios",ae=q[J]||[],pe=ae.some(oe=>oe.id===v.id);return{...q,[J]:pe?ae.filter(oe=>oe.id!==v.id):[...ae,{id:v.id,name:v.name,thumbnail:v.thumbnail,url:v.url,metadata:v.metadata}]}}))},De=(n,v)=>X?(X[n==="role"?"selectedRoles":n==="scene"?"selectedScenes":n==="prop"?"selectedProps":"selectedAudios"]||[]).some(q=>q.id===v):!1,jt=n=>{re(n),Ae&&localStorage.setItem(`episode_${Ae}_libraries`,JSON.stringify(n)),O(!1),fe.success("")},Je=n=>{re(v=>v.includes(n)?v.filter(Z=>Z!==n):[...v,n])},Nt=n=>{if(!X)return;const v=p.map(Z=>{if(Z.shotIndex===a){const q=[...Z.mediaList||[]];return q.forEach(J=>{J&&(J.isPrimary=!1)}),q[n]&&(q[n].isPrimary=!0),{...Z,mediaList:q}}return Z});g(v)},St=()=>{if(!X)return;const n=p.map(v=>{if(v.shotIndex===a){const Z=[...v.mediaList||[]];return Z.forEach(q=>{q&&(q.isPrimary=!1)}),{...v,mediaList:Z}}return v});g(n)},Fe=ie.useCallback(async n=>{try{h(!0);const v=[{actIndex:1,shots:n}];await Le.episodes.update(ze,Ae,{scriptJson:{acts:v}}),C.current=JSON.stringify(n)}catch(v){fe.error((v==null?void 0:v.message)||"")}finally{h(!1)}},[ze,Ae]),st=ie.useCallback(n=>{S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{JSON.stringify(n)!==C.current&&Fe(n)},1e3)},[Fe]);ie.useEffect(()=>(p.length>0&&!y&&st(p),()=>{S.current&&clearTimeout(S.current)}),[p,y,st]),ie.useEffect(()=>{const n=()=>{var Z;if(S.current&&clearTimeout(S.current),JSON.stringify(p)!==C.current&&p.length>0){const q=[{actIndex:1,shots:p}];(Z=navigator.sendBeacon)==null||Z.call(navigator,`https://api.waule.com/api/projects/${ze}/episodes/${Ae}`,JSON.stringify({scriptJson:{acts:q}}))}};return window.addEventListener("beforeunload",n),()=>window.removeEventListener("beforeunload",n)},[p,ze,Ae]);const tt=(n,v,Z)=>{g(q=>q.map(J=>J.shotIndex===n?{...J,[v]:Z}:J))},Ct=async()=>{const n=p.length>0?Math.max(...p.map(q=>q.shotIndex))+1:1,v={shotIndex:n,:"","/":"","/":"","/":"",:"",:""},Z=[...p,v];g(Z),m(n),await Fe(Z)},zt=async n=>{if(!window.confirm(""))return;const v=p.filter(Z=>Z.shotIndex!==n).map((Z,q)=>({...Z,shotIndex:q+1}));g(v),a===n?m(v.length>0?v[0].shotIndex:0):a>n&&m(a-1),await Fe(v)},Et=(n,v)=>{Se&&(ye(v),n.dataTransfer.effectAllowed="move")},It=(n,v)=>{n.preventDefault(),!(Te===null||Te===v)&&Pe(v)},At=()=>{Pe(null)},Ot=async(n,v)=>{if(n.preventDefault(),Te===null||Te===v){ye(null),Pe(null);return}const Z=[...p],q=Z.findIndex(oe=>oe.shotIndex===Te),J=Z.findIndex(oe=>oe.shotIndex===v);if(q===-1||J===-1)return;const[ae]=Z.splice(q,1);Z.splice(J,0,ae);const pe=Z.map((oe,le)=>({...oe,shotIndex:le+1}));g(pe),a===Te&&m(v),ye(null),Pe(null),await Fe(pe)},Rt=()=>{ye(null),Pe(null)},Bt=async(n,v,Z,q)=>{try{const J=(s==null?void 0:s.name)||"",ae=(d==null?void 0:d.episodeNumber)||1,pe=q==="image"?"png":q==="audio"?"mp3":"mp4",oe=`${J}_S${ae}_Shot${v}_${String(Z+1).padStart(2,"0")}.${pe}`,ve=(await at.get("/assets/proxy-download-with-name",{params:{url:n,filename:oe},responseType:"blob"})).data,ge=document.createElement("a");ge.href=URL.createObjectURL(ve),ge.download=oe,ge.click(),URL.revokeObjectURL(ge.href)}catch(J){fe.error(": "+(J.message||""))}},Tt=async()=>{const n=(s==null?void 0:s.name)||"",v=(d==null?void 0:d.episodeNumber)||1,Z=`${n}_S${v}`,q=`${n}_S${v}_.zip`,J=[];for(const pe of p)pe.mediaList&&Array.isArray(pe.mediaList)&&pe.mediaList.forEach((oe,le)=>{oe!=null&&oe.url&&J.push({url:oe.url,shotIndex:pe.shotIndex,mediaIndex:le,type:oe.type||"video"})});if(J.length===0){fe.info("");return}const ae=fe.loading(` ${J.length} ...`);try{const pe=new _t,oe=pe.folder(Z);let le=0;for(const he of J)try{const ke=await at.get("/assets/proxy-download",{params:{url:he.url},responseType:"blob"}),We=he.type==="image"?"png":he.type==="audio"?"mp3":"mp4",Ze=`${n}_S${v}_Shot${he.shotIndex}_${String(he.mediaIndex+1).padStart(2,"0")}.${We}`,Xe=`shot${String(he.shotIndex).padStart(2,"0")}`,Ke=oe==null?void 0:oe.folder(Xe);Ke==null||Ke.file(Ze,ke.data),le++,fe.loading(` ${le}/${J.length}...`,{id:ae})}catch{}fe.loading("...",{id:ae});const ve=await pe.generateAsync({type:"blob"}),ge=document.createElement("a");ge.href=URL.createObjectURL(ve),ge.download=q,ge.click(),URL.revokeObjectURL(ge.href),fe.success(` ${le} `,{id:ae})}catch(pe){fe.error(": "+(pe.message||""),{id:ae})}},Lt=()=>{var v;const n=[];for(const Z of p)((v=Z.mediaList)==null?void 0:v.some(J=>(J==null?void 0:J.isPrimary)&&(J==null?void 0:J.url)))||n.push(Z.shotIndex);n.length>0?(me(n),we(!0)):it()},it=async()=>{var pe;const n=(s==null?void 0:s.name)||"",v=(d==null?void 0:d.episodeNumber)||1,Z=`${n}_S${v}`,q=`${Z}_.zip`,J=[];for(const oe of p.sort((le,ve)=>le.shotIndex-ve.shotIndex)){const le=(pe=oe.mediaList)==null?void 0:pe.find(ve=>(ve==null?void 0:ve.isPrimary)&&(ve==null?void 0:ve.url));le&&le.url&&J.push({url:le.url,shotIndex:oe.shotIndex,type:le.type||"video",duration:le.duration||5})}if(J.length===0){fe.info("");return}we(!1);const ae=fe.loading("...");try{const oe=new _t,le=oe.folder(Z),ve=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,Ie=>{const $e=Math.random()*16|0;return(Ie==="x"?$e:$e&3|8).toString(16).toUpperCase()}),ge=[],he=[];let ke=0,We=0,Ze=0;for(const Ie of J)try{fe.loading(` ${ke+1}/${J.length}...`,{id:ae});const $e=await at.get("/assets/proxy-download",{params:{url:Ie.url},responseType:"blob"}),Ht=Ie.type==="image"?"png":Ie.type==="audio"?"mp3":"mp4",rt=`${String(ke+1).padStart(3,"0")}_Shot${String(Ie.shotIndex).padStart(2,"0")}.${Ht}`;le==null||le.file(rt,$e.data);const Ve=Math.round((Ie.duration||5)*1e6),kt=ve();ge.push({id:kt,type:Ie.type==="audio"?"audio":"video",duration:Ve,path:rt,material_name:rt}),he.push({id:ve(),material_id:kt,source_timerange:{duration:Ve,start:0},target_timerange:{duration:Ve,start:Ze}}),Ze+=Ve,We+=Ie.duration||5,ke++}catch{}fe.loading("...",{id:ae});const Xe={id:ve(),name:Z,duration:Ze,materials:{videos:ge},tracks:[{id:ve(),type:"video",segments:he}]};le==null||le.file("draft_content.json",JSON.stringify(Xe,null,2));const Ke={draft_id:Xe.id,draft_name:Z,draft_root_path:"",tm_draft_create:Date.now(),tm_draft_modified:Date.now()};le==null||le.file("draft_meta_info.json",JSON.stringify(Ke,null,2));const Zt=["# "+Z+" - ","","## ","","1. ","2. ","3. ","","001_Shot01, 002_Shot02...","","## ",...J.map((Ie,$e)=>"- "+String($e+1).padStart(3,"0")+"_Shot"+String(Ie.shotIndex).padStart(2,"0")+": "+(Ie.type==="image"?"":Ie.type==="audio"?"":"")+" ("+(Ie.duration||5)+")"),""," "+ke+"  "+Math.round(We)+" "].join(`\r
`);le==null||le.file(".txt",Zt);const $t=await oe.generateAsync({type:"blob"}),qe=document.createElement("a");qe.href=URL.createObjectURL($t),qe.download=q,qe.click(),URL.revokeObjectURL(qe.href),fe.success(`${ke} `,{id:ae})}catch(oe){fe.error(": "+(oe.message||""),{id:ae})}},Dt=async()=>{S.current&&clearTimeout(S.current),p.length>0&&await Fe(p);const n=[];X!=null&&X.selectedRoles&&X.selectedRoles.forEach(Z=>n.push({type:"role",...Z})),X!=null&&X.selectedScenes&&X.selectedScenes.forEach(Z=>n.push({type:"scene",...Z})),X!=null&&X.selectedProps&&X.selectedProps.forEach(Z=>n.push({type:"prop",...Z})),X!=null&&X.selectedAudios&&X.selectedAudios.forEach(Z=>n.push({type:"audio",...Z}));const v=n.length>0?`&assets=${encodeURIComponent(JSON.stringify(n))}`:"";k(`/projects/${ze}/episodes/${Ae}/workflow?scene=1&shot=${a}${v}`)},Pt=(s==null?void 0:s.name)||"",nt=d!=null&&d.episodeNumber&&d.episodeNumber>0?d.episodeNumber:void 0,Ft=async()=>{be(!0),f(""),j(""),W(null),G(""),K(""),xe(""),Ce(""),T([]);try{const n=await Le.agents.getAll(),Z=((n==null?void 0:n.data)||n||[]).filter(q=>q.isActive&&q.usageScene==="episode");Re(Z)}catch{fe.error("")}},Ut=async n=>{if(f(n),j(""),T([]),!!n)try{const v=await Le.agents.roles.listByAgent(n),q=((v==null?void 0:v.data)||v||[]).filter(J=>J.isActive);T(q)}catch{fe.error("")}},Wt=async n=>{var Z,q;const v=(Z=n.target.files)==null?void 0:Z[0];if(v)if(W(v),G(""),K(""),v.type==="text/plain"||v.name.endsWith(".txt")){const J=await v.text();xe(J)}else{xe("");const J=fe.loading("...");try{const ae=await Le.assets.upload(v),pe=((q=ae==null?void 0:ae.data)==null?void 0:q.url)||(ae==null?void 0:ae.url);pe?(G(pe),K(v.type),fe.success("AI",{id:J})):fe.error("",{id:J})}catch{fe.error("",{id:J})}}},Mt=async()=>{if(!l){fe.error("");return}if(!te&&!z){fe.error("/");return}Be(!0);const n=fe.loading("...");try{const v=te||"JSON";let Z="";ce&&(Z+=`

${ce}`),Z+=`


JSON
{
  "shots": [
    {
      "": "",
      "/": "///",
      "/": "",
      "/": "",
      "": "5s",
      "": "AI"
    }
  ]
}`;const q=z?[{filePath:z,mimeType:Q}]:void 0,J=await Le.agents.roles.execute(l,{prompt:v,systemPrompt:Z,maxTokens:16384,documentFiles:q}),ae=(J==null?void 0:J.data)||J;let pe=(ae==null?void 0:ae.text)||(ae==null?void 0:ae.content)||"";try{const oe=pe.match(/\{[\s\S]*\}/);if(oe){const ve=(JSON.parse(oe[0]).shots||[]).map((ge,he)=>({shotIndex:he+1,:ge.||ge.scene||"","/":ge["/"]||ge.shotType||"","/":ge["/"]||ge.action||"","/":ge["/"]||ge.dialogue||"",:ge.||ge.duration||"5s",:ge.||ge.prompt||""}));if(ve.length>0){if(p.length===0||window.confirm(` ${p.length} 
""""`))g(ve),m(1);else{const he=p.length>0?Math.max(...p.map(We=>We.shotIndex))+1:1,ke=ve.map((We,Ze)=>({...We,shotIndex:he+Ze}));g([...p,...ke])}fe.success(` ${ve.length} `,{id:n}),be(!1)}else fe.error("",{id:n})}else fe.error("",{id:n})}catch{fe.error("",{id:n})}}catch(v){fe.error((v==null?void 0:v.message)||"",{id:n})}finally{Be(!1)}};return y?t.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-background-light dark:bg-background-dark",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"})}):t.jsxs("div",{className:"h-screen w-full overflow-hidden flex flex-col bg-background-light dark:bg-background-dark",children:[t.jsxs("header",{className:"h-14 border-b border-slate-400 dark:border-white/20 flex items-center justify-between px-4 bg-white/70 dark:bg-black/30 backdrop-blur-xl shrink-0 overflow-visible relative z-10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>k(-1),className:"text-text-light-secondary dark:text-text-dark-secondary hover:text-text-light-primary dark:hover:text-text-dark-primary transition-colors",children:t.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),t.jsx("div",{className:"h-5 w-px bg-border-light dark:bg-border-dark"}),t.jsxs("h2",{className:"text-text-light-primary dark:text-text-dark-primary font-bold",children:["",Pt,"",nt&&t.jsxs("span",{className:"font-normal text-text-light-secondary dark:text-text-dark-secondary text-sm ml-2",children:["",nt,""]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[i&&t.jsx("span",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:"..."}),t.jsxs("div",{className:"group relative",children:[t.jsxs("button",{onClick:()=>O(!0),className:"relative w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white/70 border border-slate-400 dark:border-white/30 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white hover:border-transparent hover:scale-105 transition-all flex items-center justify-center",children:[t.jsx("span",{className:"material-symbols-outlined text-lg",children:"settings"}),L.length>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-slate-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center shadow",children:L.length})]}),t.jsx("span",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[9999]",children:""})]}),t.jsx("div",{className:"h-5 w-px bg-slate-300 dark:bg-white/20"}),t.jsxs("div",{className:"group relative",children:[t.jsx("button",{onClick:Ft,className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white/70 border border-slate-400 dark:border-white/30 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white hover:border-transparent hover:scale-105 transition-all flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"edit_note"})}),t.jsx("span",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[9999]",children:""})]}),t.jsx("div",{className:"h-5 w-px bg-slate-300 dark:bg-white/20"}),t.jsxs("div",{className:"group relative",children:[t.jsx("button",{onClick:Lt,className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white/70 border border-slate-400 dark:border-white/30 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white hover:border-transparent hover:scale-105 transition-all flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"content_cut"})}),t.jsx("span",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[9999]",children:""})]}),t.jsx("div",{className:"h-5 w-px bg-slate-300 dark:bg-white/20"}),t.jsxs("div",{className:"group relative",children:[t.jsx("button",{onClick:Tt,className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white/70 border border-slate-400 dark:border-white/30 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white hover:border-transparent hover:scale-105 transition-all flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"ios_share"})}),t.jsx("span",{className:"absolute top-full right-0 mt-1 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[9999]",children:""})]})]})]}),t.jsxs("div",{className:"flex-1 grid grid-cols-[320px_1fr_420px] min-h-0 overflow-hidden",children:[t.jsxs("div",{className:"border-r border-slate-400 dark:border-white/20 flex flex-col bg-white/70 dark:bg-black/30 backdrop-blur-xl min-h-0 overflow-hidden",children:[t.jsx("div",{className:"h-10 shrink-0 flex items-center px-4 border-b border-slate-400 dark:border-white/20",children:t.jsx("span",{className:"text-text-light-primary dark:text-text-dark-primary font-bold text-sm",children:""})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-3 min-h-0 scrollbar-thin",style:{scrollbarWidth:"thin"},children:X&&t.jsx(t.Fragment,{children:Array.isArray(X.mediaList)&&X.mediaList.length>0?(()=>{const n=X.mediaList.some(v=>v==null?void 0:v.isPrimary);return X.mediaList.map((v,Z)=>t.jsxs("div",{onClick:()=>Me(Z),className:`group relative flex gap-3 p-2 rounded-lg cursor-pointer transition-colors ${Ne===Z?"bg-purple-500/5 dark:bg-purple-500/5":"hover:bg-slate-100 dark:hover:bg-card-dark-hover"}`,style:Ne===Z?{border:"2px solid",borderImage:"linear-gradient(to bottom right, rgb(168,85,247), rgb(236,72,153)) 1"}:{},children:[t.jsxs("div",{className:"w-24 aspect-video bg-slate-200 dark:bg-border-dark rounded overflow-hidden relative",children:[(v==null?void 0:v.type)==="video"&&(v!=null&&v.url)?t.jsx("video",{src:v.url,className:"w-full h-full object-cover"}):(v==null?void 0:v.type)==="image"&&(v!=null&&v.url)?t.jsx("img",{src:v.url,alt:"",className:"w-full h-full object-cover"}):(v==null?void 0:v.type)==="audio"&&(v!=null&&v.url)?t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-500/20 to-pink-500/20",children:t.jsx("span",{className:"material-symbols-outlined text-2xl text-purple-500",children:"music_note"})}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"movie"})}),(v==null?void 0:v.isPrimary)&&t.jsx("div",{className:"absolute top-1 left-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-[10px] px-1.5 py-0.5 rounded font-bold",children:""})]}),t.jsxs("div",{className:"flex flex-col justify-center min-w-0 flex-1",children:[t.jsxs("p",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:[(v==null?void 0:v.type)==="video"?"":(v==null?void 0:v.type)==="image"?"":(v==null?void 0:v.type)==="audio"?"":""," ",Z+1]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-[14px] text-text-light-secondary dark:text-text-dark-secondary",children:(v==null?void 0:v.type)==="video"?"videocam":(v==null?void 0:v.type)==="image"?"image":(v==null?void 0:v.type)==="audio"?"music_note":"attachment"}),t.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary text-xs",children:v.aspectRatio||((v==null?void 0:v.type)==="audio"?"":"16:9")})]})]}),v!=null&&v.isPrimary?t.jsx("button",{onClick:q=>{q.stopPropagation(),St()},className:"shrink-0 self-center w-7 h-7 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all opacity-0 group-hover:opacity-100",title:"",children:t.jsx("span",{className:"material-symbols-outlined text-base",children:"star"})}):!n&&t.jsx("button",{onClick:q=>{q.stopPropagation(),Nt(Z)},className:"shrink-0 self-center w-7 h-7 flex items-center justify-center bg-slate-200 dark:bg-border-dark text-text-light-secondary dark:text-text-dark-secondary rounded-lg hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white transition-all opacity-0 group-hover:opacity-100",title:"",children:t.jsx("span",{className:"material-symbols-outlined text-base",children:"star_outline"})}),(v==null?void 0:v.url)&&t.jsx("button",{onClick:q=>{q.stopPropagation(),Bt(v.url,a,Z,v.type)},className:"shrink-0 self-center w-7 h-7 flex items-center justify-center bg-slate-200 dark:bg-border-dark text-text-light-secondary dark:text-text-dark-secondary rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-all opacity-0 group-hover:opacity-100",title:"",children:t.jsx("span",{className:"material-symbols-outlined text-base",children:"download"})}),!(v!=null&&v.isPrimary)&&t.jsx("button",{onClick:q=>{q.stopPropagation(),g(J=>J.map(ae=>{var pe;return ae.shotIndex===a?{...ae,mediaList:(pe=ae.mediaList)==null?void 0:pe.filter((oe,le)=>le!==Z)}:ae})),Ne>=Z&&Ne>0&&Me(Ne-1)},className:"shrink-0 self-center w-7 h-7 flex items-center justify-center bg-slate-200 dark:bg-border-dark text-text-light-secondary dark:text-text-dark-secondary rounded-lg hover:bg-red-500 hover:text-white transition-all opacity-0 group-hover:opacity-100",title:"",children:t.jsx("span",{className:"material-symbols-outlined text-base",children:"delete"})})]},Z))})():(ot=X.media)!=null&&ot.url?t.jsxs("div",{className:"group relative flex gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-card-dark-hover cursor-pointer transition-colors border border-transparent hover:border-border-light dark:hover:border-border-dark",children:[t.jsx("div",{className:"w-24 aspect-video bg-slate-200 dark:bg-border-dark rounded overflow-hidden relative",children:t.jsx("video",{src:X.media.url,className:"w-full h-full object-cover"})}),t.jsxs("div",{className:"flex flex-col justify-center min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:""}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-[14px] text-text-light-secondary dark:text-text-dark-secondary",children:"videocam"}),t.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary text-xs",children:X.media.aspectRatio||"16:9"})]})]})]}):t.jsxs("div",{className:"text-center text-text-light-secondary dark:text-text-dark-secondary text-sm py-8",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"movie"}),""]})})})]}),t.jsxs("div",{className:"bg-white/70 dark:bg-black/30 backdrop-blur-xl flex flex-col relative overflow-hidden h-full",children:[t.jsxs("div",{className:"h-10 shrink-0 flex items-center justify-between px-4 border-b border-slate-400 dark:border-white/20",children:[t.jsxs("div",{className:"flex items-center gap-3 text-text-light-secondary dark:text-text-dark-secondary text-sm",children:[t.jsxs("span",{className:"font-bold text-text-light-primary dark:text-text-dark-primary",children:[" ",a.toString().padStart(2,"0")]}),t.jsx("span",{children:"/"}),t.jsxs("span",{children:[" ",p.length," "]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"group relative",children:[t.jsx("button",{onClick:()=>{L.length===0?(fe.info(""),O(!0)):Y(!0)},className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white/70 border border-slate-400 dark:border-white/30 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white hover:border-transparent hover:scale-105 transition-all flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"library_add"})}),t.jsx("span",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[9999]",children:""})]}),t.jsxs("div",{className:"group relative ml-2",children:[t.jsx("button",{onClick:Dt,className:"w-8 h-8 rounded-lg bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-white/70 border border-slate-400 dark:border-white/30 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 hover:text-white hover:border-transparent hover:scale-105 transition-all flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"auto_awesome"})}),t.jsx("span",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[9999]",children:""})]})]})]}),t.jsx("div",{className:"flex-1 flex items-center justify-center p-4 min-h-0 min-w-0 overflow-hidden",children:X&&((dt=(lt=X.mediaList)==null?void 0:lt[Ne])!=null&&dt.url||(ht=(ct=X.mediaList)==null?void 0:ct[0])!=null&&ht.url||(ut=X.media)!=null&&ut.url)?(()=>{var q,J;const n=((q=X.mediaList)==null?void 0:q[Ne])||((J=X.mediaList)==null?void 0:J[0])||X.media,v=(n==null?void 0:n.type)||"video",Z=n==null?void 0:n.url;return v==="video"?t.jsx("video",{src:Z,controls:!0,className:"max-w-full max-h-full rounded-lg object-contain"}):v==="image"?t.jsx("img",{src:Z,alt:"",className:"max-w-full max-h-full rounded-lg object-contain"}):v==="audio"?t.jsxs("div",{className:"w-80 p-8 rounded-lg bg-gradient-to-br from-purple-900/50 to-pink-900/50 flex flex-col items-center justify-center",children:[t.jsx("span",{className:"material-symbols-outlined text-6xl text-purple-400 mb-4",children:"music_note"}),t.jsx("audio",{src:Z,controls:!0,className:"w-full"})]}):t.jsx("video",{src:Z,controls:!0,className:"max-w-full max-h-full rounded-lg object-contain"})})():t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl text-slate-400 dark:text-slate-500 mb-2",children:"movie"}),t.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm",children:""})]})})})]}),t.jsxs("div",{className:"border-l border-slate-400 dark:border-white/20 bg-white/70 dark:bg-black/30 backdrop-blur-xl flex flex-col",children:[t.jsxs("div",{className:"h-10 flex items-center justify-between px-4 border-b border-slate-400 dark:border-white/20",children:[t.jsx("span",{className:"text-text-light-primary dark:text-text-dark-primary font-bold text-sm",children:""}),Se&&!1]}),t.jsx("div",{className:"flex-1 p-4 flex flex-col min-h-0",children:X?t.jsxs("div",{className:"flex flex-col gap-3 h-full",children:[t.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[t.jsx("label",{className:"block text-xs font-bold text-text-light-secondary dark:text-text-dark-secondary mb-1 uppercase shrink-0",children:""}),t.jsx("textarea",{value:X.,onChange:Se?n=>tt(a,"",n.target.value):void 0,onBlur:Se?()=>Fe(p):void 0,readOnly:!Se,className:"flex-1 w-full bg-white/30 dark:bg-white/5 text-text-light-primary dark:text-text-dark-primary rounded-lg p-3 text-sm resize-none border border-slate-400 dark:border-white/20 focus:border-purple-500 focus:outline-none backdrop-blur-sm",placeholder:"..."})]}),t.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[t.jsx("label",{className:"block text-xs font-bold text-text-light-secondary dark:text-text-dark-secondary mb-1 uppercase shrink-0",children:""}),t.jsx("textarea",{value:X["/"],onChange:Se?n=>tt(a,"/",n.target.value):void 0,onBlur:Se?()=>Fe(p):void 0,readOnly:!Se,className:"flex-1 w-full bg-white/30 dark:bg-white/5 text-text-light-primary dark:text-text-dark-primary rounded-lg p-3 text-sm resize-none border border-slate-400 dark:border-white/20 focus:border-purple-500 focus:outline-none backdrop-blur-sm",placeholder:"..."})]}),t.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[t.jsx("label",{className:"block text-xs font-bold text-text-light-secondary dark:text-text-dark-secondary mb-1 uppercase shrink-0",children:"/"}),t.jsx("textarea",{value:X["/"],onChange:Se?n=>tt(a,"/",n.target.value):void 0,onBlur:Se?()=>Fe(p):void 0,readOnly:!Se,className:"flex-1 w-full bg-white/30 dark:bg-white/5 text-text-light-primary dark:text-text-dark-primary rounded-lg p-3 text-sm resize-none border border-slate-400 dark:border-white/20 focus:border-purple-500 focus:outline-none backdrop-blur-sm",placeholder:"..."})]})]}):t.jsx("div",{className:"text-center text-text-light-secondary dark:text-text-dark-secondary py-8",children:""})})]})]}),t.jsxs("div",{className:"h-80 border-t border-slate-400 dark:border-white/20 bg-white/70 dark:bg-black/30 backdrop-blur-xl shrink-0 flex flex-col",children:[t.jsxs("div",{className:"flex-1 flex items-center justify-center px-4 gap-3 border-b border-slate-400 dark:border-white/20",children:[t.jsx("button",{onClick:()=>x(Math.max(0,o-1)),disabled:o<=0,className:"shrink-0 w-8 h-8 rounded-full bg-slate-200 dark:bg-border-dark flex items-center justify-center text-text-light-secondary dark:text-text-dark-secondary hover:bg-slate-300 dark:hover:bg-border-dark-hover hover:text-text-light-primary dark:hover:text-text-dark-primary disabled:opacity-30 disabled:cursor-not-allowed transition-all",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"chevron_left"})}),t.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-visible py-2 px-4",children:t.jsxs("div",{className:"flex gap-3 transition-transform duration-300",style:{transform:`translateX(-${o*(_+12)}px)`},children:[p.map(n=>t.jsxs("div",{draggable:Se,onDragStart:v=>Et(v,n.shotIndex),onDragOver:v=>It(v,n.shotIndex),onDragLeave:At,onDrop:v=>Ot(v,n.shotIndex),onDragEnd:Rt,onClick:()=>m(n.shotIndex),className:`flex flex-col gap-1 shrink-0 cursor-pointer transition-all ${n.shotIndex===a?"opacity-100":"opacity-60 hover:opacity-100"} ${Te===n.shotIndex?"opacity-50 scale-95":""} ${He===n.shotIndex?"ring-2 ring-primary-500 ring-offset-2":""}`,children:[t.jsx("div",{className:`w-32 h-24 rounded-lg overflow-hidden relative ${n.shotIndex===a?"bg-gradient-to-br from-purple-500 to-pink-500 p-[2px] shadow-[0_0_20px_-3px_rgba(168,85,247,0.5)]":"bg-slate-200 dark:bg-border-dark ring-1 ring-slate-200 dark:ring-white/10 hover:ring-purple-400/50 dark:hover:ring-purple-400/30"}`,children:t.jsxs("div",{className:`w-full h-full rounded-md overflow-hidden ${n.shotIndex===a?"bg-slate-200 dark:bg-border-dark":""}`,children:[(()=>{var Z,q;const v=((Z=n.mediaList)==null?void 0:Z.find(J=>J==null?void 0:J.isPrimary))||((q=n.mediaList)==null?void 0:q[0])||n.media;return v!=null&&v.url?v.type==="image"?t.jsx("img",{src:v.url,alt:"",className:"w-full h-full object-cover"}):v.type==="audio"?t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-500/20 to-pink-500/20",children:t.jsx("span",{className:"material-symbols-outlined text-2xl text-purple-500",children:"music_note"})}):t.jsx("video",{src:v.url,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-3xl text-text-light-secondary dark:text-text-dark-secondary",children:"movie"})})})(),n.shotIndex===a&&t.jsx("div",{className:"absolute top-1 right-1 size-2 bg-primary-500 rounded-full animate-pulse"})]})}),t.jsxs("span",{className:`text-[10px] text-center ${n.shotIndex===a?"text-primary-500 font-bold":"text-text-light-secondary dark:text-text-dark-secondary"}`,children:["Shot ",n.shotIndex.toString().padStart(2,"0")," - ",Ye[n.shotIndex]?`${Math.round(Ye[n.shotIndex])}s`:n.||"0s"]})]},n.shotIndex)),Se&&t.jsx("div",{onClick:Ct,className:"w-12 h-24 rounded-lg border border-dashed border-border-light dark:border-border-dark flex items-center justify-center text-text-light-secondary dark:text-text-dark-secondary hover:text-text-light-primary dark:hover:text-text-dark-primary hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-500/10 cursor-pointer transition-all shrink-0",children:t.jsx("span",{className:"material-symbols-outlined",children:"add"})})]})}),t.jsx("button",{onClick:()=>x(Math.min(Math.max(0,p.length-5),o+1)),disabled:o>=Math.max(0,p.length-5),className:"shrink-0 w-8 h-8 rounded-full bg-slate-200 dark:bg-border-dark flex items-center justify-center text-text-light-secondary dark:text-text-dark-secondary hover:bg-slate-300 dark:hover:bg-border-dark-hover hover:text-text-light-primary dark:hover:text-text-dark-primary disabled:opacity-30 disabled:cursor-not-allowed transition-all",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"chevron_right"})}),Se&&X&&p.length>0&&t.jsx("button",{onClick:()=>zt(a),className:"shrink-0 w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 flex items-center justify-center hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors",title:"",children:t.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]}),t.jsxs("div",{className:"flex-1 grid grid-cols-4 divide-x divide-slate-400 dark:divide-purple-400/30",children:[t.jsxs("div",{className:"px-4 py-3 flex flex-col gap-2",children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsxs("h4",{className:"text-xs font-bold uppercase text-text-light-secondary dark:text-text-dark-secondary tracking-wider flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-sm",children:"face"}),"  ",(((ft=X==null?void 0:X.selectedRoles)==null?void 0:ft.length)||0)>0&&t.jsxs("span",{className:"text-primary-500",children:["(",(pt=X==null?void 0:X.selectedRoles)==null?void 0:pt.length,")"]})]})}),t.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2",children:[((X==null?void 0:X.selectedRoles)||[]).map(n=>t.jsxs("div",{className:"shrink-0 flex flex-col items-center gap-1 cursor-pointer hover:opacity-80 transition-opacity group relative mt-2",children:[t.jsx("div",{className:"size-12 rounded overflow-hidden bg-purple-500/5",children:n.thumbnail?t.jsx("img",{src:n.thumbnail,alt:n.name,className:"w-full h-full object-cover object-top"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"person"})})}),t.jsx("span",{className:"text-[10px] text-text-light-secondary dark:text-text-dark-secondary truncate max-w-[50px]",children:n.name}),t.jsx("button",{onClick:()=>Ee("role",n),className:"absolute -top-1 -right-1 size-4 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},n.id)),t.jsxs("div",{onClick:()=>{L.length===0?(fe.info(""),O(!0)):ee("role")},className:"shrink-0 flex flex-col items-center gap-1 cursor-pointer opacity-50 hover:opacity-100 transition-opacity mt-2",children:[t.jsx("div",{className:"size-12 rounded border-2 border-dashed border-border-light dark:border-border-dark flex items-center justify-center hover:border-primary-500",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"add"})}),t.jsx("span",{className:"text-[10px] text-text-light-secondary dark:text-text-dark-secondary",children:""})]})]})]}),t.jsxs("div",{className:"px-4 py-3 flex flex-col gap-2",children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsxs("h4",{className:"text-xs font-bold uppercase text-text-light-secondary dark:text-text-dark-secondary tracking-wider flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-sm",children:"landscape"}),"  ",(((mt=X==null?void 0:X.selectedScenes)==null?void 0:mt.length)||0)>0&&t.jsxs("span",{className:"text-primary-500",children:["(",(xt=X==null?void 0:X.selectedScenes)==null?void 0:xt.length,")"]})]})}),t.jsxs("div",{className:"flex gap-3 overflow-x-auto",children:[((X==null?void 0:X.selectedScenes)||[]).map(n=>t.jsxs("div",{className:"relative w-24 h-14 rounded overflow-hidden cursor-pointer transition-colors shrink-0 group bg-purple-500/5 mt-2",children:[n.url?t.jsx("img",{src:n.url,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"landscape"})}),t.jsx("button",{onClick:()=>Ee("scene",n),className:"absolute top-0.5 right-0.5 size-4 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},n.id)),t.jsxs("div",{onClick:()=>{L.length===0?(fe.info(""),O(!0)):ee("scene")},className:"shrink-0 flex flex-col items-center gap-1 cursor-pointer opacity-50 hover:opacity-100 transition-opacity mt-2",children:[t.jsx("div",{className:"size-12 rounded border-2 border-dashed border-border-light dark:border-border-dark flex items-center justify-center hover:border-primary-500",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"add"})}),t.jsx("span",{className:"text-[10px] text-text-light-secondary dark:text-text-dark-secondary",children:""})]})]})]}),t.jsxs("div",{className:"px-4 py-3 flex flex-col gap-2",children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsxs("h4",{className:"text-xs font-bold uppercase text-text-light-secondary dark:text-text-dark-secondary tracking-wider flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-sm",children:"backpack"}),"  ",(((gt=X==null?void 0:X.selectedProps)==null?void 0:gt.length)||0)>0&&t.jsxs("span",{className:"text-primary-500",children:["(",(bt=X==null?void 0:X.selectedProps)==null?void 0:bt.length,")"]})]})}),t.jsxs("div",{className:"flex gap-3 overflow-x-auto",children:[((X==null?void 0:X.selectedProps)||[]).map(n=>t.jsxs("div",{className:"size-14 rounded overflow-hidden cursor-pointer transition-colors shrink-0 relative group bg-purple-500/5 mt-2",children:[n.url?t.jsx("img",{src:n.url,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"backpack"})}),t.jsx("button",{onClick:()=>Ee("prop",n),className:"absolute top-0.5 right-0.5 size-4 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},n.id)),t.jsxs("div",{onClick:()=>{L.length===0?(fe.info(""),O(!0)):ee("prop")},className:"shrink-0 flex flex-col items-center gap-1 cursor-pointer opacity-50 hover:opacity-100 transition-opacity mt-2",children:[t.jsx("div",{className:"size-12 rounded border-2 border-dashed border-border-light dark:border-border-dark flex items-center justify-center hover:border-primary-500",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"add"})}),t.jsx("span",{className:"text-[10px] text-text-light-secondary dark:text-text-dark-secondary",children:""})]})]})]}),t.jsxs("div",{className:"px-4 py-3 flex flex-col gap-2",children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsxs("h4",{className:"text-xs font-bold uppercase text-text-light-secondary dark:text-text-dark-secondary tracking-wider flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-sm",children:"music_note"}),"  ",(((yt=X==null?void 0:X.selectedAudios)==null?void 0:yt.length)||0)>0&&t.jsxs("span",{className:"text-primary-500",children:["(",(vt=X==null?void 0:X.selectedAudios)==null?void 0:vt.length,")"]})]})}),t.jsxs("div",{className:"flex gap-3 overflow-x-auto",children:[((X==null?void 0:X.selectedAudios)||[]).map(n=>t.jsxs("div",{className:"shrink-0 flex flex-col items-center gap-1 cursor-pointer hover:opacity-80 transition-opacity group relative mt-2",children:[t.jsx("div",{className:"size-12 rounded overflow-hidden flex items-center justify-center bg-purple-500/5",children:t.jsx("span",{className:"material-symbols-outlined text-primary-500",children:"music_note"})}),t.jsx("span",{className:"text-[10px] text-text-light-secondary dark:text-text-dark-secondary truncate max-w-[50px]",children:n.name}),t.jsx("button",{onClick:()=>Ee("audio",n),className:"absolute -top-1 -right-1 size-4 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},n.id)),t.jsxs("div",{onClick:()=>{L.length===0?(fe.info(""),O(!0)):ee("audio")},className:"shrink-0 flex flex-col items-center gap-1 cursor-pointer opacity-50 hover:opacity-100 transition-opacity mt-2",children:[t.jsx("div",{className:"size-12 rounded border-2 border-dashed border-border-light dark:border-border-dark flex items-center justify-center hover:border-primary-500",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"add"})}),t.jsx("span",{className:"text-[10px] text-text-light-secondary dark:text-text-dark-secondary",children:""})]})]})]})]})]}),E&&L.length>0&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>ee(null),children:t.jsxs("div",{className:"bg-card-light dark:bg-card-dark rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",onClick:n=>n.stopPropagation(),children:[t.jsxs("div",{className:"p-6 border-b border-border-light dark:border-border-dark flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-bold text-text-light-primary dark:text-text-dark-primary",children:["",E==="role"?"":E==="scene"?"":E==="prop"?"":""]}),t.jsxs("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary mt-1",children:[" (Shot ",a,") "]})]}),t.jsx("button",{onClick:()=>ee(null),className:"text-text-light-secondary dark:text-text-dark-secondary hover:text-text-light-primary dark:hover:text-text-dark-primary",children:t.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),t.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[E==="role"&&(b.length===0?t.jsxs("div",{className:"text-center py-8 text-text-light-secondary dark:text-text-dark-secondary",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"face"}),t.jsx("p",{children:""})]}):t.jsx("div",{className:"grid grid-cols-4 gap-4",children:b.map(n=>t.jsxs("div",{onClick:()=>Ee("role",n),className:`flex flex-col items-center gap-2 p-3 rounded-xl cursor-pointer transition-all ${De("role",n.id)?"bg-primary-100 dark:bg-primary-500/20 ring-2 ring-primary-500":"hover:bg-slate-100 dark:hover:bg-border-dark"}`,children:[t.jsx("div",{className:"size-16 rounded-lg overflow-hidden bg-slate-100 dark:bg-border-dark",children:n.thumbnail?t.jsx("img",{src:n.thumbnail,alt:n.name,className:"w-full h-full object-cover object-top"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary",children:"person"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate max-w-full",children:n.name}),De("role",n.id)&&t.jsx("span",{className:"material-symbols-outlined text-primary-500 text-sm",children:"check_circle"})]},n.id))})),E==="scene"&&(r.length===0?t.jsxs("div",{className:"text-center py-8 text-text-light-secondary dark:text-text-dark-secondary",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"landscape"}),t.jsx("p",{children:""})]}):t.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.map(n=>t.jsxs("div",{onClick:()=>Ee("scene",n),className:`flex flex-col gap-2 p-3 rounded-xl cursor-pointer transition-all ${De("scene",n.id)?"bg-primary-100 dark:bg-primary-500/20 ring-2 ring-primary-500":"hover:bg-slate-100 dark:hover:bg-border-dark"}`,children:[t.jsx("div",{className:"aspect-video rounded-lg overflow-hidden bg-slate-100 dark:bg-border-dark",children:n.url?t.jsx("img",{src:n.url,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary",children:"landscape"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:n.name})]},n.id))})),E==="prop"&&(ne.length===0?t.jsxs("div",{className:"text-center py-8 text-text-light-secondary dark:text-text-dark-secondary",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"backpack"}),t.jsx("p",{children:""})]}):t.jsx("div",{className:"grid grid-cols-4 gap-4",children:ne.map(n=>t.jsxs("div",{onClick:()=>Ee("prop",n),className:`flex flex-col gap-2 p-3 rounded-xl cursor-pointer transition-all ${De("prop",n.id)?"bg-primary-100 dark:bg-primary-500/20 ring-2 ring-primary-500":"hover:bg-slate-100 dark:hover:bg-border-dark"}`,children:[t.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-slate-100 dark:bg-border-dark",children:n.url?t.jsx("img",{src:n.url,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary",children:"backpack"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:n.name})]},n.id))})),E==="audio"&&(de.length===0?t.jsxs("div",{className:"text-center py-8 text-text-light-secondary dark:text-text-dark-secondary",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"music_note"}),t.jsx("p",{children:""})]}):t.jsx("div",{className:"grid grid-cols-4 gap-4",children:de.map(n=>t.jsxs("div",{onClick:()=>Ee("audio",n),className:`flex flex-col items-center gap-2 p-3 rounded-xl cursor-pointer transition-all ${De("audio",n.id)?"bg-primary-100 dark:bg-primary-500/20 ring-2 ring-primary-500":"hover:bg-slate-100 dark:hover:bg-border-dark"}`,children:[t.jsx("div",{className:"size-16 rounded-lg overflow-hidden bg-slate-100 dark:bg-border-dark flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-2xl text-primary-500",children:"music_note"})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate max-w-full",children:n.name}),De("audio",n.id)&&t.jsx("span",{className:"material-symbols-outlined text-primary-500 text-sm",children:"check_circle"})]},n.id))}))]}),t.jsx("div",{className:"p-6 border-t border-border-light dark:border-border-dark flex justify-end",children:t.jsx("button",{onClick:()=>ee(null),className:"px-4 py-2 rounded-lg bg-primary-500 text-white text-sm font-medium hover:bg-primary-600 transition-colors",children:""})})]})}),U&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>O(!1),children:t.jsxs("div",{className:"bg-card-light dark:bg-card-dark rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",onClick:n=>n.stopPropagation(),children:[t.jsxs("div",{className:"p-6 border-b border-border-light dark:border-border-dark flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-text-light-primary dark:text-text-dark-primary",children:""}),t.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary mt-1",children:""})]}),t.jsx("button",{onClick:()=>O(!1),className:"text-text-light-secondary dark:text-text-dark-secondary hover:text-text-light-primary dark:hover:text-text-dark-primary",children:t.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[50vh]",children:P.length===0?t.jsxs("div",{className:"text-center py-8 text-text-light-secondary dark:text-text-dark-secondary",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"inventory_2"}),t.jsx("p",{children:""}),t.jsx("p",{className:"text-sm mt-1",children:""})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-text-light-primary dark:text-text-dark-primary mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-lg",children:"face"})," "]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.filter(n=>n.category==="ROLE").map(n=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${L.includes(n.id)?"border-primary-500 bg-primary-50 dark:bg-primary-500/10":"border-border-light dark:border-border-dark hover:border-primary-300"}`,children:[t.jsx("input",{type:"checkbox",checked:L.includes(n.id),onChange:()=>Je(n.id),className:"sr-only"}),t.jsx("div",{className:"size-10 rounded-lg bg-slate-100 dark:bg-border-dark overflow-hidden shrink-0",children:n.thumbnail?t.jsx("img",{src:n.thumbnail,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"folder"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:n.name}),L.includes(n.id)&&t.jsx("span",{className:"material-symbols-outlined text-primary-500 ml-auto",children:"check_circle"})]},n.id)),P.filter(n=>n.category==="ROLE").length===0&&t.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary col-span-2",children:""})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-text-light-primary dark:text-text-dark-primary mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-lg",children:"landscape"})," "]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.filter(n=>n.category==="SCENE").map(n=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${L.includes(n.id)?"border-primary-500 bg-primary-50 dark:bg-primary-500/10":"border-border-light dark:border-border-dark hover:border-primary-300"}`,children:[t.jsx("input",{type:"checkbox",checked:L.includes(n.id),onChange:()=>Je(n.id),className:"sr-only"}),t.jsx("div",{className:"size-10 rounded-lg bg-slate-100 dark:bg-border-dark overflow-hidden shrink-0",children:n.thumbnail?t.jsx("img",{src:n.thumbnail,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"folder"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:n.name}),L.includes(n.id)&&t.jsx("span",{className:"material-symbols-outlined text-primary-500 ml-auto",children:"check_circle"})]},n.id)),P.filter(n=>n.category==="SCENE").length===0&&t.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary col-span-2",children:""})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-text-light-primary dark:text-text-dark-primary mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-lg",children:"backpack"})," "]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.filter(n=>n.category==="PROP").map(n=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${L.includes(n.id)?"border-primary-500 bg-primary-50 dark:bg-primary-500/10":"border-border-light dark:border-border-dark hover:border-primary-300"}`,children:[t.jsx("input",{type:"checkbox",checked:L.includes(n.id),onChange:()=>Je(n.id),className:"sr-only"}),t.jsx("div",{className:"size-10 rounded-lg bg-slate-100 dark:bg-border-dark overflow-hidden shrink-0",children:n.thumbnail?t.jsx("img",{src:n.thumbnail,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"folder"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:n.name}),L.includes(n.id)&&t.jsx("span",{className:"material-symbols-outlined text-primary-500 ml-auto",children:"check_circle"})]},n.id)),P.filter(n=>n.category==="PROP").length===0&&t.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary col-span-2",children:""})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-text-light-primary dark:text-text-dark-primary mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-lg",children:"music_note"})," "]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.filter(n=>n.category==="AUDIO").map(n=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${L.includes(n.id)?"border-primary-500 bg-primary-50 dark:bg-primary-500/10":"border-border-light dark:border-border-dark hover:border-primary-300"}`,children:[t.jsx("input",{type:"checkbox",checked:L.includes(n.id),onChange:()=>Je(n.id),className:"sr-only"}),t.jsx("div",{className:"size-10 rounded-lg bg-slate-100 dark:bg-border-dark overflow-hidden shrink-0",children:n.thumbnail?t.jsx("img",{src:n.thumbnail,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"music_note"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:n.name}),L.includes(n.id)&&t.jsx("span",{className:"material-symbols-outlined text-primary-500 ml-auto",children:"check_circle"})]},n.id)),P.filter(n=>n.category==="AUDIO").length===0&&t.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary col-span-2",children:""})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-bold text-text-light-primary dark:text-text-dark-primary mb-3 flex items-center gap-2",children:[t.jsx("span",{className:"material-symbols-outlined text-lg",children:"folder"})," "]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.filter(n=>n.category==="OTHER").map(n=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${L.includes(n.id)?"border-primary-500 bg-primary-50 dark:bg-primary-500/10":"border-border-light dark:border-border-dark hover:border-primary-300"}`,children:[t.jsx("input",{type:"checkbox",checked:L.includes(n.id),onChange:()=>Je(n.id),className:"sr-only"}),t.jsx("div",{className:"size-10 rounded-lg bg-slate-100 dark:bg-border-dark overflow-hidden shrink-0",children:n.thumbnail?t.jsx("img",{src:n.thumbnail,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"folder"})})}),t.jsx("span",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary truncate",children:n.name}),L.includes(n.id)&&t.jsx("span",{className:"material-symbols-outlined text-primary-500 ml-auto",children:"check_circle"})]},n.id)),P.filter(n=>n.category==="OTHER").length===0&&t.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary col-span-2",children:""})]})]})]})}),t.jsxs("div",{className:"p-6 border-t border-border-light dark:border-border-dark flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>O(!1),className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-border-dark text-text-light-primary dark:text-text-dark-primary text-sm font-medium hover:bg-slate-200 dark:hover:bg-border-dark-hover transition-colors",children:""}),t.jsx("button",{onClick:()=>jt(L),className:"px-4 py-2 rounded-lg bg-primary-500 text-white text-sm font-medium hover:bg-primary-600 transition-colors",children:""})]})]})}),V&&L.length>0&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>Y(!1),children:t.jsxs("div",{className:"bg-card-light dark:bg-card-dark rounded-2xl shadow-2xl w-full max-w-3xl max-h-[80vh] overflow-hidden",onClick:n=>n.stopPropagation(),children:[t.jsxs("div",{className:"p-6 border-b border-border-light dark:border-border-dark flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-text-light-primary dark:text-text-dark-primary",children:""}),t.jsxs("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary mt-1",children:["// (Shot ",a,")"]})]}),t.jsx("button",{onClick:()=>Y(!1),className:"text-text-light-secondary dark:text-text-dark-secondary hover:text-text-light-primary dark:hover:text-text-dark-primary",children:t.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:se.length>0?t.jsx("div",{className:"grid grid-cols-4 gap-3",children:se.filter(n=>n.url).map(n=>{var J,ae;const v=(J=n.url)==null?void 0:J.match(/\.(mp4|webm|mov|avi)$/i),Z=(ae=n.url)==null?void 0:ae.match(/\.(mp3|wav|ogg|m4a)$/i),q=v?"video":Z?"audio":"image";return t.jsxs("div",{onClick:()=>{const pe={type:q,url:n.url,nodeId:`imported-${n.id}`};g(oe=>oe.map(le=>le.shotIndex===a?{...le,mediaList:[...le.mediaList||[],pe]}:le)),fe.success("")},className:"relative aspect-video rounded-lg overflow-hidden cursor-pointer hover:ring-2 hover:ring-primary-500 transition-all group",children:[v?t.jsx("video",{src:n.url,className:"w-full h-full object-cover"}):Z?t.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-3xl text-purple-500",children:"music_note"})}):t.jsx("img",{src:n.url,alt:n.name,className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-white text-2xl",children:"add_circle"})}),t.jsx("span",{className:"absolute bottom-1 left-1 right-1 text-[10px] text-white bg-black/50 px-1 py-0.5 rounded truncate",children:n.name})]},n.id)})}):t.jsxs("div",{className:"text-center py-8 text-text-light-secondary dark:text-text-dark-secondary",children:[t.jsx("span",{className:"material-symbols-outlined text-4xl mb-2 block",children:"inventory_2"}),t.jsx("p",{children:""}),t.jsx("p",{className:"text-sm mt-1",children:'""'})]})}),t.jsx("div",{className:"p-6 border-t border-border-light dark:border-border-dark flex justify-end",children:t.jsx("button",{onClick:()=>Y(!1),className:"px-4 py-2 rounded-lg bg-primary-500 text-white text-sm font-medium hover:bg-primary-600 transition-colors",children:""})})]})}),je&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl shadow-2xl max-h-[90vh] flex flex-col",children:[t.jsx("div",{className:"p-6 border-b border-border-light dark:border-border-dark shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-white",children:"edit_note"})}),t.jsx("h2",{className:"text-lg font-bold text-text-light-primary dark:text-text-dark-primary",children:"AI "})]}),t.jsx("button",{onClick:()=>be(!1),className:"text-text-light-tertiary dark:text-text-dark-tertiary hover:text-text-light-primary dark:hover:text-text-dark-primary",children:t.jsx("span",{className:"material-symbols-outlined",children:"close"})})]})}),t.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-2",children:[" ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{value:A,onChange:n=>Ut(n.target.value),className:"w-full px-4 py-3 rounded-xl border border-border-light dark:border-border-dark bg-white dark:bg-slate-800 text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:ring-2 focus:ring-primary-500",children:[t.jsx("option",{value:"",children:""}),Oe.map(n=>t.jsx("option",{value:n.id,children:n.name},n.id))]}),Oe.length===0&&t.jsx("p",{className:"mt-2 text-sm text-amber-600 dark:text-amber-400",children:""})]}),A&&t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-2",children:[" ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:e.map(n=>t.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all ${l===n.id?"border-primary-500 bg-primary-50 dark:bg-primary-500/10":"border-border-light dark:border-border-dark hover:border-primary-300"}`,children:[t.jsx("input",{type:"radio",name:"scriptRole",value:n.id,checked:l===n.id,onChange:v=>j(v.target.value),className:"sr-only"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-text-light-primary dark:text-text-dark-primary",children:n.name}),n.description&&t.jsx("div",{className:"text-xs text-text-light-tertiary dark:text-text-dark-tertiary mt-1 line-clamp-2",children:n.description})]}),l===n.id&&t.jsx("span",{className:"material-symbols-outlined text-primary-500",children:"check_circle"})]},n.id))}),e.length===0&&t.jsx("p",{className:"text-sm text-text-light-tertiary dark:text-text-dark-tertiary",children:""})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-2",children:["/ ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:`border-2 border-dashed rounded-xl p-4 text-center ${z?"border-green-500 bg-green-50 dark:bg-green-500/10":"border-border-light dark:border-border-dark"}`,children:[t.jsx("input",{type:"file",accept:".txt,.pdf,.doc,.docx",onChange:Wt,className:"hidden",id:"script-file-input"}),t.jsxs("label",{htmlFor:"script-file-input",className:"cursor-pointer",children:[t.jsx("span",{className:`material-symbols-outlined text-4xl ${z?"text-green-500":"text-text-light-tertiary dark:text-text-dark-tertiary"}`,children:z?"check_circle":"upload_file"}),t.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary mt-2",children:F?F.name:" TXTPDFWord"}),z&&t.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:" AI"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-2",children:""}),t.jsx("textarea",{value:ce,onChange:n=>Ce(n.target.value),placeholder:"20...",rows:3,className:"w-full px-4 py-3 rounded-xl border border-border-light dark:border-border-dark bg-white dark:bg-slate-800 text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none"})]})]}),t.jsxs("div",{className:"p-6 border-t border-border-light dark:border-border-dark flex gap-3 justify-end shrink-0",children:[t.jsx("button",{onClick:()=>be(!1),className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-white/10 text-text-light-primary dark:text-text-dark-primary text-sm font-medium hover:bg-slate-200 dark:hover:bg-white/20 transition-colors",children:""}),t.jsx("button",{onClick:Mt,disabled:Ue||!l||!F,className:"px-6 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:Ue?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"material-symbols-outlined animate-spin text-lg",children:"progress_activity"}),"..."]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"material-symbols-outlined text-lg",children:"auto_awesome"}),""]})})]})]})}),_e&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl",children:[t.jsx("div",{className:"p-6 border-b border-border-light dark:border-border-dark",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-500/20 flex items-center justify-center",children:t.jsx("span",{className:"material-symbols-outlined text-amber-600 dark:text-amber-400",children:"warning"})}),t.jsx("h2",{className:"text-lg font-bold text-text-light-primary dark:text-text-dark-primary",children:""})]})}),t.jsxs("div",{className:"p-6",children:[t.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-4",children:""}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:ue.map(n=>t.jsxs("span",{className:"px-3 py-1 rounded-full bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-400 text-sm font-medium",children:["Shot ",String(n).padStart(2,"0")]},n))}),t.jsx("p",{className:"text-sm text-text-light-tertiary dark:text-text-dark-tertiary",children:""})]}),t.jsxs("div",{className:"p-6 border-t border-border-light dark:border-border-dark flex gap-3 justify-end",children:[t.jsx("button",{onClick:()=>we(!1),className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-white/10 text-text-light-primary dark:text-text-dark-primary text-sm font-medium hover:bg-slate-200 dark:hover:bg-white/20 transition-colors",children:""}),t.jsx("button",{onClick:()=>it(),className:"px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-medium hover:shadow-lg transition-all",children:""})]})]})})]})}export{rr as default};
