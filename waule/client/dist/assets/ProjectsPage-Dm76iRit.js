import{d as X,r as k,j as e,R as v}from"./react-vendor-BvY2dB7B.js";import{b as u,c as o,d as G,u as Y}from"./index-CtmyI1O4.js";import"./reactflow-D8v6_Qvs.js";import"./utils-BcyDR7Vi.js";const H=({isEdit:s=!1,onSubmit:E,onClose:R,formData:j,setFormData:w,thumbnail:C,setThumbnail:S,hideType:K=!1,projectId:m,projectType:n})=>{const A=v.useRef(null),[I,f]=v.useState(!1),[i,g]=v.useState([]),[L,_]=v.useState(""),[D,y]=v.useState([]),[U,W]=v.useState(!1),[V,M]=v.useState(!1),[$,z]=v.useState(null),[a,x]=v.useState("READ"),[d,b]=v.useState(!1),N=v.useRef(null);v.useEffect(()=>{s&&m&&Q()},[s,n,m]);const Q=async()=>{var t;if(m)try{if(n==="QUICK"){const c=(t=(await u.workflows.getOrCreateByProject(m)).data)==null?void 0:t.id;if(c){z(c);const h=await u.workflows.getCollaborators(c);g(h.data||[])}}else{const r=await u.projects.getCollaborators(m);g(r.data||[])}}catch{}},F=async t=>{if(_(t),N.current&&clearTimeout(N.current),!t.startsWith("@")){y([]),M(!1);return}const r=t.slice(1).trim();N.current=setTimeout(async()=>{W(!0);try{const c=n==="QUICK"?await u.workflows.searchUsers(r||""):await u.projects.searchUsers(r||""),h=new Set(i.map(q=>q.id));let p=(c.data||[]).filter(q=>!h.has(q.id)).slice(0,5);const P=Y.getState().user;(P==null?void 0:P.role)==="ADMIN"&&n==="QUICK"&&!d&&(r===""||"所有人".includes(r))&&(p=[{id:"*",nickname:"所有人",avatar:null,isEveryone:!0},...p]),y(p),M(!0)}catch{}finally{W(!1)}},200)},J=async t=>{var r,c;if(m)try{if(n==="QUICK"){if(!$)return;if(await u.workflows.addCollaborator($,t.id,a),t.id==="*"||t.isEveryone){b(!0),_(""),y([]),M(!1),o.success("已公开共享给所有人");return}}else await u.projects.addCollaborator(m,t.id);g(h=>[...h,{id:t.id,nickname:t.nickname,avatar:t.avatar,permission:n==="QUICK"?a:"READ"}]),_(""),y([]),M(!1),o.success(`已添加协作者: ${t.nickname||t.username}`)}catch(h){o.error(((c=(r=h.response)==null?void 0:r.data)==null?void 0:c.message)||"添加失败")}},O=async(t,r)=>{var c,h;if(!(!$||n!=="QUICK"))try{await u.workflows.updatePermission($,t,r),g(p=>p.map(P=>P.id===t?{...P,permission:r}:P)),o.success("权限已更新")}catch(p){o.error(((h=(c=p.response)==null?void 0:c.data)==null?void 0:h.message)||"更新失败")}},l=async t=>{var r,c;if(m)try{if(n==="QUICK"){if(!$)return;await u.workflows.removeCollaborator($,t)}else await u.projects.removeCollaborator(m,t);g(h=>h.filter(p=>p.id!==t)),o.success("已移除协作者")}catch(h){o.error(((c=(r=h.response)==null?void 0:r.data)==null?void 0:c.message)||"移除失败")}},B=async t=>{var c,h;const r=(c=t.target.files)==null?void 0:c[0];if(r){if(!r.type.startsWith("image/")){o.error("请选择图片文件");return}if(r.size>10*1024*1024){o.error("图片大小不能超过 10MB");return}f(!0);try{const p=await u.assets.upload(r);p.success&&((h=p.data)!=null&&h.url)?(S(p.data.url),o.success("封面上传成功")):o.error("上传失败")}catch(p){o.error(p.message||"上传失败")}finally{f(!1)}}},T=()=>{S(null),A.current&&(A.current.value="")};return e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white/90 dark:bg-black/70 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl p-6 max-w-lg w-full shadow-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:s?"编辑项目":"创建新项目"}),e.jsx("button",{onClick:R,type:"button",className:"p-1.5 rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-base",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}),e.jsxs("form",{onSubmit:E,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目名称 *"}),e.jsx("input",{type:"text",required:!0,value:j.name,onChange:t=>w(r=>({...r,name:t.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none",style:{outline:"none",boxShadow:"none"},placeholder:"例如: 霸道总裁爱上我",maxLength:100})]}),e.jsxs("div",{className:s?"grid grid-cols-2 gap-4":"",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目封面"}),e.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:B,className:"hidden"}),I?e.jsxs("div",{className:`w-full ${s?"aspect-[16/9]":"h-44"} border-2 border-dashed border-neutral-400 dark:border-neutral-400/50 rounded-md flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5`,children:[e.jsx("span",{className:"material-symbols-outlined text-2xl text-neutral-500 animate-spin",children:"progress_activity"}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"正在上传..."})]}):C?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:C,alt:"封面预览",className:`w-full ${s?"aspect-[16/9]":"h-44"} object-cover rounded-md border-2 border-slate-200 dark:border-white/10`}),e.jsx("button",{type:"button",onClick:T,className:"absolute top-2 right-2 w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full transition-all opacity-0 group-hover:opacity-100 shadow-md",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"close"})})]}):e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=A.current)==null?void 0:t.click()},className:`w-full ${s?"aspect-[16/9]":"h-44"} border-2 border-dashed border-slate-300 dark:border-white/20 rounded-md hover:border-neutral-400 dark:hover:border-neutral-400/50 transition-colors flex flex-col items-center justify-center gap-2 bg-slate-100 dark:bg-white/5`,children:[e.jsx("span",{className:"material-symbols-outlined text-2xl text-slate-400 dark:text-white/50",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"add_photo_alternate"}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"点击上传封面图片"}),e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-500",children:"支持 JPG、PNG，最大 10MB"})]})]}),s&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目描述"}),e.jsx("textarea",{value:j.description,onChange:t=>w(r=>({...r,description:t.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none resize-none",style:{outline:"none",boxShadow:"none"},rows:3,placeholder:"简要描述项目内容...",maxLength:500})]})]}),s&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"协作者管理"}),e.jsxs("div",{className:"flex-1 border-2 border-slate-200 dark:border-white/10 rounded-md bg-slate-100 dark:bg-white/5 p-2 flex flex-col",children:[n==="QUICK"&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"新协作者权限:"}),e.jsxs("div",{className:"flex rounded overflow-hidden border border-slate-200 dark:border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>x("READ"),className:`px-2 py-0.5 text-xs ${a==="READ"?"bg-blue-500 text-white":"bg-white dark:bg-black/30 text-slate-600 dark:text-slate-400"}`,children:"只读"}),e.jsx("button",{type:"button",onClick:()=>x("EDIT"),className:`px-2 py-0.5 text-xs ${a==="EDIT"?"bg-green-500 text-white":"bg-white dark:bg-black/30 text-slate-600 dark:text-slate-400"}`,children:"编辑"})]})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx("input",{type:"text",value:L,onChange:t=>F(t.target.value),onFocus:()=>L&&M(!0),placeholder:"@用户昵称 添加协作者",className:"w-full px-3 py-1.5 bg-white dark:bg-black/30 border border-slate-200 dark:border-white/10 rounded text-sm text-slate-800 dark:text-white placeholder:text-slate-400 focus:outline-none focus:ring-1 focus:ring-neutral-500"}),U&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 material-symbols-outlined text-sm animate-spin text-slate-400",children:"progress_activity"}),V&&D.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-white/10 rounded-md shadow-lg max-h-32 overflow-y-auto",children:D.map(t=>e.jsxs("button",{type:"button",onClick:()=>J(t),className:`w-full px-3 py-2 flex items-center gap-2 hover:bg-slate-100 dark:hover:bg-white/10 text-left ${t.isEveryone?"bg-neutral-50 dark:bg-neutral-900/20":""}`,children:[t.isEveryone?e.jsx("span",{className:"material-symbols-outlined text-neutral-500 text-lg",children:"groups"}):t.avatar?e.jsx("img",{src:t.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"account_circle"}),e.jsxs("span",{className:`text-sm ${t.isEveryone?"text-neutral-600 dark:text-neutral-400 font-medium":"text-slate-800 dark:text-white"}`,children:[t.nickname||t.username,t.isEveryone&&e.jsx("span",{className:"text-xs ml-1 text-neutral-400",children:"（公开共享）"})]})]},t.id))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:i.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-400",children:"暂无协作者"}):e.jsx("div",{className:"space-y-1",children:i.map(t=>e.jsxs("div",{className:"flex items-center justify-between px-1.5 py-1 bg-white dark:bg-black/20 rounded",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:"",className:"w-4 h-4 rounded-full object-cover flex-shrink-0"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm flex-shrink-0",children:"account_circle"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300 truncate",children:t.nickname||"未命名"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[n==="QUICK"&&e.jsx("button",{type:"button",onClick:()=>O(t.id,t.permission==="EDIT"?"READ":"EDIT"),className:`px-1.5 py-0.5 text-[10px] rounded ${t.permission==="EDIT"?"bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-400":"bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400"} hover:opacity-80`,title:"点击切换权限",children:t.permission==="EDIT"?"编辑":"只读"}),e.jsx("button",{type:"button",onClick:()=>l(t.id),className:"p-0.5 text-red-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]})]},t.id))})})]})]})]}),!s&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目描述"}),e.jsx("textarea",{value:j.description,onChange:t=>w(r=>({...r,description:t.target.value})),className:"w-full px-3 py-2 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-md text-slate-800 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none resize-none",style:{outline:"none",boxShadow:"none"},rows:3,placeholder:"简要描述项目内容...",maxLength:500})]}),!s&&!K&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-2",children:"项目类型"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>w(t=>({...t,type:"DRAMA"})),className:`px-3 py-2 rounded-md border transition-all text-left ${j.type==="DRAMA"?"border-neutral-500 bg-neutral-500/10":"border-slate-200 dark:border-white/10 hover:border-neutral-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-800 dark:text-white",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"movie"}),e.jsx("span",{className:"font-medium text-slate-800 dark:text-white",children:"剧集创作"})]}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"适合长篇故事，多集连载"})]}),e.jsxs("button",{type:"button",onClick:()=>w(t=>({...t,type:"QUICK"})),className:`px-3 py-2 rounded-md border transition-all text-left ${j.type==="QUICK"?"border-neutral-500 bg-neutral-500/10":"border-slate-200 dark:border-white/10 hover:border-neutral-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-800 dark:text-white",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"bolt"}),e.jsx("span",{className:"font-medium text-slate-800 dark:text-white",children:"快速创作"})]}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"快速创作单个作品"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:R,className:"flex-1 px-3 py-2 bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white rounded-md hover:bg-slate-200 dark:hover:bg-white/10 transition-all border border-slate-200 dark:border-white/10",children:"取消"}),e.jsx("button",{type:"submit",className:"flex-1 px-3 py-2 bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg text-white rounded-md transition-all font-medium active:scale-95",children:s?"保存更改":"创建项目"})]})]})]})})},le=()=>{const s=X(),[E,R]=k.useState([]),[j,w]=k.useState(!0),[C,S]=k.useState(!1),[K,m]=k.useState(!1),[n,A]=k.useState(null),[I,f]=k.useState(null),i=window.location.pathname.startsWith("/quick")?"QUICK":window.location.pathname.startsWith("/drama")?"DRAMA":"ALL",g=window.location.pathname.startsWith("/quick"),[L,_]=k.useState(""),[D,y]=k.useState({name:"",description:"",type:"DRAMA"});k.useEffect(()=>{U()},[i]);const U=async()=>{try{w(!0);const a=i==="ALL"?{fields:"minimal"}:{type:i,fields:"minimal"};let d=(await u.get("/projects",{params:a})).data.map(b=>({...b,isOwner:!0}));if(i==="QUICK"||i==="ALL")try{const N=(await u.workflows.getAll({includeShared:"true"})).data||[],Q=N.filter(l=>l.isOwner&&l.projectId),F=new Map;Q.forEach(l=>{l.projectId&&l.hasCollaborators&&F.set(l.projectId,!0)}),d=d.map(l=>({...l,hasCollaborators:l.type==="QUICK"?F.get(l.id)||!1:l.hasCollaborators||!1}));const O=N.filter(l=>l.isShared).map(l=>{var B,T;return{id:l.projectId||`workflow-${l.id}`,name:((B=l.project)==null?void 0:B.name)||l.name,description:l.description,thumbnail:((T=l.project)==null?void 0:T.thumbnail)||null,type:"QUICK",status:"DRAFT",createdAt:l.createdAt,updatedAt:l.updatedAt,_count:{episodes:0,workflows:1,assets:0},workflowId:l.id,isOwner:!1,isShared:!0,hasCollaborators:!1,shareInfo:l.shareInfo}});d=[...d,...O]}catch{}if(i==="DRAMA"||i==="ALL")try{const N=((await u.projects.getShared(i==="DRAMA"?{type:"DRAMA"}:{})).data||[]).filter(Q=>Q.type==="DRAMA").map(Q=>({...Q,isOwner:!1,isShared:!0,hasCollaborators:!1}));d=[...d,...N]}catch{}R(d)}catch(a){a.response&&a.response.status!==404&&o.error("加载项目列表失败"),R([])}finally{w(!1)}},W=async a=>{var x,d;if(a.preventDefault(),!D.name.trim()){o.error("请输入项目名称");return}try{const b={...D,type:g?"QUICK":"DRAMA",thumbnail:I||void 0},N=await u.projects.create(b);o.success("项目创建成功！"),S(!1),y({name:"",description:"",type:"DRAMA"}),f(null),U(),s(g?`/projects/${N.data.id}/workflow`:`/projects/${N.data.id}/episodes`)}catch(b){o.error(((d=(x=b.response)==null?void 0:x.data)==null?void 0:d.message)||"创建失败")}},V=async a=>{var x,d;if(a.preventDefault(),!!n)try{const b={...D,thumbnail:I||void 0};await u.projects.update(n.id,b),o.success("项目更新成功！"),m(!1),A(null),y({name:"",description:"",type:"DRAMA"}),f(null),U()}catch(b){o.error(((d=(x=b.response)==null?void 0:x.data)==null?void 0:d.message)||"更新失败")}},M=async a=>{if(confirm("确定要删除这个项目吗？所有相关数据都会被删除！"))try{await u.projects.delete(a),o.success("项目删除成功"),U()}catch{o.error("删除失败")}},$=a=>{A(a),y({name:a.name,description:a.description||"",type:a.type}),f(a.thumbnail||null),m(!0)},z=E.filter(a=>{var x;if(i!=="ALL"&&a.type!==i)return!1;if(L){const d=L.toLowerCase();return a.name.toLowerCase().includes(d)||((x=a.description)==null?void 0:x.toLowerCase().includes(d))}return!0});return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-8 mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-text-light-primary dark:text-text-dark-primary whitespace-nowrap",children:i==="DRAMA"?"剧集创作":"快速创作"}),e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-text-light-tertiary dark:text-text-dark-tertiary",children:"search"}),e.jsx("input",{type:"text",placeholder:"搜索项目...",value:L,onChange:a=>_(a.target.value),className:"pl-12 pr-4 py-2.5 w-full bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-full text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary outline-none transition-all",style:{outline:"none",boxShadow:"none"}})]})]}),e.jsx("div",{className:"fixed left-[24px] bottom-8 z-50",children:e.jsxs("div",{className:"group relative",children:[e.jsx("button",{onClick:()=>S(!0),className:"w-10 h-10 rounded-xl bg-white dark:bg-[#18181b] text-neutral-600 dark:text-neutral-400 border border-neutral-200 dark:border-neutral-700 hover:bg-black dark:hover:bg-white hover:text-white dark:hover:text-black hover:border-transparent transition-all flex items-center justify-center shadow-[0_8px_30px_rgba(0,0,0,0.12)] dark:shadow-[0_8px_30px_rgba(0,0,0,0.5)]",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",style:{fontVariationSettings:'"FILL" 0, "wght" 500'},children:"add"})}),e.jsx("span",{className:"absolute left-full top-1/2 -translate-y-1/2 ml-2 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50",children:"创建新项目"})]})}),j?e.jsx("div",{className:"text-center py-12 text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."}):E.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-tiffany-50 dark:bg-tiffany-500/10 flex items-center justify-center mb-6 shadow-tiffany",children:e.jsx("span",{className:"material-symbols-outlined text-tiffany-600 dark:text-tiffany-400 text-5xl",children:"folder_open"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"还没有项目"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:"创建你的第一个AI短剧项目"}),e.jsx("button",{onClick:()=>S(!0),className:"px-6 py-3 bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg text-white font-medium rounded-lg transition-all shadow-md active:scale-95",children:"立即创建"})]}):z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gray-50 dark:bg-gray-500/10 flex items-center justify-center mb-6",children:e.jsx("span",{className:"material-symbols-outlined text-gray-400 dark:text-gray-500 text-5xl",children:"search_off"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"没有找到项目"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:L?"尝试使用其他关键词搜索":"此分类暂无项目"}),L&&e.jsx("button",{onClick:()=>_(""),className:"px-6 py-3 bg-card-light dark:bg-card-dark text-text-light-primary dark:text-text-dark-primary font-medium rounded-lg hover:bg-card-light-hover dark:hover:bg-card-dark-hover transition-all border border-border-light dark:border-border-dark",children:"清除搜索"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:z.map(a=>e.jsxs("div",{onClick:()=>{a.type==="QUICK"?a.isShared&&a.workflowId?s(`/workflow/${a.workflowId}`):s(`/projects/${a.id}/workflow`):s(`/projects/${a.id}/episodes`)},className:"relative border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden hover:border-neutral-400 dark:hover:border-neutral-600 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer aspect-[4/3]",children:[e.jsx("div",{className:"absolute inset-0",children:e.jsx(Z,{thumbnail:a.thumbnail,name:a.name})}),a.isOwner!==!1&&e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),$(a)},className:"w-7 h-7 flex items-center justify-center bg-black/60 dark:bg-white/80 hover:bg-black dark:hover:bg-white text-white dark:text-black rounded-full transition-all backdrop-blur-sm shadow-md active:scale-95",title:"编辑项目",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),M(a.id)},className:"w-7 h-7 flex items-center justify-center bg-black/60 dark:bg-white/80 hover:bg-black dark:hover:bg-white text-white dark:text-black rounded-full transition-all backdrop-blur-sm shadow-md active:scale-95",title:"删除项目",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete"})})]}),a.isShared&&e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 rounded-lg text-xs font-medium text-white bg-black/50 dark:bg-white/20 backdrop-blur-sm flex items-center gap-1 z-10",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"group"}),"共享"]}),a.hasCollaborators&&!a.isShared&&e.jsxs("div",{className:"absolute top-2 right-2 px-2 py-1 rounded-lg text-xs font-medium text-white bg-black/50 dark:bg-white/20 backdrop-blur-sm flex items-center gap-1 z-10",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"share"}),"已共享"]}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 p-3 bg-white/50 dark:bg-black/50 backdrop-blur-md rounded-xl z-10",children:[e.jsx("h3",{className:"font-semibold text-sm text-neutral-900 dark:text-white truncate",children:a.name}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-0.5 truncate",children:a.description||"暂无描述"})]})]},a.id))}),C&&e.jsx(H,{isEdit:!1,onSubmit:W,formData:D,setFormData:y,thumbnail:I,setThumbnail:f,hideType:!0,onClose:()=>{S(!1),y({name:"",description:"",type:"DRAMA"}),f(null)}}),K&&n&&e.jsx(H,{isEdit:!0,onSubmit:V,formData:D,setFormData:y,thumbnail:I,setThumbnail:f,projectId:n.id,projectType:n.type,onClose:()=>{m(!1),A(null),y({name:"",description:"",type:"DRAMA"}),f(null),U()}})]})},Z=({thumbnail:s,name:E})=>{const[R,j]=k.useState([]),[w,C]=k.useState(0),[S,K]=k.useState(!1);k.useEffect(()=>{if(K(!1),!s){j([]),C(0);return}if(s.startsWith("http")||s.startsWith("data:")){j([s]),C(0);return}const n=s.startsWith("/")?s:`/${s}`,I="https://api.waule.ai".replace(/\/$/,"").replace(/\/api$/,""),f=G.defaults.baseURL&&G.defaults.baseURL.startsWith("http")?G.defaults.baseURL.replace(/\/$/,"").replace(/\/api$/,""):"",i=window.location.origin.replace(/\/$/,""),g=[];i&&g.push(`${i}${n}`),I&&g.push(`${I}${n}`),f&&g.push(`${f}${n}`),j(g),C(0)},[s]);const m=R[w]||null;return!s||S||!m?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-900",children:e.jsx("span",{className:"material-symbols-outlined text-3xl text-neutral-400 dark:text-neutral-600",children:"movie"})}):e.jsx("img",{src:m,alt:E,className:"w-full h-full object-cover",onError:()=>{w+1<R.length?C(w+1):K(!0)}})};export{le as default};
