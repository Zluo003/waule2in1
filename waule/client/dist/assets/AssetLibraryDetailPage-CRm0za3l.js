import{e as $e,d as De,r,j as e}from"./react-vendor-BvY2dB7B.js";import{b as g,c as d}from"./index-DRJ_08Rm.js";import"./reactflow-D8v6_Qvs.js";import"./utils-BcyDR7Vi.js";const ze=({value:m,onChange:D,options:l})=>{const[y,O]=r.useState(!1),v=r.useRef(null),[N,R]=r.useState(!1);r.useEffect(()=>{const b=()=>{R(document.documentElement.classList.contains("dark"))};b();const w=new MutationObserver(b);return w.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>w.disconnect()},[]),r.useEffect(()=>{const b=w=>{v.current&&!v.current.contains(w.target)&&O(!1)};return y&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[y]);const S=l.find(b=>b.value===m);return e.jsxs("div",{ref:v,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>O(!y),className:"absolute right-0 top-0 bottom-0 px-4 bg-neutral-800 dark:bg-white text-white dark:text-black rounded-r-full text-xs cursor-pointer flex items-center gap-1 min-w-[100px] justify-center",style:{outline:"none !important",boxShadow:"none !important",border:"none",color:N?"white":"black"},children:[e.jsx("span",{className:"whitespace-nowrap",style:{color:N?"white":"black"},children:S==null?void 0:S.label}),e.jsx("span",{className:"material-symbols-outlined text-xs",style:{fontVariationSettings:'"FILL" 0, "wght" 200',color:N?"white":"black"},children:y?"expand_less":"expand_more"})]}),y&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-32 rounded-lg shadow-lg border border-slate-200 dark:border-white/10 py-1 z-50",style:{backgroundColor:N?"#0f0f10":"#f3f5f5"},children:l.map(b=>e.jsx("button",{type:"button",onClick:()=>{D(b.value),O(!1)},className:`w-full px-3 py-2 text-left text-xs transition-colors ${m===b.value?"bg-slate-200 dark:bg-white/10 text-slate-900 dark:text-white font-medium":"text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-white/10"}`,children:b.label},b.value))})]})},oe="https://api.waule.com",Te=()=>{var ge,fe,pe,we,ke,je;const{id:m}=$e(),D=De(),[l,y]=r.useState(null),[O,v]=r.useState([]),[N,R]=r.useState([]),[S,b]=r.useState(!0),[w,ye]=r.useState(""),[X,ve]=r.useState("ALL"),[Ne,F]=r.useState(!1),[I,Y]=r.useState({name:"",faceAssetId:"",frontAssetId:"",sideAssetId:"",backAssetId:"",voiceAssetId:"",documentAssetId:""}),[z,M]=r.useState(null),[B,V]=r.useState(null),[_,T]=r.useState(null),[x,k]=r.useState(null),[h,G]=r.useState(null),[Z,P]=r.useState(""),[de,ee]=r.useState([]),[ce,U]=r.useState(!1),[L,W]=r.useState(null),[te,ue]=r.useState([]),[E,xe]=r.useState({name:""}),[q,se]=r.useState(null),[H,ae]=r.useState(null),[J,le]=r.useState(null),[p,K]=r.useState({}),[re,me]=r.useState(!1),Q=r.useRef(null),Ie=()=>{switch(l==null?void 0:l.category){case"AUDIO":return"audio/mpeg,audio/wav,audio/ogg,audio/mp4,audio/x-m4a,.mp3,.wav,.ogg,.m4a";case"SCENE":case"PROP":return"image/jpeg,image/png,image/gif,image/webp,.jpg,.jpeg,.png,.gif,.webp";case"OTHER":default:return"image/*,video/*,audio/*,.pdf,.txt,.doc,.docx"}},Le=t=>{const s=t.type.startsWith("video/"),a=t.type.includes("pdf")||t.type.includes("text")||t.type.includes("document")||t.name.endsWith(".doc")||t.name.endsWith(".docx")||t.name.endsWith(".txt");if((l==null?void 0:l.category)==="OTHER"){if(s)return 20;if(a)return 10}return 10},Ee=t=>{const s=Le(t),a=s*1024*1024;if(t.size>a)return`文件大小超过限制（最大${s}MB）`;const i=l==null?void 0:l.category,c=t.type,n=t.name.toLowerCase();if(i==="AUDIO"){if(!c.startsWith("audio/")&&!n.match(/\.(mp3|wav|ogg|m4a)$/))return"音频库只支持上传音频文件（MP3、WAV、OGG、M4A）"}else if((i==="SCENE"||i==="PROP")&&!c.startsWith("image/")&&!n.match(/\.(jpg|jpeg|png|gif|webp)$/))return`${i==="SCENE"?"场景库":"道具库"}只支持上传图片文件（JPG、PNG、GIF、WEBP）`;return null},Ae=async t=>{if(!t||t.length===0||!m)return;me(!0);let s=0,a=0;try{for(const i of Array.from(t)){const c=Ee(i);if(c){d.error(`${i.name}: ${c}`),a++;continue}try{await g.assetLibraries.uploadAsset(m,i),s++}catch{d.error(`上传失败: ${i.name}`),a++}}s>0&&(d.success(`成功上传 ${s} 个文件`),j()),a>0&&s===0&&d.error(`上传失败 ${a} 个文件`)}finally{me(!1),Q.current&&(Q.current.value="")}};r.useEffect(()=>{m&&ie()},[m]),r.useEffect(()=>{l&&m&&j()},[l==null?void 0:l.id,l==null?void 0:l.category]),r.useEffect(()=>{const t=s=>{var a;((a=s.detail)==null?void 0:a.libraryId)===m&&(j(),ie())};return window.addEventListener("asset-library-updated",t),()=>window.removeEventListener("asset-library-updated",t)},[m,l==null?void 0:l.category]),r.useEffect(()=>{const t=s=>{s.key==="Escape"&&x&&k(null)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[x]);const f=t=>t?(/^https?:\/\//.test(t)?t:`${oe}${t}`).replace(".oss-oss-",".oss-"):"";r.useEffect(()=>{const t=async()=>{var s,a,i,c;try{U(!0),ee([]);const n=x==null?void 0:x.metadata;if(!n||n.kind!=="ROLE"){U(!1);return}const u=[(s=n.images)==null?void 0:s.faceAssetId,(a=n.images)==null?void 0:a.frontAssetId,(i=n.images)==null?void 0:i.sideAssetId,(c=n.images)==null?void 0:c.backAssetId].filter(Boolean);if(u.length===0){U(!1);return}const A=(await Promise.all(u.map(C=>g.assets.getById(C).catch(()=>null)))).map(C=>C==null?void 0:C.data).filter(Boolean);ee(A)}finally{U(!1)}};x&&(l==null?void 0:l.category)==="ROLE"?t():(ee([]),U(!1))},[x,l==null?void 0:l.category]),r.useEffect(()=>{const t=async()=>{var s,a,i,c,n,u;try{if(ue([]),!L)return;const o=L.metadata,A=[(s=o==null?void 0:o.images)==null?void 0:s.frontAssetId,(a=o==null?void 0:o.images)==null?void 0:a.sideAssetId,(i=o==null?void 0:o.images)==null?void 0:i.backAssetId].filter(Boolean);K({front:((c=o==null?void 0:o.images)==null?void 0:c.frontAssetId)||null,side:((n=o==null?void 0:o.images)==null?void 0:n.sideAssetId)||null,back:((u=o==null?void 0:o.images)==null?void 0:u.backAssetId)||null});const Ue=(await Promise.all(A.map($=>g.assets.getById($).catch(()=>null)))).map($=>$==null?void 0:$.data).filter(Boolean);ue(Ue)}finally{}};L&&(xe({name:L.name||""}),se(null),ae(null),le(null),t())},[L]);const ie=async()=>{try{const t=await g.assetLibraries.getById(m);y(t.data)}catch{d.error("加载资产库失败"),D("/assets")}},j=async()=>{try{if(b(!0),(l==null?void 0:l.category)==="ROLE"){const t=await g.assetLibraries.roles.list(m);R(t.data||[]),v([])}else{const t=await g.assetLibraries.getAssets(m);v(t.data),R([])}}catch{d.error("加载资产列表失败"),v([]),R([])}finally{b(!1)}},Ce=async t=>{if(confirm("确定要删除这个资产吗？"))try{await g.assets.delete(t);try{const s=new CustomEvent("asset-library-updated",{detail:{libraryId:m}});window.dispatchEvent(s)}catch{}d.success("资产删除成功"),ie(),j()}catch{d.error("删除失败")}},Oe=async t=>{if(confirm("确定要删除这个角色吗？"))try{await g.assetLibraries.roles.delete(m,t);try{const s=new CustomEvent("asset-library-updated",{detail:{libraryId:m}});window.dispatchEvent(s)}catch{}d.success("角色删除成功"),j()}catch{d.error("删除失败")}},Re=t=>{G(t),P(t.name)},Se=async t=>{var s,a;if(t.preventDefault(),!!h){if(!Z.trim()){d.error("请输入资产名称");return}try{await g.assets.update(h.id,{name:Z.trim()}),d.success("资产更新成功！"),G(null),P(""),j()}catch(i){d.error(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.message)||"更新失败")}}},ne=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(2)+" KB":(t/(1024*1024)).toFixed(2)+" MB",Fe=async t=>{try{const s=o=>{const A=o.match(/\.[^.]+$/);return A?A[0]:""};let a=t.name;if(!a.includes(".")){const o=s(t.originalName||t.url);a=a+o}d.info("正在准备下载...");const i=await g.get(`/assets/download/${t.id}`,{responseType:"blob",params:{filename:a}}),c=i instanceof Blob?i:i==null?void 0:i.data;if(!c||!(c instanceof Blob)){d.error("下载失败：无效的响应数据");return}if(c.size===0||c.size<100){d.error("下载失败：文件大小异常");return}const n=window.URL.createObjectURL(c),u=document.createElement("a");u.style.display="none",u.href=n,u.download=a,document.body.appendChild(u),u.click(),document.body.removeChild(u),setTimeout(()=>{window.URL.revokeObjectURL(n)},100),d.success(`已下载：${a}`)}catch{d.error("下载失败，请稍后重试")}},he=t=>{switch(t){case"IMAGE":return"image";case"VIDEO":return"video_file";case"AUDIO":return"audio_file";default:return"description"}},be=(t,s)=>{const a=t.querySelector("video");a&&(s?(a.currentTime=0,a.play().catch(()=>{})):(a.pause(),a.currentTime=0))},Pe=O.filter(t=>{if(X!=="ALL"&&t.type!==X)return!1;if(w){const s=w.toLowerCase();return t.name.toLowerCase().includes(s)}return!0});return l?e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-8 mb-12",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>D("/assets"),className:"group w-10 h-10 flex items-center justify-center hover:bg-slate-800 dark:hover:bg-white rounded-lg transition-all",children:e.jsx("span",{className:"material-symbols-outlined text-slate-800 dark:text-white group-hover:text-white dark:group-hover:text-black",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"arrow_back"})}),e.jsx("h1",{className:"text-xl font-bold text-text-light-primary dark:text-text-dark-primary whitespace-nowrap",children:l.name})]}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md flex items-center",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 text-text-light-tertiary dark:text-text-dark-tertiary",children:"search"}),e.jsx("input",{type:"text",placeholder:"搜索资产...",value:w,onChange:t=>ye(t.target.value),className:"pl-12 pr-28 py-2.5 w-full bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-full text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary outline-none transition-all",style:{outline:"none",boxShadow:"none"}}),e.jsx(ze,{value:X,onChange:t=>ve(t),options:[{value:"ALL",label:"全部"},{value:"IMAGE",label:"图片"},{value:"VIDEO",label:"视频"},{value:"AUDIO",label:"音频"}]})]})}),l.isShared&&e.jsxs("div",{className:"px-4 py-2 bg-blue-500/10 border border-blue-500/30 rounded-lg flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-500 text-lg",children:"group"}),e.jsxs("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:["来自 ",((fe=(ge=l.shareInfo)==null?void 0:ge.owner)==null?void 0:fe.nickname)||"未知用户"," 的共享"]})]})]}),l.isOwner!==!1&&e.jsxs("div",{className:"fixed left-[24px] bottom-8 z-50",children:[e.jsx("input",{ref:Q,type:"file",accept:Ie(),multiple:!0,className:"hidden",onChange:t=>Ae(t.target.files)}),e.jsxs("div",{className:"group relative",children:[e.jsx("button",{onClick:()=>{var t;l.category==="ROLE"?(Y({name:"",faceAssetId:"",frontAssetId:"",sideAssetId:"",backAssetId:"",voiceAssetId:"",documentAssetId:""}),M(null),V(null),T(null),F(!0)):(t=Q.current)==null||t.click()},disabled:re,className:"w-10 h-10 rounded-xl bg-white dark:bg-[#18181b] text-neutral-600 dark:text-neutral-400 border border-neutral-200 dark:border-neutral-700 hover:bg-black dark:hover:bg-white hover:text-white dark:hover:text-black hover:border-transparent transition-all flex items-center justify-center shadow-[0_8px_30px_rgba(0,0,0,0.12)] dark:shadow-[0_8px_30px_rgba(0,0,0,0.5)] disabled:opacity-50",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",style:{fontVariationSettings:'"FILL" 0, "wght" 500'},children:re?"progress_activity":l.category==="ROLE"?"person_add":"add"})}),e.jsx("span",{className:"absolute left-full top-1/2 -translate-y-1/2 ml-2 px-2 py-1 text-xs text-white bg-slate-800 dark:bg-slate-700 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50",children:re?"上传中...":l.category==="ROLE"?"创建角色":"上传资产"})]})]}),S?e.jsx("div",{className:"text-center py-12 text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."}):l.category==="ROLE"?N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-neutral-500/10 flex items-center justify-center mb-6 shadow-neutral-400/30",children:e.jsx("span",{className:"material-symbols-outlined text-neutral-400 text-5xl",children:"person"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"还没有角色"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:"创建你的第一个角色"}),e.jsx("button",{onClick:()=>{Y({name:"",faceAssetId:"",frontAssetId:"",sideAssetId:"",backAssetId:"",voiceAssetId:"",documentAssetId:""}),M(null),V(null),T(null),F(!0)},className:"px-6 py-3 bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg font-medium rounded-lg transition-all active:scale-95",children:"创建角色"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:N.map(t=>{const s=t.thumbnail||"";return e.jsxs("div",{onClick:()=>k(t),className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden hover:border-neutral-400 dark:hover:border-neutral-400/50 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer relative",children:[e.jsxs("div",{className:"aspect-[4/3] bg-slate-100 dark:bg-white/5 relative overflow-hidden",children:[s?e.jsx("img",{src:f(s),alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-tiffany-300 dark:text-white/30",children:"person"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/0 to-black/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),k(t)},className:"w-7 h-7 flex items-center justify-center bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg rounded-full transition-all shadow-md active:scale-95",title:"预览",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"visibility"})}),(l==null?void 0:l.isOwner)!==!1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),W(t)},className:"w-7 h-7 flex items-center justify-center bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg rounded-full transition-all shadow-md active:scale-95",title:"编辑",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),Oe(t.id)},className:"w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"删除",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete"})})]})]})]}),e.jsx("div",{className:"p-2",children:e.jsx("h3",{className:"text-xs font-bold text-text-light-primary dark:text-text-dark-primary truncate",children:t.name})})]},t.id)})}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Pe.map(t=>{var s;return e.jsxs("div",{onClick:()=>k(t),onMouseEnter:a=>be(a.currentTarget,!0),onMouseLeave:a=>be(a.currentTarget,!1),className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden hover:border-neutral-400 dark:hover:border-neutral-400/50 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer",children:[e.jsxs("div",{className:"aspect-[4/3] bg-slate-100 dark:bg-white/5 relative overflow-hidden",children:[t.type==="IMAGE"?e.jsx("img",{src:f(t.url),alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.03]",onError:a=>{a.currentTarget.style.display="none"}}):t.type==="VIDEO"?e.jsx("video",{src:f(t.url),className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.02]",preload:"metadata",muted:!0,loop:!0,onError:()=>{}}):t.type==="AUDIO"?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl text-tiffany-300 dark:text-white/30 mb-3",children:"audio_file"}),e.jsx("audio",{src:f(t.url),controls:!0,className:"w-full max-w-[90%]",onError:()=>{}})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-tiffany-300 dark:text-white/30",children:he(t.type)})}),e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[(l==null?void 0:l.isOwner)!==!1&&e.jsx("button",{onClick:a=>{a.stopPropagation(),Re(t)},className:"w-7 h-7 flex items-center justify-center bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg rounded-full transition-all shadow-md active:scale-95",title:"编辑",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})}),((l==null?void 0:l.isOwner)!==!1||((s=l==null?void 0:l.shareInfo)==null?void 0:s.canDownload))&&e.jsx("button",{onClick:a=>{a.stopPropagation(),Fe(t)},className:"w-7 h-7 flex items-center justify-center bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg rounded-full transition-all shadow-md active:scale-95",title:"下载",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"download"})}),(l==null?void 0:l.isOwner)!==!1&&e.jsx("button",{onClick:a=>{a.stopPropagation(),Ce(t.id)},className:"w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"删除",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete"})})]}),e.jsx("div",{className:"absolute bottom-2 right-2 px-2 py-0.5 bg-black/60 backdrop-blur-sm text-white text-xs rounded",children:ne(t.size)})]}),e.jsx("div",{className:"p-2",children:e.jsx("h3",{className:"text-xs font-bold text-text-light-primary dark:text-text-dark-primary truncate",children:t.name})})]},t.id)})}),Ne&&(l==null?void 0:l.category)==="ROLE"&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl px-6 py-5 w-full max-w-xl md:max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"创建角色"}),e.jsx("button",{onClick:()=>F(!1),className:"p-2 nodrag hover:bg-slate-200 dark:hover:bg-white/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-slate-600 dark:text-slate-400",children:"close"})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"① 上传图片 → ② 填写名称"}),e.jsx("div",{className:"mt-2 text-xs text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 px-3 py-2 rounded",children:"请上传1-3张角色图片（支持 JPG/PNG），图片比例建议为3:4竖向"})]}),e.jsxs("div",{className:"grid grid-cols-[1fr,1px,200px] grid-rows-[auto,auto] gap-6 items-start mb-4",children:[e.jsxs("div",{className:"row-span-2 rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"424px"},children:[z?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(z),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>M(null),className:"absolute top-2 right-2 p-2 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-4xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return M(((s=t.target.files)==null?void 0:s[0])||null)}}),"+"]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/0 to-black/10 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]}),e.jsx("div",{className:"w-px h-full bg-slate-200 dark:bg-white/10"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden",style:{height:"200px"},children:B?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(B),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>V(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return V(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})}),e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden",style:{height:"200px"},children:_?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(_),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>T(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return T(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 dark:text-slate-300",children:"角色名称"}),e.jsx("input",{value:I.name,onChange:t=>Y({...I,name:t.target.value}),className:"w-full px-3 py-2 rounded-lg bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark text-text-light-primary dark:text-text-dark-primary",maxLength:30})]})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>F(!1),className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white border border-slate-200 dark:border-white/10 hover:bg-slate-200 dark:hover:bg-white/10 transition-all",children:"取消"}),e.jsx("button",{onClick:async()=>{var t,s;try{if(!I.name.trim()){d.error("请输入角色名称");return}if(!z&&!B&&!_){d.error("请至少上传一张图片");return}const a={},i=async(n,u)=>n?(await g.assetLibraries.uploadAsset(m,n,u)).data.id:null;a.frontAssetId=await i(z,`${I.name}-主图`),a.sideAssetId=await i(B,`${I.name}-参考1`),a.backAssetId=await i(_,`${I.name}-参考2`);const c={name:I.name.trim()};Object.entries(a).forEach(([n,u])=>{u&&(c[n]=u)}),await g.assetLibraries.roles.create(m,c),d.success("角色创建成功"),F(!1),j()}catch(a){d.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"创建角色失败")}},className:"px-6 py-2 rounded-lg bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg transition-all active:scale-95",children:"创建"})]})]})}),x&&l.category==="ROLE"&&((pe=x.metadata)==null?void 0:pe.kind)==="ROLE"?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-6",onClick:()=>k(null),children:e.jsxs("div",{className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl p-6 w-full max-w-3xl shadow-xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:x.name}),e.jsx("button",{onClick:()=>k(null),className:"p-2 nodrag hover:bg-slate-200 dark:hover:bg-white/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-slate-600 dark:text-slate-400",children:"close"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[ce&&e.jsx("div",{className:"col-span-3 text-center text-slate-600 dark:text-slate-400",children:"加载中..."}),!ce&&de.length===0&&e.jsx("div",{className:"col-span-3 text-center text-slate-600 dark:text-slate-400",children:"无可预览图片"}),de.map((t,s)=>e.jsx("div",{className:"aspect-square bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl overflow-hidden flex items-center justify-center",children:e.jsx("img",{src:f(t.url),alt:t.name,className:"w-full h-full object-cover",onError:a=>{a.currentTarget.style.display="none"}})},s))]})]})}):x&&e.jsx("div",{className:"fixed inset-0 bg-white/70 dark:bg-black/80 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:()=>k(null),children:e.jsxs("div",{className:"relative max-w-[95vw] h-[65vh] flex flex-col",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>k(null),className:"absolute -top-14 right-0 w-12 h-12 flex items-center justify-center bg-slate-200/80 dark:bg-white/10 hover:bg-slate-300 dark:hover:bg-white/20 text-slate-800 dark:text-white rounded-full transition-colors z-10",title:"关闭 (ESC)",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"close"})}),e.jsxs("div",{className:"absolute -top-14 left-0 text-slate-800 dark:text-white flex items-center gap-3",children:[e.jsx("h3",{className:"font-bold text-xl",children:x.name}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-white/60",children:ne(x.size)})]}),x.type==="IMAGE"?e.jsx("img",{src:f(x.url),alt:x.name,className:"max-w-full h-full object-contain",onError:()=>{}}):x.type==="VIDEO"?e.jsx("video",{src:f(x.url),controls:!0,autoPlay:!0,className:"max-w-full h-full object-contain",onError:()=>{}}):x.type==="AUDIO"?e.jsxs("div",{className:"bg-gradient-to-br from-tiffany-500/20 to-coral-500/20 backdrop-blur-md rounded-2xl p-16 flex flex-col items-center justify-center min-w-[500px]",children:[e.jsx("span",{className:"material-symbols-outlined text-9xl text-white mb-8",children:"audio_file"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-6 text-center max-w-md",children:x.name}),e.jsx("audio",{src:f(x.url),controls:!0,autoPlay:!0,className:"w-full max-w-lg",onError:()=>{}})]}):e.jsxs("div",{className:"bg-white/5 backdrop-blur-md rounded-2xl p-16 flex flex-col items-center justify-center min-w-[400px]",children:[e.jsx("span",{className:"material-symbols-outlined text-9xl text-white/50 mb-6",children:"description"}),e.jsx("p",{className:"text-white/70 text-lg",children:"无法预览此文件类型"})]})]})}),L&&(l==null?void 0:l.category)==="ROLE"&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl px-6 py-5 w-full max-w-xl md:max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"编辑角色"}),e.jsx("button",{onClick:()=>W(null),className:"p-2 nodrag hover:bg-slate-200 dark:hover:bg-white/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-slate-600 dark:text-slate-400",children:"close"})})]}),e.jsxs("div",{className:"grid grid-cols-[1fr,1px,200px] grid-rows-[auto,auto] gap-6 items-start mb-4",children:[e.jsx("div",{className:"row-span-2 rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"424px"},children:q?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(q),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>se(null),className:"absolute top-2 right-2 p-2 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):p.front?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:f(((we=te[0])==null?void 0:we.url)||""),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>K({...p,front:null}),className:"absolute top-2 right-2 p-2 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-4xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return se(((s=t.target.files)==null?void 0:s[0])||null)}}),"+"]})}),e.jsx("div",{className:"w-px h-full bg-slate-200 dark:bg-white/10"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"200px"},children:H?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(H),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>ae(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):p.side?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:f(((ke=te[1])==null?void 0:ke.url)||""),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>K({...p,side:null}),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return ae(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})}),e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"200px"},children:J?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(J),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>le(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):p.back?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:f(((je=te[2])==null?void 0:je.url)||""),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>K({...p,back:null}),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return le(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 dark:text-slate-300",children:"角色名称"}),e.jsx("input",{value:E.name,onChange:t=>xe({...E,name:t.target.value}),className:"w-full px-3 py-2 rounded-lg bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark text-text-light-primary dark:text-text-dark-primary",maxLength:30})]})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>W(null),className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white border border-slate-200 dark:border-white/10 hover:bg-slate-200 dark:hover:bg-white/10 transition-all",children:"取消"}),e.jsx("button",{onClick:async()=>{var t,s;try{if(!E.name.trim()){d.error("请输入角色名称");return}const a={},i=async(n,u)=>n?(await g.assetLibraries.uploadAsset(m,n,u)).data.id:null;a.frontAssetId=q?await i(q,`${E.name}-主图`):p.front,a.sideAssetId=H?await i(H,`${E.name}-参考1`):p.side,a.backAssetId=J?await i(J,`${E.name}-参考2`):p.back;const c={name:E.name.trim()};Object.entries(a).forEach(([n,u])=>{c[n]=u===void 0?void 0:u}),await g.assetLibraries.roles.update(m,L.id,c),d.success("角色更新成功"),W(null),j()}catch(a){d.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"更新角色失败")}},className:"px-6 py-2 rounded-lg bg-neutral-800 dark:bg-white text-white dark:text-black hover:shadow-lg transition-all active:scale-95",children:"保存"})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-2xl p-6 max-w-2xl w-full shadow-soft-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary",children:"编辑资产"}),e.jsx("button",{onClick:()=>{G(null),P("")},type:"button",className:"p-2 hover:bg-background-light-secondary dark:hover:bg-card-dark-hover rounded-lg transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"close"})})]}),e.jsxs("form",{onSubmit:Se,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-background-light dark:bg-background-dark rounded-lg border border-border-light dark:border-border-dark",children:[e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden bg-gradient-to-br from-tiffany-100 to-tiffany-200 dark:from-tiffany-500/20 dark:to-coral-500/20 flex items-center justify-center flex-shrink-0",children:h.type==="IMAGE"?e.jsx("img",{src:h.url.startsWith("http")?h.url:`${oe}${h.url}`,alt:h.name,className:"w-full h-full object-cover"}):h.type==="VIDEO"?e.jsx("video",{src:h.url.startsWith("http")?h.url:`${oe}${h.url}`,className:"w-full h-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-3xl text-tiffany-300 dark:text-white/30",children:he(h.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-1",children:["原始文件名: ",h.originalName]}),e.jsxs("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["大小: ",ne(h.size)," · 类型: ",h.type]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-2",children:"显示名称 *"}),e.jsx("input",{type:"text",required:!0,value:Z,onChange:t=>P(t.target.value),className:"w-full px-4 py-3 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:ring-2 focus:ring-tiffany-500 transition-all",placeholder:"输入资产显示名称",maxLength:200}),e.jsx("p",{className:"mt-2 text-xs text-text-light-tertiary dark:text-text-dark-tertiary",children:"修改显示名称不会影响文件本身，只会改变资产库中的显示"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>{G(null),P("")},className:"flex-1 px-4 py-3 bg-background-light-secondary dark:bg-card-dark-hover text-text-light-primary dark:text-text-dark-primary rounded-lg hover:bg-background-light dark:hover:bg-card-dark transition-all border border-border-light dark:border-border-dark font-medium",children:"取消"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-tiffany-600 dark:bg-tiffany-500 text-white rounded-lg hover:bg-tiffany-700 dark:hover:bg-tiffany-600 transition-all shadow-tiffany font-medium",children:"保存更改"})]})]})]})})]}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("div",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."})})};export{Te as default};
