import{e as Ce,d as Re,r,j as e}from"./react-vendor-CnSaCHf4.js";import{c as p,b as u}from"./index-Cp0uMTfX.js";import"./reactflow-COwzeFBM.js";import"./utils-BcyDR7Vi.js";const Oe=({value:x,onChange:$,options:l})=>{const[j,R]=r.useState(!1),y=r.useRef(null),[v,O]=r.useState(!1);r.useEffect(()=>{const b=()=>{O(document.documentElement.classList.contains("dark"))};b();const k=new MutationObserver(b);return k.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>k.disconnect()},[]),r.useEffect(()=>{const b=k=>{y.current&&!y.current.contains(k.target)&&R(!1)};return j&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[j]);const S=l.find(b=>b.value===x);return e.jsxs("div",{ref:y,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>R(!j),className:"absolute right-0 top-0 bottom-0 px-4 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 rounded-r-full text-xs cursor-pointer flex items-center gap-1 min-w-[100px] justify-center",style:{outline:"none !important",boxShadow:"none !important",border:"none",color:v?"white":"black"},children:[e.jsx("span",{className:"whitespace-nowrap",style:{color:v?"white":"black"},children:S==null?void 0:S.label}),e.jsx("span",{className:"material-symbols-outlined text-xs",style:{fontVariationSettings:'"FILL" 0, "wght" 200',color:v?"white":"black"},children:j?"expand_less":"expand_more"})]}),j&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-32 rounded-lg shadow-lg border border-slate-200 dark:border-white/10 py-1 z-50",style:{backgroundColor:v?"#0f0f10":"#f3f5f5"},children:l.map(b=>e.jsx("button",{type:"button",onClick:()=>{$(b.value),R(!1)},className:`w-full px-3 py-2 text-left text-xs transition-colors ${x===b.value?"bg-slate-200 dark:bg-white/10 text-slate-900 dark:text-white font-medium":"text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-white/10"}`,children:b.label},b.value))})]})},ie="https://api.waule.com",De=()=>{var me,he,be,pe,fe,ge;const{id:x}=Ce(),$=Re(),[l,j]=r.useState(null),[R,y]=r.useState([]),[v,O]=r.useState([]),[S,b]=r.useState(!0),[k,ke]=r.useState(""),[J,we]=r.useState("ALL"),[je,F]=r.useState(!1),[N,X]=r.useState({name:"",faceAssetId:"",frontAssetId:"",sideAssetId:"",backAssetId:"",voiceAssetId:"",documentAssetId:""}),[M,V]=r.useState(null),[z,B]=r.useState(null),[T,_]=r.useState(null),[d,w]=r.useState(null),[h,G]=r.useState(null),[Y,U]=r.useState(""),[ne,Z]=r.useState([]),[oe,P]=r.useState(!1),[L,q]=r.useState(null),[ee,de]=r.useState([]),[I,ce]=r.useState({name:""}),[K,te]=r.useState(null),[Q,se]=r.useState(null),[W,ae]=r.useState(null),[g,H]=r.useState({});r.useEffect(()=>{x&&le()},[x]),r.useEffect(()=>{l&&x&&E()},[l==null?void 0:l.id,l==null?void 0:l.category]),r.useEffect(()=>{const t=s=>{var a;((a=s.detail)==null?void 0:a.libraryId)===x&&(E(),le())};return window.addEventListener("asset-library-updated",t),()=>window.removeEventListener("asset-library-updated",t)},[x,l==null?void 0:l.category]),r.useEffect(()=>{const t=s=>{s.key==="Escape"&&d&&w(null)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[d]);const f=t=>t?(/^https?:\/\//.test(t)?t:`${ie}${t}`).replace(".oss-oss-",".oss-"):"";r.useEffect(()=>{const t=async()=>{var s,a,c,m;try{P(!0),Z([]);const n=d==null?void 0:d.metadata;if(!n||n.kind!=="ROLE"){P(!1);return}const o=[(s=n.images)==null?void 0:s.faceAssetId,(a=n.images)==null?void 0:a.frontAssetId,(c=n.images)==null?void 0:c.sideAssetId,(m=n.images)==null?void 0:m.backAssetId].filter(Boolean);if(o.length===0){P(!1);return}const A=(await Promise.all(o.map(C=>p.assets.getById(C).catch(()=>null)))).map(C=>C==null?void 0:C.data).filter(Boolean);Z(A)}finally{P(!1)}};d&&(l==null?void 0:l.category)==="ROLE"?t():(Z([]),P(!1))},[d,l==null?void 0:l.category]),r.useEffect(()=>{const t=async()=>{var s,a,c,m,n,o;try{if(de([]),!L)return;const i=L.metadata,A=[(s=i==null?void 0:i.images)==null?void 0:s.frontAssetId,(a=i==null?void 0:i.images)==null?void 0:a.sideAssetId,(c=i==null?void 0:i.images)==null?void 0:c.backAssetId].filter(Boolean);H({front:((m=i==null?void 0:i.images)==null?void 0:m.frontAssetId)||null,side:((n=i==null?void 0:i.images)==null?void 0:n.sideAssetId)||null,back:((o=i==null?void 0:i.images)==null?void 0:o.backAssetId)||null});const Ae=(await Promise.all(A.map(D=>p.assets.getById(D).catch(()=>null)))).map(D=>D==null?void 0:D.data).filter(Boolean);de(Ae)}finally{}};L&&(ce({name:L.name||""}),te(null),se(null),ae(null),t())},[L]);const le=async()=>{try{const t=await p.assetLibraries.getById(x);j(t.data)}catch{u.error("加载资产库失败"),$("/assets")}},E=async()=>{try{if(b(!0),(l==null?void 0:l.category)==="ROLE"){const t=await p.assetLibraries.roles.list(x);O(t.data||[]),y([])}else{const t=await p.assetLibraries.getAssets(x);y(t.data),O([])}}catch{u.error("加载资产列表失败"),y([]),O([])}finally{b(!1)}},ye=async t=>{if(confirm("确定要删除这个资产吗？"))try{await p.assets.delete(t);try{const s=new CustomEvent("asset-library-updated",{detail:{libraryId:x}});window.dispatchEvent(s)}catch{}u.success("资产删除成功"),le(),E()}catch{u.error("删除失败")}},ve=async t=>{if(confirm("确定要删除这个角色吗？"))try{await p.assetLibraries.roles.delete(x,t);try{const s=new CustomEvent("asset-library-updated",{detail:{libraryId:x}});window.dispatchEvent(s)}catch{}u.success("角色删除成功"),E()}catch{u.error("删除失败")}},Ne=t=>{G(t),U(t.name)},Le=async t=>{var s,a;if(t.preventDefault(),!!h){if(!Y.trim()){u.error("请输入资产名称");return}try{await p.assets.update(h.id,{name:Y.trim()}),u.success("资产更新成功！"),G(null),U(""),E()}catch(c){u.error(((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.message)||"更新失败")}}},re=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(2)+" KB":(t/(1024*1024)).toFixed(2)+" MB",Ie=async t=>{try{const s=i=>{const A=i.match(/\.[^.]+$/);return A?A[0]:""};let a=t.name;if(!a.includes(".")){const i=s(t.originalName||t.url);a=a+i}u.info("正在准备下载...");const c=await p.get(`/assets/download/${t.id}`,{responseType:"blob",params:{filename:a}}),m=c instanceof Blob?c:c==null?void 0:c.data;if(!m||!(m instanceof Blob)){u.error("下载失败：无效的响应数据");return}if(m.size===0||m.size<100){u.error("下载失败：文件大小异常");return}const n=window.URL.createObjectURL(m),o=document.createElement("a");o.style.display="none",o.href=n,o.download=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>{window.URL.revokeObjectURL(n)},100),u.success(`已下载：${a}`)}catch{u.error("下载失败，请稍后重试")}},ue=t=>{switch(t){case"IMAGE":return"image";case"VIDEO":return"video_file";case"AUDIO":return"audio_file";default:return"description"}},xe=(t,s)=>{const a=t.querySelector("video");a&&(s?(a.currentTime=0,a.play().catch(()=>{})):(a.pause(),a.currentTime=0))},Ee=R.filter(t=>{if(J!=="ALL"&&t.type!==J)return!1;if(k){const s=k.toLowerCase();return t.name.toLowerCase().includes(s)}return!0});return l?e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-8 mb-12",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>$("/assets"),className:"w-10 h-10 flex items-center justify-center hover:bg-slate-100 dark:hover:bg-white/10 rounded-lg transition-all",children:e.jsx("span",{className:"material-symbols-outlined text-slate-800 dark:text-white",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"arrow_back"})}),e.jsx("h1",{className:"text-4xl font-bold text-text-light-primary dark:text-text-dark-primary whitespace-nowrap",children:l.name})]}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md flex items-center",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 text-text-light-tertiary dark:text-text-dark-tertiary",children:"search"}),e.jsx("input",{type:"text",placeholder:"搜索资产...",value:k,onChange:t=>ke(t.target.value),className:"pl-12 pr-28 py-2.5 w-full bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-full text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary outline-none transition-all",style:{outline:"none",boxShadow:"none"}}),e.jsx(Oe,{value:J,onChange:t=>we(t),options:[{value:"ALL",label:"全部"},{value:"IMAGE",label:"图片"},{value:"VIDEO",label:"视频"},{value:"AUDIO",label:"音频"}]})]})}),l.isOwner!==!1&&l.category==="ROLE"&&e.jsxs("button",{onClick:()=>{X({name:"",faceAssetId:"",frontAssetId:"",sideAssetId:"",backAssetId:"",voiceAssetId:"",documentAssetId:""}),V(null),B(null),_(null),F(!0)},className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white font-medium rounded-lg transition-all flex items-center gap-2 active:scale-95 whitespace-nowrap",children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"person_add"}),"创建角色"]}),l.isShared&&e.jsxs("div",{className:"px-4 py-2 bg-blue-500/10 border border-blue-500/30 rounded-lg flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-500 text-lg",children:"group"}),e.jsxs("span",{className:"text-sm text-blue-600 dark:text-blue-400",children:["来自 ",((he=(me=l.shareInfo)==null?void 0:me.owner)==null?void 0:he.nickname)||"未知用户"," 的共享"]})]})]}),S?e.jsx("div",{className:"text-center py-12 text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."}):l.category==="ROLE"?v.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-purple-500/10 flex items-center justify-center mb-6 shadow-purple-400/30",children:e.jsx("span",{className:"material-symbols-outlined text-purple-400 text-5xl",children:"person"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary mb-2",children:"还没有角色"}),e.jsx("p",{className:"text-text-light-secondary dark:text-text-dark-secondary mb-6",children:"创建你的第一个角色"}),e.jsx("button",{onClick:()=>{X({name:"",faceAssetId:"",frontAssetId:"",sideAssetId:"",backAssetId:"",voiceAssetId:"",documentAssetId:""}),V(null),B(null),_(null),F(!0)},className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white font-medium rounded-lg transition-all active:scale-95",children:"创建角色"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:v.map(t=>{const s=t.thumbnail||"";return e.jsxs("div",{onClick:()=>w(t),className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden hover:border-purple-400 dark:hover:border-purple-400/50 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer relative",children:[e.jsxs("div",{className:"aspect-[4/3] bg-slate-100 dark:bg-white/5 relative overflow-hidden",children:[s?e.jsx("img",{src:f(s),alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-tiffany-300 dark:text-white/30",children:"person"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/0 to-black/10 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),w(t)},className:"w-7 h-7 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"预览",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"visibility"})}),(l==null?void 0:l.isOwner)!==!1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),q(t)},className:"w-7 h-7 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"编辑",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),ve(t.id)},className:"w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"删除",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete"})})]})]})]}),e.jsx("div",{className:"p-2",children:e.jsx("h3",{className:"text-xs font-bold text-text-light-primary dark:text-text-dark-primary truncate",children:t.name})})]},t.id)})}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Ee.map(t=>{var s;return e.jsxs("div",{onClick:()=>w(t),onMouseEnter:a=>xe(a.currentTarget,!0),onMouseLeave:a=>xe(a.currentTarget,!1),className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl overflow-hidden hover:border-purple-400 dark:hover:border-purple-400/50 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer",children:[e.jsxs("div",{className:"aspect-[4/3] bg-slate-100 dark:bg-white/5 relative overflow-hidden",children:[t.type==="IMAGE"?e.jsx("img",{src:f(t.url),alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.03]",onError:a=>{a.currentTarget.style.display="none"}}):t.type==="VIDEO"?e.jsx("video",{src:f(t.url),className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.02]",preload:"metadata",muted:!0,loop:!0,onError:()=>{}}):t.type==="AUDIO"?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl text-tiffany-300 dark:text-white/30 mb-3",children:"audio_file"}),e.jsx("audio",{src:f(t.url),controls:!0,className:"w-full max-w-[90%]",onError:()=>{}})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-tiffany-300 dark:text-white/30",children:ue(t.type)})}),e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[(l==null?void 0:l.isOwner)!==!1&&e.jsx("button",{onClick:a=>{a.stopPropagation(),Ne(t)},className:"w-7 h-7 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"编辑",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"edit"})}),((l==null?void 0:l.isOwner)!==!1||((s=l==null?void 0:l.shareInfo)==null?void 0:s.canDownload))&&e.jsx("button",{onClick:a=>{a.stopPropagation(),Ie(t)},className:"w-7 h-7 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"下载",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"download"})}),(l==null?void 0:l.isOwner)!==!1&&e.jsx("button",{onClick:a=>{a.stopPropagation(),ye(t.id)},className:"w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 hover:shadow-lg text-white rounded-full transition-all shadow-md active:scale-95",title:"删除",children:e.jsx("span",{className:"material-symbols-outlined text-sm",style:{fontVariationSettings:'"FILL" 0, "wght" 200'},children:"delete"})})]}),e.jsx("div",{className:"absolute bottom-2 right-2 px-2 py-0.5 bg-black/60 backdrop-blur-sm text-white text-xs rounded",children:re(t.size)})]}),e.jsx("div",{className:"p-2",children:e.jsx("h3",{className:"text-xs font-bold text-text-light-primary dark:text-text-dark-primary truncate",children:t.name})})]},t.id)})}),je&&(l==null?void 0:l.category)==="ROLE"&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl px-6 py-5 w-full max-w-xl md:max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"创建角色"}),e.jsx("button",{onClick:()=>F(!1),className:"p-2 nodrag hover:bg-slate-200 dark:hover:bg-white/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-slate-600 dark:text-slate-400",children:"close"})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"① 上传图片 → ② 填写名称"}),e.jsx("div",{className:"mt-2 text-xs text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 px-3 py-2 rounded",children:"请上传1-3张角色图片（支持 JPG/PNG），图片比例建议为3:4竖向"})]}),e.jsxs("div",{className:"grid grid-cols-[1fr,1px,200px] grid-rows-[auto,auto] gap-6 items-start mb-4",children:[e.jsxs("div",{className:"row-span-2 rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"424px"},children:[M?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(M),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>V(null),className:"absolute top-2 right-2 p-2 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-4xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return V(((s=t.target.files)==null?void 0:s[0])||null)}}),"+"]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/0 to-black/10 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]}),e.jsx("div",{className:"w-px h-full bg-slate-200 dark:bg-white/10"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden",style:{height:"200px"},children:z?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(z),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>B(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return B(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})}),e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden",style:{height:"200px"},children:T?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(T),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>_(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return _(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 dark:text-slate-300",children:"角色名称"}),e.jsx("input",{value:N.name,onChange:t=>X({...N,name:t.target.value}),className:"w-full px-3 py-2 rounded-lg bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark text-text-light-primary dark:text-text-dark-primary",maxLength:30})]})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>F(!1),className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white border border-slate-200 dark:border-white/10 hover:bg-slate-200 dark:hover:bg-white/10 transition-all",children:"取消"}),e.jsx("button",{onClick:async()=>{var t,s;try{if(!N.name.trim()){u.error("请输入角色名称");return}if(!M&&!z&&!T){u.error("请至少上传一张图片");return}const a={},c=async(n,o)=>n?(await p.assetLibraries.uploadAsset(x,n,o)).data.id:null;a.frontAssetId=await c(M,`${N.name}-主图`),a.sideAssetId=await c(z,`${N.name}-参考1`),a.backAssetId=await c(T,`${N.name}-参考2`);const m={name:N.name.trim()};Object.entries(a).forEach(([n,o])=>{o&&(m[n]=o)}),await p.assetLibraries.roles.create(x,m),u.success("角色创建成功"),F(!1),E()}catch(a){u.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"创建角色失败")}},className:"px-6 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white transition-all active:scale-95",children:"创建"})]})]})}),d&&l.category==="ROLE"&&((be=d.metadata)==null?void 0:be.kind)==="ROLE"?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-6",onClick:()=>w(null),children:e.jsxs("div",{className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl p-6 w-full max-w-3xl shadow-xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:d.name}),e.jsx("button",{onClick:()=>w(null),className:"p-2 nodrag hover:bg-slate-200 dark:hover:bg-white/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-slate-600 dark:text-slate-400",children:"close"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[oe&&e.jsx("div",{className:"col-span-3 text-center text-slate-600 dark:text-slate-400",children:"加载中..."}),!oe&&ne.length===0&&e.jsx("div",{className:"col-span-3 text-center text-slate-600 dark:text-slate-400",children:"无可预览图片"}),ne.map((t,s)=>e.jsx("div",{className:"aspect-square bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-xl overflow-hidden flex items-center justify-center",children:e.jsx("img",{src:f(t.url),alt:t.name,className:"w-full h-full object-cover",onError:a=>{a.currentTarget.style.display="none"}})},s))]})]})}):d&&e.jsx("div",{className:"fixed inset-0 bg-white/70 dark:bg-black/80 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:()=>w(null),children:e.jsxs("div",{className:"relative max-w-[95vw] h-[65vh] flex flex-col",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>w(null),className:"absolute -top-14 right-0 w-12 h-12 flex items-center justify-center bg-slate-200/80 dark:bg-white/10 hover:bg-slate-300 dark:hover:bg-white/20 text-slate-800 dark:text-white rounded-full transition-colors z-10",title:"关闭 (ESC)",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"close"})}),e.jsxs("div",{className:"absolute -top-14 left-0 text-slate-800 dark:text-white flex items-center gap-3",children:[e.jsx("h3",{className:"font-bold text-xl",children:d.name}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-white/60",children:re(d.size)})]}),d.type==="IMAGE"?e.jsx("img",{src:f(d.url),alt:d.name,className:"max-w-full h-full object-contain",onError:()=>{}}):d.type==="VIDEO"?e.jsx("video",{src:f(d.url),controls:!0,autoPlay:!0,className:"max-w-full h-full object-contain",onError:()=>{}}):d.type==="AUDIO"?e.jsxs("div",{className:"bg-gradient-to-br from-tiffany-500/20 to-coral-500/20 backdrop-blur-md rounded-2xl p-16 flex flex-col items-center justify-center min-w-[500px]",children:[e.jsx("span",{className:"material-symbols-outlined text-9xl text-white mb-8",children:"audio_file"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-6 text-center max-w-md",children:d.name}),e.jsx("audio",{src:f(d.url),controls:!0,autoPlay:!0,className:"w-full max-w-lg",onError:()=>{}})]}):e.jsxs("div",{className:"bg-white/5 backdrop-blur-md rounded-2xl p-16 flex flex-col items-center justify-center min-w-[400px]",children:[e.jsx("span",{className:"material-symbols-outlined text-9xl text-white/50 mb-6",children:"description"}),e.jsx("p",{className:"text-white/70 text-lg",children:"无法预览此文件类型"})]})]})}),L&&(l==null?void 0:l.category)==="ROLE"&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-white/80 dark:bg-black/60 backdrop-blur-xl border-2 border-slate-200 dark:border-white/10 rounded-2xl px-6 py-5 w-full max-w-xl md:max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"编辑角色"}),e.jsx("button",{onClick:()=>q(null),className:"p-2 nodrag hover:bg-slate-200 dark:hover:bg-white/10 rounded",children:e.jsx("span",{className:"material-symbols-outlined text-slate-600 dark:text-slate-400",children:"close"})})]}),e.jsxs("div",{className:"grid grid-cols-[1fr,1px,200px] grid-rows-[auto,auto] gap-6 items-start mb-4",children:[e.jsx("div",{className:"row-span-2 rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"424px"},children:K?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(K),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>te(null),className:"absolute top-2 right-2 p-2 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):g.front?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:f(((pe=ee[0])==null?void 0:pe.url)||""),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>H({...g,front:null}),className:"absolute top-2 right-2 p-2 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-4xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return te(((s=t.target.files)==null?void 0:s[0])||null)}}),"+"]})}),e.jsx("div",{className:"w-px h-full bg-slate-200 dark:bg-white/10"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"200px"},children:Q?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(Q),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>se(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):g.side?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:f(((fe=ee[1])==null?void 0:fe.url)||""),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>H({...g,side:null}),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return se(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})}),e.jsx("div",{className:"rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 flex items-center justify-center overflow-hidden relative",style:{height:"200px"},children:W?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:URL.createObjectURL(W),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>ae(null),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):g.back?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:f(((ge=ee[2])==null?void 0:ge.url)||""),className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>H({...g,back:null}),className:"absolute top-2 right-2 p-1.5 bg-black/40 text-white rounded hover:bg-black/60",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}):e.jsxs("label",{className:"w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 text-2xl cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var s;return ae(((s=t.target.files)==null?void 0:s[0])||null)}}),"+",e.jsx("span",{className:"block text-xs mt-1",children:"(可选)"})]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 dark:text-slate-300",children:"角色名称"}),e.jsx("input",{value:I.name,onChange:t=>ce({...I,name:t.target.value}),className:"w-full px-3 py-2 rounded-lg bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark text-text-light-primary dark:text-text-dark-primary",maxLength:30})]})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>q(null),className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-white/5 text-slate-800 dark:text-white border border-slate-200 dark:border-white/10 hover:bg-slate-200 dark:hover:bg-white/10 transition-all",children:"取消"}),e.jsx("button",{onClick:async()=>{var t,s;try{if(!I.name.trim()){u.error("请输入角色名称");return}const a={},c=async(n,o)=>n?(await p.assetLibraries.uploadAsset(x,n,o)).data.id:null;a.frontAssetId=K?await c(K,`${I.name}-主图`):g.front,a.sideAssetId=Q?await c(Q,`${I.name}-参考1`):g.side,a.backAssetId=W?await c(W,`${I.name}-参考2`):g.back;const m={name:I.name.trim()};Object.entries(a).forEach(([n,o])=>{m[n]=o===void 0?void 0:o}),await p.assetLibraries.roles.update(x,L.id,m),u.success("角色更新成功"),q(null),E()}catch(a){u.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"更新角色失败")}},className:"px-6 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600/50 dark:to-pink-600/50 hover:shadow-lg text-white transition-all active:scale-95",children:"保存"})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark rounded-2xl p-6 max-w-2xl w-full shadow-soft-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-light-primary dark:text-text-dark-primary",children:"编辑资产"}),e.jsx("button",{onClick:()=>{G(null),U("")},type:"button",className:"p-2 hover:bg-background-light-secondary dark:hover:bg-card-dark-hover rounded-lg transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-text-light-secondary dark:text-text-dark-secondary",children:"close"})})]}),e.jsxs("form",{onSubmit:Le,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-background-light dark:bg-background-dark rounded-lg border border-border-light dark:border-border-dark",children:[e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden bg-gradient-to-br from-tiffany-100 to-tiffany-200 dark:from-tiffany-500/20 dark:to-coral-500/20 flex items-center justify-center flex-shrink-0",children:h.type==="IMAGE"?e.jsx("img",{src:h.url.startsWith("http")?h.url:`${ie}${h.url}`,alt:h.name,className:"w-full h-full object-cover"}):h.type==="VIDEO"?e.jsx("video",{src:h.url.startsWith("http")?h.url:`${ie}${h.url}`,className:"w-full h-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-3xl text-tiffany-300 dark:text-white/30",children:ue(h.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-text-light-primary dark:text-text-dark-primary mb-1",children:["原始文件名: ",h.originalName]}),e.jsxs("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["大小: ",re(h.size)," · 类型: ",h.type]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-2",children:"显示名称 *"}),e.jsx("input",{type:"text",required:!0,value:Y,onChange:t=>U(t.target.value),className:"w-full px-4 py-3 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:ring-2 focus:ring-tiffany-500 transition-all",placeholder:"输入资产显示名称",maxLength:200}),e.jsx("p",{className:"mt-2 text-xs text-text-light-tertiary dark:text-text-dark-tertiary",children:"修改显示名称不会影响文件本身，只会改变资产库中的显示"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>{G(null),U("")},className:"flex-1 px-4 py-3 bg-background-light-secondary dark:bg-card-dark-hover text-text-light-primary dark:text-text-dark-primary rounded-lg hover:bg-background-light dark:hover:bg-card-dark transition-all border border-border-light dark:border-border-dark font-medium",children:"取消"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-tiffany-600 dark:bg-tiffany-500 text-white rounded-lg hover:bg-tiffany-700 dark:hover:bg-tiffany-600 transition-all shadow-tiffany font-medium",children:"保存更改"})]})]})]})})]}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("div",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:"加载中..."})})};export{De as default};
